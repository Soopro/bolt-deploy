(function(){angular.module("boltApp",["ngSanitize","supLocales","supAngularWysiwyg"])}).call(this);(function(){angular.module("boltApp").constant("config",{baseURL:{api:sup.server.api,apps:sup.server.apps,media_uploads_url:sup.server.media,assistant:sup.server.assistant},debug:sup.debug,browser:angular.browser(),cdn:{engine:"?imageMogr2",upload:window.location.protocol+"//upload.qbox.me"},locales:[{code:"en_US",name:"English"},{code:"zh_CN",name:"简体中文"}],default_locale:"en_US",social_medias:[{code:"weibo",name:"Weibo"},{code:"wechat",name:"WeChat"},{code:"github",name:"Github"},{code:"behance",name:"Behance"},{code:"facebook",name:"Facebook"},{code:"twitter",name:"Twitter"},{code:"google-plus",name:"Google+"},{code:"linkedin",name:"Linkedin"}],media_icons:{image:"image:ic_photo_24px",video:"av:ic_videocam_24px",audio:"image:ic_audiotrack_24px",application:"file:ic_attachment_24px"},max_image_size:{width:1650,height:1650},max_file_size:{image:1*1024*1024,video:24*1024*1024,audio:6*1024*1024,application:6*1024*1024},media_encoder_options:.8,media_mimetypes:{image:["image/png","image/jpeg","image/svg+xml","image/gif"],video:["video/mp4","video/quicktime"],audio:["audio/mpeg","audio/mp3"],application:["application/zip","application/pdf"]},capabilities:[{key:1,label:"Noob"},{key:2,label:"Junior"},{key:3,label:"Senior"}],route:{index:"/app",info:"/info",profile:"/user/profile",oauth:"/user/oauth",auth:"/gate/login",exit:"/gate/exit",editor:"/editor",error:"/404"},paths:{gate:["/gate/login","/gate/register","/gate/recovery"],free:["/info","/404"]},app_types:[{name:"Brand Website",key:"ws",ico:"av:ic_web_24px"},{name:"WeChat Buzz",key:"wx",ico:"action:ic_speaker_notes_24px"},{name:"Mobile Showreel",key:"wa",ico:"hardware:ic_phone_android_24px"},{name:"Manuscript",key:"wb",ico:"action:ic_book_24px",disabled:true}],default_app_type:"ws",email:{support:"support@soopro.com"},copyright:"Humbly powered by soopro."})}).call(this);(function(){angular.module("boltApp").filter("thumbnail",["config",function(e){return function(t,r){var n,i,o,a;if(!angular.isUrl(t)){return t}if(r===void 0){r="thumbnail"}a=e.baseURL.media_uploads_url;n=e.cdn.engine;i={thumbnail:"/thumbnail/480x>/quality/90",favicon:"/thumbnail/180x180!/quality/90"};o=i[r];if(!o||!a||!n){return t}if(angular.startswith(t,a+"/")){if(t.indexOf(n)<0){if(t.match(/\?|#/)){t=t.split("?")[0].split("#")[0]}t+=n}t=t.replace(/\/thumbnail\/.*?$/i,"")+o}return t}}]).filter("bg_img",function(){return function(e){if(!e){return""}return"background-image:url("+e+");"}}).filter("is_empty",function(){return function(e){var t;if(angular.isArray(e)){t=!e||e.length<=0}else if(angular.isObject(e)){t=!e||Object.keys(e).length<=0}else if(angular.isFunction(e)||angular.isElement(e)){t=true}else{t=!Boolean(e)}return t}})}).call(this);(function(){var supWysiwygEditor,indexOf=[].indexOf;supWysiwygEditor=function(){var $btn_indent,$btn_outdent,$currentAudio,$currentImage,$currentLink,$currentVideo,$document,$editor,$history,$history_step,$options,$property,$toolbar,BFBL,assertParam,baseEventHanlder,blowupHtml,blurHandler,blurHook,btnList,childOf,clearEmptyElements,clearStyles,closeHTMLHook,createToolbarBtns,defaultToolbarBtns,destroySpan,destroy_editor,dispatchSAWEvent,doInsertAudio,doInsertImg,doInsertVideo,doReplaceAudio,doReplaceImg,doReplaceVideo,editLinkHook,editMediaHook,endRange,error,evtManager,execCmd,execFormatBlock,execInsertLink,execInsertMedia,execInsertPreset,execInsertScript,execRemoveLink,execRemoveMedia,execReplaceLink,execReplaceMedia,findSibling,findStylesParent,findTopElement,focusHandler,focusHook,getAllElementsFromSelection,getCurrentSelection,getDisplayType,getSameParent,getSelectionHtml,get_name,get_options,get_order,get_property,historyManager,inEditor,inElement,indentText,init_editor,insertA,insertCode,insertHR,insertLinkHook,insertMark,insertMedia,insertMediaHook,insertOrderedList,insertPreset,insertPresetHook,insertScript,insertScriptHook,insertUnorderedList,isFamily,isHTMLElement,isJsonString,justifyCenter,justifyFull,justifyLeft,justifyRight,load_options,log,makeBold,makeFontBig,makeFontSmall,makeH1,makeH2,makeH3,makeH4,makeH5,makeH6,makeItalic,makeP,makePre,makeQuote,makeStrike,makeSub,makeSup,makeUnderline,mergeJSON,methods,now,openHTMLHook,outdentText,pasteHtmlAtCaret,placeCaretAfterNode,reDo,removeInlineStyle,removeTag,resetCurrentLink,resetCurrentMedia,restoreSelection,richEditorModel,saveSelection,savedRange,selObj,selRange,selectHandler,selectedNode,selectedOrigin,setKeyboard,setRange,setRangeByStartEnd,set_blur_hook,set_edit_link_hook,set_edit_media_hook,set_focus_hook,set_html_on_close_hook,set_html_on_open_hook,set_insert_link_hook,set_insert_media_hook,set_insert_preset_hook,set_insert_script_hook,set_toolbar,smartFormatBlock,startRange,styleTags,switchIndentOutdentBtns,targetA,targetAudio,targetImg,targetVideo,testBlackList,toggleHtml,toggleTextWrapper,unDo,unset_toolbar,ver,watcher,wildClear;ver="1.6.0";now=Date.now();$options={nontoolbar:false,history:100};$property={name:"",order:0};$document=void 0;$editor=void 0;$toolbar=void 0;selObj=void 0;selRange=void 0;selectedNode=void 0;selectedOrigin=void 0;startRange=void 0;endRange=void 0;savedRange=void 0;richEditorModel=true;focusHook=void 0;blurHook=void 0;insertLinkHook=void 0;editLinkHook=void 0;insertMediaHook=void 0;editMediaHook=void 0;insertPresetHook=void 0;insertScriptHook=void 0;openHTMLHook=void 0;closeHTMLHook=void 0;$currentImage={element:void 0,link:void 0};$currentVideo={element:void 0};$currentAudio={element:void 0};$currentLink={element:void 0};$history=[];$history_step=null;defaultToolbarBtns=[["h1","h2","h3","h4","h5","h6","p","quote","pre","code"],["mark","i","b","strike","underline","small","big","sub","sup"],["ol","ul","outdent","indent","hr","img","preset","a","jleft","jcenter","jright","jfull"],["ud","rd","clear"],["script","html"]];$btn_indent=void 0;$btn_outdent=void 0;btnList=[{name:"h1",handler:"makeH1",ico:null,status:""},{name:"h2",handler:"makeH2",ico:null,status:""},{name:"h3",handler:"makeH3",ico:null,status:""},{name:"h4",handler:"makeH4",ico:null,status:""},{name:"h5",handler:"makeH5",ico:null,status:""},{name:"h6",handler:"makeH6",ico:null,status:""},{name:"p",handler:"makeP",ico:"paragraph"},{name:"quote",handler:"makeQuote",ico:"quote-right",status:""},{name:"pre",handler:"makePre",ico:"pre",status:""},{name:"code",handler:"insertCode",ico:"code",status:""},{name:"mark",handler:"insertMark",ico:"mark",status:""},{name:"i",handler:"makeItalic",ico:"italic",status:""},{name:"b",handler:"makeBold",ico:"bold",status:""},{name:"strike",handler:"makeStrike",ico:"strikethrough",status:""},{name:"underline",handler:"makeUnderline",ico:"underline",status:""},{name:"small",handler:"makeFontSmall",ico:"font-small",status:""},{name:"big",handler:"makeFontBig",ico:"font-big",status:""},{name:"sub",handler:"makeSub",ico:"subscript",status:""},{name:"sup",handler:"makeSup",ico:"superscript",status:""},{name:"ol",handler:"insertOrderedList",ico:"list-ol",status:""},{name:"ul",handler:"insertUnorderedList",ico:"list-ul",status:""},{name:"outdent",handler:"outdentText",ico:"outdent",status:""},{name:"indent",handler:"indentText",ico:"indent",status:""},{name:"hr",handler:"insertHR",ico:"arrows-h",status:""},{name:"img",handler:"insertMedia",ico:"picture-o",status:""},{name:"preset",handler:"insertPreset",ico:"preset",status:""},{name:"a",handler:"insertA",ico:"link",status:""},{name:"jleft",handler:"justifyLeft",ico:"align-left",status:""},{name:"jcenter",handler:"justifyCenter",ico:"align-center",status:""},{name:"jright",handler:"justifyRight",ico:"align-right",status:""},{name:"jfull",handler:"justifyFull",ico:"align-justify",status:""},{name:"redo",handler:"reDo",ico:"redo",status:""},{name:"undo",handler:"unDo",ico:"undo",status:""},{name:"clear",handler:"clearStyles",ico:"eraser",status:""},{name:"script",handler:"insertScript",ico:"script",status:""},{name:"html",handler:"toggleHtml",ico:"code",status:""}];BFBL=["OL","UL","LI","TD","TH","TR","TBODY","TABLE","THEAD","TFOOT","DL","DD","DT"];styleTags=["b","i","u","s","mark","strong","sup","sub","small","big","strike","del","font","span"];selectHandler=function(e){getCurrentSelection();watcher()};focusHandler=function(e){savedRange=saveSelection();if(!childOf(e.target,$toolbar,true)){if(typeof focusHook==="function"){focusHook()}}watcher()};blurHandler=function(e){if(!inEditor(e.target,true)&&!childOf(e.target,$toolbar,true)&&typeof blurHook==="function"){blurHook()}};targetImg=function(e){var t,r,n,i,o;t=e.target;if(!t||!inEditor(t)){e.preventDefault();return false}if(t.tagName!=="IMG"){return}if(typeof editMediaHook==="function"){$currentImage.element=t;n={type:"image",src:t.getAttribute("src"),title:t.getAttribute("alt"),alt:t.getAttribute("alt"),class:t.getAttribute("class")};r=t.parentElement;if(r&&inEditor(r)&&r.tagName==="A"){$currentImage.link=r;n.link=r.getAttribute("href");n.target=r.getAttribute("target");n.class=r.getAttribute("class")}else{$currentImage.link=null}editMediaHook(n)}else{o=t.getAttribute("src");i=prompt("Img:",o);if(i){t.setAttribute("src",i)}else if(i!==null){t.parentElement.removeChild(t)}historyManager.record()}e.preventDefault();return false};targetVideo=function(e){var t,r,n,i,o;n=e.target;if(!n||!inEditor(n)){e.preventDefault();return false}if(n.tagName!=="VIDEO"){return}if(typeof editMediaHook==="function"){$currentVideo.element=n;try{o=n.querySelector("source").getAttribute("src")}catch(e){o=""}i={type:"video",src:n.getAttribute("src")||o,poster:n.getAttribute("poster"),controls:n.hasAttribute("controls"),loop:n.hasAttribute("loop"),autoplay:n.hasAttribute("autoplay"),class:n.getAttribute("class")};editMediaHook(i)}else{r=n.getAttribute("src");t=prompt("Video:",r);if(t){n.setAttribute("src",t);n.setAttribute("controls",true)}else if(t!==null){n.parentElement.removeChild(n)}historyManager.record()}e.preventDefault();return false};targetAudio=function(e){var t,r,n,i;t=e.target;if(!t||!inEditor(t)){e.preventDefault();return false}if(t.tagName!=="AUDIO"){return}if(typeof editMediaHook==="function"){$currentAudio.element=t;r={type:"audio",src:t.getAttribute("src"),loop:t.hasAttribute("loop"),autoplay:t.hasAttribute("autoplay"),controls:t.hasAttribute("controls"),class:t.getAttribute("class")};editMediaHook(r)}else{i=t.getAttribute("src");n=prompt("Audio:",i);if(n){t.setAttribute("src",n);t.setAttribute("controls",true)}else if(n!==null){t.parentElement.removeChild(t)}historyManager.record()}e.preventDefault();return false};targetA=function(e){var t,r,n,i;t=e.target;if(!t||!inEditor(t)){e.preventDefault();return false}if(t.tagName==="IMG"||t.tagName!=="A"){return}if(t.children.length===1){r=t.children[0];if(r.tagName==="IMG"){return}}if(!t.dataset._saw_link_is_ready){t.dataset._saw_link_is_ready=true;window.setTimeout(function(){return delete t.dataset._saw_link_is_ready},1200);return}if(typeof editLinkHook==="function"){$currentLink.element=t;n={href:t.getAttribute("href"),target:t.getAttribute("target"),class:t.getAttribute("class")};editLinkHook(n)}else{i=prompt("Link:",url);if(i){t.setAttribute("href",i)}else if(i!==null){t.outerHTML=t.innerHTML}historyManager.record()}e.preventDefault();return false};insertOrderedList=function(e){var t,r,n;if(!inEditor(selectedNode,true)){return}if(inEditor(selectedNode)){execCmd("insertorderedlist");getCurrentSelection();n=selectedNode.parentElement.parentElement;destroySpan(n,true);if(n.parentElement&&n.parentElement.tagName==="P"){n.parentElement.outerHTML=n.parentElement.innerHTML}}else{t=selectedNode.innerHTML;selectedNode.innerHTML="<ol><li>"+t+"</li></ol>";r=selectedNode.querySelector("li");setRange(r)}switchIndentOutdentBtns();historyManager.record();return getCurrentSelection()};insertUnorderedList=function(e){var t,r,n;if(!inEditor(selectedNode,true)){return}if(inEditor(selectedNode)){execCmd("insertunorderedlist");getCurrentSelection();n=selectedNode.parentElement.parentElement;destroySpan(n,true);if(n.parentElement&&n.parentElement.tagName==="P"){n.parentElement.outerHTML=n.parentElement.innerHTML}}else{t=selectedNode.innerHTML;selectedNode.innerHTML="<ul><li>"+t+"</li></ul>";r=selectedNode.querySelector("li");setRange(r)}switchIndentOutdentBtns();historyManager.record();return getCurrentSelection()};outdentText=function(e){if(inElement(selectedNode,"LI")||inElement(selectedNode,"OL")){execCmd("outdent");return switchIndentOutdentBtns()}};indentText=function(e){if(inElement(selectedNode,"LI")||inElement(selectedNode,"OL")){execCmd("indent");return switchIndentOutdentBtns()}};makeH1=function(e){return smartFormatBlock("h1")};makeH2=function(e){return smartFormatBlock("h2")};makeH3=function(e){return smartFormatBlock("h3")};makeH4=function(e){return smartFormatBlock("h4")};makeH5=function(e){return smartFormatBlock("h5")};makeH6=function(e){return smartFormatBlock("h6")};makePre=function(e){return smartFormatBlock("pre")};makeQuote=function(e){return smartFormatBlock("blockquote")};makeP=function(e){return smartFormatBlock("p")};makeBold=function(e){return execCmd("bold")};makeItalic=function(e){return execCmd("italic")};justifyLeft=function(e){return execCmd("justifyLeft")};justifyRight=function(e){return execCmd("justifyRight")};justifyCenter=function(e){return execCmd("justifyCenter")};justifyFull=function(e){return execCmd("justifyFull")};makeStrike=function(e){return execCmd("strikeThrough")};makeUnderline=function(e){return execCmd("underline")};makeSup=function(e){return execCmd("superscript")};makeSub=function(e){return execCmd("subscript")};reDo=function(e){return historyManager.redo()};unDo=function(e){return historyManager.undo()};makeFontSmall=function(e){var t;if(!inEditor(selectedNode,true)){return}t=toggleTextWrapper("small");if(t){clearEmptyElements(selectedNode.parentElement,["big","small"]);getCurrentSelection();return historyManager.record()}};makeFontBig=function(e){var t;if(!inEditor(selectedNode,true)){return}t=toggleTextWrapper("big");if(t){clearEmptyElements(selectedNode.parentElement,["big","small"]);getCurrentSelection();return historyManager.record()}};insertMark=function(e){var t;if(!inEditor(selectedNode,true)){return}t=toggleTextWrapper("mark");if(t){getCurrentSelection();return historyManager.record()}};insertCode=function(e){var t;if(!inEditor(selectedNode)){return}t=inElement(selectedNode,"CODE");if(!t){if(!testBlackList(selectedNode)){selectedNode.outerHTML="<code>"+selectedNode.innerHTML+"</code>";selObj.extend(selectedNode,0)}}else{t.outerHTML="<div>"+t.innerHTML+"</div>";selObj.extend(t,0)}return historyManager.record()};clearStyles=function(e){var t,r,n,i,o,a;if(!inEditor(selectedNode,true)){return}a=getAllElementsFromSelection();for(i=0,o=a.length;i<o;i++){r=a[i];r=findStylesParent(r);r.removeAttribute("style");if(!r.innerHTML||!inEditor(r)){continue}t=r.innerHTML;n=0;while(n<styleTags.length){t=removeTag(t,styleTags[n],true);n++}r.innerHTML=removeInlineStyle(t)}historyManager.record();return getCurrentSelection()};blowupHtml=function(e){return wildClear()};insertHR=function(e){return execCmd("insertHorizontalRule")};insertA=function(e){var t;if(inEditor(selectedNode,true)){if(typeof insertLinkHook==="function"){savedRange=saveSelection();insertLinkHook()}else{t=prompt("Link:","#");execCmd("createLink",false,t)}return historyManager.record()}};insertMedia=function(e){var t;if(inEditor(selectedNode,true)){if(typeof insertMediaHook==="function"){savedRange=saveSelection();insertMediaHook()}else{t=prompt("Img:","http://");if(t!==""&&t!=="http://"){execCmd("insertImage",false,t);watcher()}}return historyManager.record()}};insertPreset=function(e){var t;if(inEditor(selectedNode,true)){if(typeof insertPresetHook==="function"){savedRange=saveSelection();insertPresetHook()}else{savedRange=saveSelection();t=prompt("Preset:","");if(t!==""){execInsertPreset(t)}}return historyManager.record()}};insertScript=function(e){var t;if(inEditor(selectedNode,true)){if(typeof insertScriptHook==="function"){savedRange=saveSelection();insertScriptHook()}else{savedRange=saveSelection();t=prompt("Script:","");if(t!==""){execInsertScript(t)}}return historyManager.record()}};toggleHtml=function(e){var t;if(!inEditor(selectedNode,true)){return}historyManager.record();if(typeof openHTMLHook==="function"){savedRange=saveSelection();openHTMLHook()}else{if($editor.tagName!=="textarea"){t=$editor.innerHTML;$editor.outerHTML="<textarea>"+t+"</textarea>";richEditorModel=false}else{t=$editor.value;$editor.outerHTML="<div>"+t+"</div>";richEditorModel=true}if(!$toolbar){return}if(richEditorModel){$toolbar.removeAttribute("disabled")}else{$toolbar.setAttribute("disabled",true)}}return historyManager.record()};getCurrentSelection=function(){var e;e=void 0;selObj=window.getSelection();if(selObj.type!=="None"&&selObj.rangeCount>0){selRange=selObj.getRangeAt(0);startRange=selRange.startContainer;endRange=selRange.endContainer;e=selObj.anchorNode;selectedOrigin=e;while(e.nodeType!==1){e=e.parentNode}return selectedNode=e}};setRange=function(e){var t,r;t=document.createRange();t.selectNode(e);r=window.getSelection();r.removeAllRanges();return r.addRange(t)};setRangeByStartEnd=function(e){var t,r;t=document.createRange();t.setStartBefore(e);t.setEndAfter(e);r=window.getSelection();r.removeAllRanges();return r.addRange(t)};inEditor=function(e,t){return childOf(e,$editor,t)};childOf=function(e,t,r){var n,i,o,a;if(!e||!t||!e.tagName||!t.tagName){return false}else if(e===t&&r){return true}else{o="saw-child-id";i="saw-"+Date.now().toString();e.setAttribute("saw-child-id",i);a=e.tagName.toLowerCase();n=t.querySelector(a+"["+o+"="+i+"]");e.removeAttribute("saw-child-id")}return Boolean(n)};watcher=function(){var e,t,r,n,i;r=$editor.querySelectorAll("img");t=0;while(t<r.length){r[t].addEventListener("click",targetImg);t++}i=$editor.querySelectorAll("video");t=0;while(t<i.length){i[t].addEventListener("click",targetVideo);t++}e=$editor.querySelectorAll("audio");t=0;while(t<e.length){e[t].addEventListener("click",targetAudio);t++}n=$editor.querySelectorAll("a");t=0;while(t<n.length){n[t].addEventListener("click",targetA);t++}return switchIndentOutdentBtns()};switchIndentOutdentBtns=function(){getCurrentSelection();if(inElement(selectedNode,"LI")||inElement(selectedNode,"OL")){if($btn_indent){$btn_indent.removeAttribute("disabled")}if($btn_outdent){$btn_outdent.removeAttribute("disabled")}}else{if($btn_indent){$btn_indent.setAttribute("disabled",true)}if($btn_outdent){$btn_outdent.setAttribute("disabled",true)}}};saveSelection=function(){var e;if(window.getSelection){e=window.getSelection();if(e.getRangeAt&&e.rangeCount){return e.getRangeAt(0)}}else if(document.selection&&document.selection.createRange){return document.selection.createRange()}return null};restoreSelection=function(e){var t;if(!e){return}if(window.getSelection){t=window.getSelection();t.removeAllRanges();return t.addRange(e)}else if(document.selection&&e.select){return e.select()}};isHTMLElement=function(e){var t,r,n;if(!e){return false}t=e&&typeof e==="object"&&e!==null;r=e.nodeType===1&&typeof e.nodeName==="string";n=t&&r;return n};inElement=function(e,t){if(!e||typeof t!=="string"){return false}t=t.toUpperCase();if(e.tagName&&e.tagName===t){return e}else{if(e.parentElement||e===$editor){return inElement(e.parentElement,t)}else{return false}}};isFamily=function(e,t){var r,n;r=e.parentElement;n=t.parentElement;return e===t||r===t||n===e};findStylesParent=function(e){var t,r;t=e.tagName.toLowerCase();if(e.nodeType===1&&indexOf.call(styleTags,t)<0){return e}if(e.parentElement){t=e.parentElement.tagName;if(r=t.toLowerCase(),indexOf.call(styleTags,r)>=0){e=findStylesParent(e.parentElement)}else{e=e.parentElement}}return e};findTopElement=function(e){if(e.parentElement===$editor&&e.nodeType===1){return e}else if(inEditor(e.parentElement)){return findTopElement(e.parentElement)}return null};clearEmptyElements=function(e,t){var r,n,i,o,a,s;if(!e||!inEditor(e,true)){return}a=[];for(i=0,o=t.length;i<o;i++){s=t[i];n=e.querySelectorAll(s);a.push(function(){var t,i,o;o=[];for(i=0,t=n.length;i<t;i++){r=n[i];if(!r.innerHTML){o.push(e.removeChild(r))}else{o.push(void 0)}}return o}())}return a};toggleTextWrapper=function(e){var t,r,n;e=e.toLowerCase();n=new RegExp("<[/]?"+e+".*?>","ig");if(selectedNode.tagName===e.toUpperCase()){r=document.createElement("span");r.appendChild(selRange.cloneContents());t=r.innerHTML.replace(n,"");selRange.deleteContents();pasteHtmlAtCaret(t,true);return true}else{if(!isFamily(startRange.parentElement,endRange.parentElement)){console.info("Can not Wrapper text between different blocks.");return false}r=document.createElement(e);r.appendChild(selRange.cloneContents());r.innerHTML=r.innerHTML.replace(n,"");if(!r.innerHTML){return false}selRange.deleteContents();selRange.insertNode(r);setRange(r);return true}return false};getDisplayType=function(e){var t;t=e.currentStyle||window.getComputedStyle(e,"");return t.display};pasteHtmlAtCaret=function(e,t){var r,n,i,o,a,s,l,u;if(window.getSelection){u=window.getSelection();if(u.getRangeAt&&u.rangeCount>0){l=u.getRangeAt(0);l.deleteContents();r=document.createElement("div");r.innerHTML=e;i=document.createDocumentFragment();a=void 0;o=void 0;while(a=r.firstChild){o=i.appendChild(a)}n=i.firstChild;l.insertNode(i);if(o){l=l.cloneRange();l.setStartAfter(o);if(t){l.setStartBefore(n)}else{l.collapse(true)}u.removeAllRanges();u.addRange(l)}}}else if((u=document.selection)&&u.type!=="Control"){s=u.createRange();s.collapse(true);u.createRange().pasteHTML(e);if(t){l=u.createRange();l.setEndPoint("StartToStart",s);l.select()}}};removeInlineStyle=function(e){var t;t=new RegExp("(<[^>]+) style=[\"'].*?[\"']","ig");while(t.test(e)){e=e.replace(t,"$1")}return e};removeTag=function(e,t,r){var n,i;if(typeof t!=="string"){return}t=t.toLowerCase();n=new RegExp("<s*"+t+"(?:s+)*?[^>]*?>(.*?)</s*"+t+"s*>","ig");while(n.test(e)){e=e.replace(n,"$1")}if(r){i=new RegExp("(<"+t+"(?:s+)*?[^>]*?>)|(</s*"+t+"s*>)","ig");while(i.test(e)){e=e.replace(i,"")}}return e};placeCaretAfterNode=function(e){var t,r;if(typeof window.getSelection==="undefined"||!e.parentNode){return}t=document.createRange();t.setStartAfter(e);t.collapse(true);r=window.getSelection();r.removeAllRanges();return r.addRange(t)};wildClear=function(){var e,t,r,n,i,o,a,s;if(inEditor(selectedNode)){o=startRange.parentElement;t=endRange.parentElement;if(o!==t){n=getSameParent(o,t);i=n.point.childNodes;r=0;while(r<i.length){if(i[r].nodeType===1){a=false;if(i[r]===n.start||i[r]===n.end){if(s){a=false}else{s=true;a=s}}if(s){i[r].outerHTML="<div>"+i[r].innerText+"</dvi>"}s=a}r++}}else{e=testBlackList(selectedNode);if(e){e=e.outerHTML="<div>"+e.innerText+"</div>"}else{selectedNode.outerHTML="<div>"+selectedNode.innerText+"</div>"}}}else if(inEditor(selectedNode,true)){$editor.innerHTML=$editor.innerText}return historyManager.record()};getAllElementsFromSelection=function(){var e,t,r,n,i,o,a;a=selRange.commonAncestorContainer;if(a.nodeType===1){t=a.getElementsByTagName("*")}else{t=[a.parentNode]}e=[];n=0;r=void 0;for(i=0,o=t.length;i<o;i++){r=t[i];if(selObj.containsNode(r,true)&&r.nodeType===1){e.push(r)}n++}return e};getSameParent=function(e,t){var r,n;n=e;while(n!==null){r=findSibling(n.parentNode,t);if(r){return{point:n.parentNode,start:n,end:r}}else{n=n.parentNode}}return null};findSibling=function(e,t){var r;r=t;while(r!==null){if(r.parentNode===e){return r}r=r.parentNode}return false};testBlackList=function(e){if(!e||e===$editor){return false}if(BFBL.indexOf(e.tagName)>=0){return e}else{return testBlackList(e.parentElement)}};smartFormatBlock=function(e){var t;getCurrentSelection();if(inEditor(selectedNode,true)&&selectedOrigin.nodeType!==1){execFormatBlock(e,true);return historyManager.record()}else if(inEditor(selectedNode)){if(selectedNode.tagName!==e.toUpperCase()){t=testBlackList(selectedNode);if(t){if(t.innerText!==""){t.innerHTML="<"+e+">"+t.innerText+"</"+e+">";placeCaretAfterNode(t.childNodes[0])}}else{execFormatBlock(e)}}else{if(selectedNode.parentNode.tagName==="DIV"){execFormatBlock("div")}else{selectedNode.outerHTML=selectedNode.innerHTML;placeCaretAfterNode(selectedNode)}}return historyManager.record()}};execFormatBlock=function(e,t){if(typeof e!=="string"){return}if(inEditor(selectedNode)||t){e=e.toLowerCase();if(startRange.parentElement===endRange.parentElement){document.execCommand("formatBlock",false,e);return historyManager.record()}}};execCmd=function(e,t,r){getCurrentSelection();if(!inEditor(selectedNode,true)){return}t=Boolean(t);if(typeof r!=="string"){r=""}document.execCommand(e,t,r);return historyManager.record()};destroySpan=function(e,t){var r,n,i;r=e.childNodes;n=0;i=[];while(n<r.length){if(r[n].tagName==="SPAN"&&r[n].getAttribute("style")){r[n].outerHTML=r[n].innerHTML}else if(r[n].tagName==="BR"&&t){r[n].outerHTML=""}else{if(r[n].childNodes){destroySpan(r[n],t)}}i.push(n++)}return i};setKeyboard=function(e){var t;t=[];t["shift"]=false;t["enter"]=false;e.addEventListener("keydown",function(e){if(e.keyCode===16){t["shift"]=true}if(e.keyCode===8||e.keyCode===46||e.keyCode===17||e.keyCode===91||e.keyCode===88){historyManager.record()}if(e.keyCode===13){t["enter"]=true;historyManager.record()}if(t["shift"]&&t["enter"]){e.preventDefault();return pasteHtmlAtCaret("<br>")}});e.addEventListener("keyup",function(e){if(e.keyCode===16){t["shift"]=false}if(e.keyCode===13){t["enter"]=false}})};getSelectionHtml=function(e){var t,r,n,i,o;r="";if(typeof window.getSelection!=="undefined"){o=window.getSelection();if(!e){if(o.rangeCount){t=document.createElement("div");n=0;i=o.rangeCount;while(n<i){t.appendChild(o.getRangeAt(n).cloneContents());++n}r=t.innerHTML}}else{r=o.toString()}}else if(typeof document.selection!=="undefined"){if(document.selection.type==="Text"){r=document.selection.createRange().htmlText}}return r};historyManager={redo:function(){if($history_step<$history.length-1){$history_step++;return $editor.innerHTML=$history[$history_step]}},undo:function(){if($history_step>0){$history_step--;return $editor.innerHTML=$history[$history_step]}},reset:function(){$history=[$editor.innerHTML];return $history_step=0},record:function(){if($editor.innerHTML===$history[$history_step||0]){return}if(typeof $history_step!=="number"){$history_step=0}else{$history_step++}if($history.length>=$history_step+1){$history.length=$history_step+1}if($history_step>=$options.history-1){$history_step=$options.history-1;$history.shift()}return $history.push($editor.innerHTML)}};log=function(e){var t;console.info("---------------------------");console.info("SAW Editor Log: ("+$property.name+")");for(t in arguments){if(arguments.hasOwnProperty(t)){console.info(arguments[t])}}return console.info("---------------------------")};error=function(e){var t;console.info("---------------------------");console.info("SAW Editor Error: ("+$property.name+")");for(t in arguments){if(arguments.hasOwnProperty(t)){console.error(arguments[t])}}return console.info("---------------------------")};assertParam=function(e,t,r){var n;if(!r){r=""}if(!t){t="string"}n=typeof e===t?e:r;return n};isJsonString=function(e){var t;try{JSON.parse(e)}catch(e){t=e;return false}return true};mergeJSON=function(e,t){var r,n;n=Object.create(t);for(r in e){if(n.hasOwnProperty(r)){if(e[r]!==null&&e[r].constructor===Object){n[r]=zrd3.utils.mergeJSON(e[r],n[r])}}else{n[r]=e[r]}}return n};createToolbarBtns=function(e){var t,r,n,i,o,a,s,l,u;t=e.getAttribute("toolbar-btns");if(!t){return e}l=t.replace(/'/g,'"');if(isJsonString(l)){l=JSON.parse(l)}if(typeof l!=="object"||!l.length||l.length===0){l=defaultToolbarBtns}i=0;while(i<l.length){n=document.createElement("div");a=0;while(a<l[i].length){u=l[i][a];if(e.querySelector(".btn-"+u)){a++;continue}r=document.createElement("button");r.className="btn btn-"+u;o=void 0;for(s in btnList){if(btnList[s].name===u){o=btnList[s].ico;break}}if(o){r.innerHTML='<i class="ico-'+o+'"></i>'}else{r.innerHTML=u.toUpperCase()}n.appendChild(r);a++}if(n.childNodes.length>1){n.className="btn-group";e.appendChild(n)}else{n=null}i++}return e};dispatchSAWEvent=function(){var e;if(!$editor){return}e=new Event("saw");return $editor.dispatchEvent(e)};baseEventHanlder=function(e){return dispatchSAWEvent()};evtManager={register:function(e,t,r){if(typeof r!=="string"){r="click"}if(typeof e==="object"){e.addEventListener(r,t);e.addEventListener(r,baseEventHanlder)}},remove:function(e,t,r){if(typeof r!=="string"){r="click"}if(typeof e==="object"){if(typeof t==="function"){e.removeEventListener(r,t);e.removeEventListener(r,baseEventHanlder)}}}};resetCurrentMedia=function(){$currentImage={link:void 0,element:void 0};$currentVideo={element:void 0};return $currentAudio={element:void 0}};resetCurrentLink=function(){return $currentLink={element:void 0}};doInsertImg=function(e){var t,r,n,i,o,a,s,l;a=assertParam(e.src);t=assertParam(e.title);i=assertParam(e.href);s=assertParam(e.target);r=assertParam(e.class);if(r){n='class="'+r+'"'}else{n=""}if(i){if(s){l='target="'+s+'"'}else{l=""}o="<a "+n+" "+l+' href="'+i+'">'+'<img src="'+a+'" alt="'+t+'"></a>'}else{o="<img "+n+' src="'+a+'" alt="'+t+'" />'}return o};doReplaceImg=function(e){var t,r,n,i,o,a,s,l;o=$currentImage.element;if(!o||!e){return}a=assertParam(e.src);t=assertParam(e.title);i=assertParam(e.href);s=assertParam(e.target);r=assertParam(e.class);if(a){o.setAttribute("src",a);o.removeAttribute("ng-src")}if(t){o.setAttribute("alt",t)}if(i){if($currentImage.link){$currentImage.link.setAttribute("href",i);$currentImage.link.removeAttribute("ng-href");if(s){$currentImage.link.setAttribute("target",s)}else{$currentImage.link.removeAttribute("target")}if(r){$currentImage.link.setAttribute("class",r)}else{$currentImage.link.removeAttribute("class")}}else{if(s){l='target="'+s+'"'}else{l=""}if(r){n='class="'+r+'"'}else{n=""}o.outerHTML="<a "+n+" "+l+' href="'+i+'">'+'<img src="'+a+'" alt="'+t+'"></a>'}}else{if($currentImage.link){$currentImage.link.outerHTML=$currentImage.link.innerHTML}if(r){o.setAttribute("class",r)}else{o.removeAttribute("class")}}return o};doInsertVideo=function(e){var t,r,n,i,o,a,s,l;l=assertParam(e.src);s=assertParam(e.poster);i=e.controls?"controls":"";a=e.loop?"loop":"";t=e.autoplay?"autoplay":"";r=assertParam(e.class);if(r){n='class="'+r+'"'}else{n=""}o="<video "+a+" "+t+" "+i+" "+n+" "+'src="'+l+'" '+' poster="'+s+'" preload="none"></video>';return o};doReplaceVideo=function(e){var t,r,n,i,o,a,s;s=$currentVideo.element;if(!s||!e){return}a=assertParam(e.src);o=assertParam(e.poster);n=e.controls?"controls":"";i=e.loop?"loop":"";t=e.autoplay?"autoplay":"";r=assertParam(e.class);if(a){s.setAttribute("src",a);s.removeAttribute("ng-src")}if(r){s.setAttribute("class",r)}else{s.removeAttribute("class")}if(o){s.setAttribute("poster",o)}else{s.removeAttribute("poster")}if(n){s.setAttribute("controls",true)}else{s.removeAttribute("controls")}if(i){s.setAttribute("loop",true)}else{s.removeAttribute("loop")}if(t){s.setAttribute("autoplay",true)}else{s.removeAttribute("autoplay")}return s};doInsertAudio=function(e){var t,r,n,i,o,a,s;s=assertParam(e.src);i="controls";a=e.loop?"loop":"";t=e.autoplay?"autoplay":"";r=assertParam(e.class);if(r){n='class="'+r+'"'}else{n=""}o="<audio "+a+" "+t+" "+i+" "+n+" "+'src="'+s+'"></audio>';return o};doReplaceAudio=function(e){var t,r,n,i,o,a;t=$currentAudio.element;if(!t||!e){return}a=assertParam(e.src);i=e.controls?"controls":"";o=e.loop?"loop":"";r=e.autoplay?"autoplay":"";n=assertParam(e.class);if(a){t.setAttribute("src",a);t.removeAttribute("ng-src")}if(n){t.setAttribute("class",n)}else{t.removeAttribute("class")}if(i){t.setAttribute("controls",true)}else{t.removeAttribute("controls")}if(o){t.setAttribute("loop",true)}else{video.removeAttribute("loop")}if(r){t.setAttribute("autoplay",true)}else{t.removeAttribute("autoplay")}return t};execInsertMedia=function(e){var t;if(!savedRange||!e){return}if(e.type==="video"){t=doInsertVideo(e)}else if(e.type==="audio"){t=doInsertAudio(e)}else{t=doInsertImg(e)}restoreSelection(savedRange);pasteHtmlAtCaret(t);watcher();historyManager.record();return dispatchSAWEvent()};execRemoveMedia=function(e){var t,r;if(e.type==="video"){r=$currentVideo.element;t=null}else if(e.type==="audio"){r=$currentAudio.element;t=null}else{r=$currentImage.element;t=$currentImage.link}if(!r){return}r.outerHTML="";if(t){t.outerHTML=""}resetCurrentMedia();historyManager.record();return dispatchSAWEvent()};execReplaceMedia=function(e){var t;if(e.type==="video"){t=doReplaceVideo(e)}else if(e.type==="audio"){t=doReplaceAudio(e)}else{t=doReplaceImg(e)}resetCurrentMedia();historyManager.record();return dispatchSAWEvent()};execInsertLink=function(e){var t,r,n,i,o,a,s;if(!savedRange||!e){return}i=assertParam(e.href);a=assertParam(e.target);r=assertParam(e.class);restoreSelection(savedRange);if(savedRange.endOffset>0){execCmd("createLink",false,i);getCurrentSelection();t=selectedNode;if(t.tagName==="A"){if(a){t.setAttribute("target",a)}if(r){t.setAttribute("class",r)}}}else{if(a){s='target="'+a+'"'}else{s=""}if(r){n='class="'+r+'"'}else{n=""}o="<a "+n+" "+s+' href="'+i+'">'+i+"</a>";pasteHtmlAtCaret(o)}watcher();historyManager.record();return dispatchSAWEvent()};execReplaceLink=function(e){var t,r,n,i;t=$currentLink.element;if(!t||!e){return}n=assertParam(e.href);i=assertParam(e.target);r=assertParam(e.class);restoreSelection(savedRange);t.removeAttribute("ng-href");if(n){t.setAttribute("href",n)}if(r){t.setAttribute("class",r)}else{t.removeAttribute("class")}if(i){t.setAttribute("target",i)}else{t.removeAttribute("target")}resetCurrentLink();watcher();historyManager.record();return dispatchSAWEvent()};execRemoveLink=function(){var e;e=$currentLink.element;if(!e){return}e.outerHTML=e.innerHTML;resetCurrentLink();historyManager.record();return dispatchSAWEvent()};execInsertPreset=function(e){var t,r;if(!savedRange||!e){return}if(typeof e.code!=="string"){e.code=""}restoreSelection(savedRange);r=document.createElement("div");r.setAttribute("preset-id",Date.now());r.innerHTML=e.code;t=findTopElement(selectedNode);if(t&&t.nextSibling){$editor.insertBefore(r,t.nextSibling)}else{$editor.appendChild(r)}watcher();historyManager.record();return dispatchSAWEvent()};execInsertScript=function(e){if(!savedRange||!e){return}if(typeof e!=="string"){e=""}restoreSelection(savedRange);pasteHtmlAtCaret(e);watcher();historyManager.record();return dispatchSAWEvent()};init_editor=function(e,t,r){var n;load_options(r);$document=document;if(typeof e==="string"&&e!==""){$editor=$document.querySelector("[name="+e+"]")}else if(isHTMLElement(e)){$editor=e}if(!$editor){return error("Init editor failed !!")}if(!$options.nontoolbar){if(typeof t==="string"&&t!==""){$toolbar=$document.querySelector("[name="+t+"]")}else if(isHTMLElement(t)){$toolbar=t}if(!$toolbar){return error("Init toolbar failed !!")}}if(typeof $options.history!=="number"){n=$options.history>0?parseInt($options.history):100;$options.history=Math.max(n,999)}$editor.setAttribute("contenteditable","true");if($toolbar){$toolbar=createToolbarBtns($toolbar)}$property.order=parseInt($editor.getAttribute("order"))||0;$property.name=$editor.getAttribute("name")||now;$editor.addEventListener("mouseup",selectHandler);$editor.addEventListener("mousedown",focusHandler);if($toolbar){$toolbar.addEventListener("mousedown",focusHandler)}$editor.addEventListener("keyup",selectHandler);window.addEventListener("mouseup",selectHandler);$document.addEventListener("click",selectHandler);window.addEventListener("mousedown",blurHandler);set_toolbar();setKeyboard($editor);historyManager.record();console.info("supAngularWysiwyg("+ver+"): inited")};destroy_editor=function(){$editor.removeEventListener("mouseup",selectHandler);$editor.removeEventListener("mousedown",focusHandler);if($toolbar){$toolbar.removeEventListener("mousedown",focusHandler)}$editor.removeEventListener("keyup",selectHandler);window.removeEventListener("mouseup",selectHandler);$document.removeEventListener("click",selectHandler);window.removeEventListener("mousedown",blurHandler);unset_toolbar();console.info("supAngularWysiwyg: destroyed")};set_toolbar=function(){var i,obj,results;if(!$toolbar){return}i=0;results=[];while(i<btnList.length){obj=$toolbar.querySelector(".btn-"+btnList[i].name);if(obj){if(btnList[i].name==="indent"){$btn_indent=obj}if(btnList[i].name==="outdent"){$btn_outdent=obj}evtManager.register(obj,eval(btnList[i].handler))}results.push(i++)}return results};unset_toolbar=function(){var i,obj,results;if(!$toolbar){return}i=0;results=[];while(i<btnList.length){obj=$toolbar.querySelector(".btn-"+btnList[i].name);if(obj){evtManager.remove(obj,eval(btnList[i].handler))}results.push(i++)}return results};load_options=function(e){var t;if(typeof e==="string"){e=e.replace(/'/g,'"');try{e=JSON.parse(e)}catch(r){t=r;e={}}}if(!e||typeof e!=="object"){e={}}$options=mergeJSON(e,$options);return $options||{}};get_options=function(){return $options};set_insert_link_hook=function(e){if(typeof e==="function"){return insertLinkHook=e}else{return false}};set_edit_link_hook=function(e){if(typeof e==="function"){return editLinkHook=e}else{return false}};set_edit_media_hook=function(e){if(typeof e==="function"){return editMediaHook=e}else{return false}};set_insert_media_hook=function(e){if(typeof e==="function"){return insertMediaHook=e}else{return false}};set_insert_preset_hook=function(e){if(typeof e==="function"){return insertPresetHook=e}else{return false}};set_insert_script_hook=function(e){if(typeof e==="function"){return insertScriptHook=e}else{return false}};set_focus_hook=function(e){if(typeof e==="function"){return focusHook=e}else{return false}};set_blur_hook=function(e){if(typeof e==="function"){return blurHook=e}else{return false}};set_html_on_open_hook=function(e){if(typeof e==="function"){return openHTMLHook=e}else{return false}};set_html_on_close_hook=function(e){if(typeof e==="function"){return closeHTMLHook=e}else{return false}};get_property=function(){return $property};get_name=function(){return $property.name};get_order=function(){return $property.order};methods={version:ver,init:init_editor,destroy:destroy_editor,property:get_property,name:get_name,order:get_order,options:get_options,hooks:{insert_link:set_insert_link_hook,edit_link:set_edit_link_hook,insert_media:set_insert_media_hook,edit_media:set_edit_media_hook,insert_preset:set_insert_preset_hook,insert_script:set_insert_script_hook,focus:set_focus_hook,blur:set_blur_hook,html_on_open:set_html_on_open_hook,html_on_close:set_html_on_close_hook},insertMedia:execInsertMedia,replaceMedia:execReplaceMedia,removeMedia:execRemoveMedia,insertLink:execInsertLink,replaceLink:execReplaceLink,removeLink:execRemoveLink,insertPreset:execInsertPreset,insertScript:execInsertScript};return methods};angular.module("supAngularWysiwyg",[]).directive("supAngularWysiwyg",["$rootScope","$interpolate","$timeout",function(e,t,r){return{restrict:"EA",require:"?ngModel",scope:{toolbar:"@",options:"@",skipIframe:"@",presets:"=",default:"@"},link:function(n,i,o,a){var s,l,u,c,d,f,p,m,g,h,y,v,b,$,k;if(!a){return}c=new supWysiwygEditor;f="sup-editor";d=i[0];if(o.name){f=o.name}if(!n.toolbar){k=f+"-toolbar"}try{g=n.options.replace(/'/g,'"');g=JSON.parse(g)}catch(e){u=e;g={}}y=[];if(angular.isArray(n.presets)){b=n.presets;for(p=0,m=b.length;p<m;p++){h=b[p];y.push({preview:h.preview,code:h.code})}}$=e;if(!n.skipIframe&&window.parent&&parent.document!==document){$=parent.angular.element(parent.document).scope();k=parent.document.querySelector("[name="+k+"]")}r(function(){return c.init(d,k,g)},0);c.hooks.insert_link(function(){return $.$emit("saw.insert_link",c)});c.hooks.edit_link(function(e){return $.$emit("saw.edit_link",c,e)});c.hooks.insert_media(function(){return $.$emit("saw.insert_media",c)});c.hooks.edit_media(function(e){return $.$emit("saw.edit_media",c,e)});c.hooks.insert_preset(function(){return $.$emit("saw.insert_preset",c,y)});c.hooks.insert_script(function(){return $.$emit("saw.insert_script",c)});c.hooks.focus(function(){return $.$emit("saw.focus",c)});c.hooks.blur(function(){return $.$emit("saw.blur",c)});c.hooks.html_on_open(function(){return $.$emit("saw.html.open",c,a.$viewValue)});c.hooks.html_on_close(function(){return $.$emit("saw.html.close",c,a.$viewValue)});e.$emit("saw.complete",c);if($!==e){$.$emit("saw.complete",c)}l=false;if(n.default){s=n.default}else{s=t(i.html())(e)}v=function(){var e;e=i.html();if(e==="<br>"){e=""}return a.$setViewValue(e)};a.$render=function(){var e;if(!a.$viewValue&&!l){i.html(s);e=r(function(){v();return r.cancel(e)},0)}else{i.html(a.$viewValue||"")}return l=true};i.on("blur keyup change mousedown cut paste saw",function(e){v();e.stopPropagation()});return n.$on("$destroy",function(){return c.destroy()})}}}])}).call(this);(function(){angular.module("boltApp").config(["$sceDelegateProvider",function(e){return e.resourceUrlWhitelist(["self","http://**.soopro.io/**"])}])}).call(this);(function(){var e=[].indexOf;angular.module("boltApp").filter("trust",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("url",["$rootScope",function(e){return function(t,r,n){var i;if(typeof t!=="string"){return t}if(r){i=t.indexOf("?");if(i>-1){t=t.substring(0,i)}}if(n){i=t.indexOf("#");if(i>-1){t=t.substring(0,i)}}if(!t||angular.isUrl(t)){return t}else if(angular.startswith(t,"/")){return e.base_url+t.replace(/(^\/)|(\/$)/g,"")}else{return t.replace(/\/$/g,"")}}}]).filter("path",["$rootScope",function(e){return function(t,r,n){var i,o,a;if(typeof t!=="string"){return t}if(r||r===void 0){o=t.indexOf("?");if(o>-1){t=t.substring(0,o)}}if(n||n===void 0){o=t.indexOf("#");if(o>-1){t=t.substring(0,o)}}try{a=t.split(e.base_url).pop()}catch(e){i=e;a=t}return"/"+a.replace(/^\//g,"").replace(/\/$/g,"")}}]).filter("active",["$rootScope",function(e){return function(e,t,r,n){var i;if(r===void 0){r="active"}if(n===void 0){n=""}if(!angular.isObject(e)||!angular.isString(t)){return n}if(t===e.path){return r}else if(e.path_scope){i=angular.strip(e.path_scope,"/");if(angular.startswith(t,"/"+i+"/")){return r}}return n}}]).filter("args",function(){return function(e,t){if(typeof e!=="string"){return{}}return angular.getURLParams(e,t)}}).filter("join",function(){return function(e,t){if(angular.isArray(e)){if(!t){t=", "}return e.join(t)}else{return e}}}).filter("striptags",function(){return function(e){return String(e).replace(/<[^>]+>/gm,"")}}).filter("int",function(){return function(e){try{e=parseInt(e)}catch(t){e=null}return e}}).filter("string",function(){return function(e){var t;try{t=e.toString()}catch(e){t=""}return t}}).filter("date_formatted",["$filter","$rootScope",function(e,t){return function(r,n){var i,o,a,s;if(!r){return""}if(typeof n!=="string"){n=null}o={en:"MMMM d, yyyy",zh:"yyyy年 MM月 dd日"};try{s=t.locale;a=t.lang||s.split("_")[0]}catch(e){s=null;a=null}i=n||o[s]||o[a]||null;if(!i){return r}else{return e("date")(r,i)}}}]).filter("col_offset",function(){return function(t,r,n,i){var o,a,s;i=angular.parse_int(i,12,0);n=angular.parse_int(n,4,true);if(angular.isString(r)){if(e.call(r,"{}")<0){r+="{}"}}else{r=null}if(angular.isArray(t)){o=t.length}else{o=angular.parse_int(t,0,0)}a=Math.floor((i-o*n)/2);if(r){if(a>0){s=r.replace("{}",a)}else{s=""}}else{s=a}return s}})}).call(this);(function(){var e=[].indexOf;angular.module("boltApp").directive("editorCanvas",["$compile",function(t){return{restrict:"AE",scope:{},controller:["$scope","$rootScope","$element","$compile","$interval","$timeout","supLocales",function(t,r,n,i,o,a,s){var l,u,c,d,f,p,m,g,h,y,v,b,$;if(typeof angular.translate==="function"){t._=angular.translate}if(window.parent){v=parent.angular.element(parent.document).scope()}else{v=r}$=v.station;if(!$){console.info("Canvas must running in an iframe.");return}d=$.editor_context;y=$.restEditor;t.g={};t.query={};f=d.metas;t.base_url=r.base_url=f.base_url;t.theme_url=r.theme_url=f.theme_url;t.libs_url=r.libs_url=f.libs_url;t.locale=r.locale=f.locale;t.lang=r.lang=f.lang;t.site_meta=f.site_meta;t.theme_meta=f.theme_meta;t.menu=f.menu;t.taxonomy=f.taxonomy;t.content_types=f.content_types;t.translates=f.translates;t.socials=f.socials;t.slot=f.slot;t.visit=d.visit;c=function(e,r){$.display_canvas(false);return y.tpl.get({app_slug:e,tmpl_slug:r},function(e){var r,o;s.load(d.app.locale,e.localized_dict);n.html(e.tpl);r=i(n.contents());r(t);t.g={};t.query={};return o=a(function(){var e;try{return $.display_canvas(true)}catch(t){e=t;return console.error(e)}},600)})};g=null;t.$watch("file.template",function(e){if(g===e||!e){return}c(d.app.slug,e);return g=e});t.file=$.file;t.$watch("file",function(e){t.content=e.content;t.meta=e.meta||{};t.meta.id=e.id;t.meta.url=e.url;t.meta.path=e.path;t.meta.priority=e.priority;t.meta.parent=e.parent;t.meta.type=t.meta.content_type=e.content_type;t.meta.status=e.status;t.meta.updated=e.updated;t.meta.created=e.created;t.meta.date=e.date;t.meta.template=e.template;t.meta.tags=e.tags;return t.meta.taxonomy=e.taxonomy},true);t.$watch("content",function(e){return t.file.content=e});h=o(function(){},300);m={};l=function(e){var t,r,n;if(typeof e==="number"){e=[e]}for(r=0,n=e.length;r<n;r++){t=e[r];if(!m[t]){return false}}return true};n.on("keydown keyup",function(t){var r,n,i;n=[17,27];if(i=t.keyCode,e.call(n,i)>=0){r=t.type==="keydown";if(m[t.keyCode]===r){return}m[t.keyCode]=r;if(l(n)){return p()}}});p=function(){var e;e=!r.escape;$.switch_sidebar(!e);r.escape=e;return console.info("Editor: escape "+e)};b=[];u=r.$on("saw.complete",function(e,t){if(typeof t.destroy==="function"){return b.push(t)}});return t.$on("$destroy",function(){var e,t,r;for(e=0,t=b.length;e<t;e++){r=b[e];r.destroy()}u();return o.cancel(h)})}]}}]).directive("supQuery",["$rootScope",function(e){return{scope:{attrs:"=",sortby:"=",perpage:"=",paged:"=",priority:"=",taxonomy:"=",withContent:"="},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var o,a,s,l,u,c,d,f,p,m,g,h,y,v,b;if(!i){return}d=6;v=document.querySelectorAll("[sup-query]");for(l=u=0,c=v.length;u<c;l=++u){g=v[l];if(l>d){console.error("Query overrun.",r[0]);return}}if(window.parent){p=parent.angular.element(parent.document).scope()}else{p=e}y=p.station;if(!y){return}a=y.editor_context.app;f=y.restEditor;if(n.supQuery){h=n.supQuery;if(h.indexOf("[")>=0||h.indexOf("{")>=0){try{o=t.$eval(n.supQuery);if(!angular.isObject(o)){throw true}}catch(e){o=null}}o=o?o:{type:h};m=angular.list(o)}else{m=null}if(b){b={slug:b.slug,term:b.term}}else{b={}}s={attrs:angular.list(t.attrs,m),sortby:angular.list(t.sortby),perpage:angular.parse_int(t.perpage),paged:angular.parse_int(t.paged),priority:angular.bool(t.priority),taxonomy:b,with_content:angular.bool(t.withContent)};return f.doEditorQuery(a.id,s).then(function(e){return i.$setViewValue(e)})}}}]).directive("supQuerySides",["$rootScope",function(e){return{scope:{pid:"=",attrs:"=",sortby:"=",limit:"=",priority:"=",taxonomy:"="},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var o,a,s,l,u,c,d,f,p,m,g,h,y,v,b;if(!i){return}d=3;v=document.querySelectorAll("[sup-query-sides]");for(l=u=0,c=v.length;u<c;l=++u){g=v[l];if(l>d){console.error("Query overrun.",r[0]);return}}if(window.parent){p=parent.angular.element(parent.document).scope()}else{p=e}y=p.station;if(!y){return}if(!t.pid){t.pid=y.file.id}a=y.editor_context.app;f=y.restEditor;if(n.supQuerySides){h=n.supQuerySides;if(h.indexOf("[")>=0||h.indexOf("{")>=0){try{o=t.$eval(n.supQuery);if(!angular.isDict(o)){throw true}}catch(e){o=null}}if(!o){o={type:h}}m=angular.list(o)}else{m=null}if(b){b={slug:b.slug,term:b.term}}else{b={}}s={pid:t.pid,attrs:angular.list(t.attrs)||m||[],sortby:angular.list(t.sortby),limit:angular.parse_int(t.limit,1,true),priority:angular.bool(t.priority),taxonomy:b};return f.doEditorQuerySides(a.id,s).then(function(e){return i.$setViewValue(e)})}}}]).directive("supScriptLoader",["config",function(e){return{restrict:"AE",replace:true,compile:function(e,t){var r;if(!t.src||typeof t.src!=="string"){return}r=document.createElement("script");r.setAttribute("ng-src","{{'"+t.src+"'}}");return e.append(r)}}}]).directive("supSet",[function(){return{scope:{value:"@",object:"="},restrict:"AE",require:"?ngModel",link:function(e,t,r,n){if(!n){return}n.$setViewValue(e.object||e.value);return n.$render=function(){return n.$setViewValue(e.object||e.value)}}}}]).directive("supBindHtml",function(){return{restrict:"A",compile:function(){return function(e,t,r){return e.$watch(r.supBindHtml,function(e){return t.html(e||"")})}}}}).directive("supTempalte",[function(){return{scope:{id:"@"},restrict:"E",transclude:true,replace:true,template:['<script type="text/ng-template" id="{{id}}">',"<ng-transclude></ng-transclude>","<\/script>"].join("")}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetBg",["$rootScope",function(e){return{scope:{allowTypes:"@",presets:"="},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var o,a;if(!i){return}if(window.parent){o=parent.angular.element(parent.document).scope()}else{o=e}a=o.station;if(!a){return}t.options={allow_types:t.allowTypes||n.supWidgetBg,presets:t.presets};r.on("mousedown",function(e){if(e.target!==r[0]){return}a.$emit("widget.update_bg",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetAttrs",["$rootScope",function(e){return{scope:{structure:"="},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var o,a,s,l,u,c,d;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}c=u.station;if(!c){return}o={};if(angular.isArray(t.structure)){l=t.structure;for(a=0,s=l.length;a<s;a++){d=l[a];if(d.key&&"default"in d){o[d.key]=d.default}}}t.options={structure:t.structure};r.on("mousedown",function(e){c.$emit("widget.update_attrs",t);return e.stopPropagation()});t.update=function(e){t.data=e||o;i.$setViewValue(t.data);return i.$render()};r.on("$destroy",function(){i.$render=angular.noop;if(angular.equals(i.$viewValue,o)){return i.$setViewValue(null)}});return i.$render=function(){if(!angular.isDict(i.$viewValue)){i.$setViewValue(o)}return t.data=i.$viewValue}}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetLink",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var o,a;if(!i){return}if(window.parent){o=parent.angular.element(parent.document).scope()}else{o=e}a=o.station;if(!a){return}t.options={figure:Boolean("figure"in n||n.supWidgetLink==="figure"),lite:Boolean("lite"in n)};r.on("mousedown",function(e){a.$emit("widget.update_link",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetCarousel",["$rootScope",function(e){return{scope:{default:"@",allowTypes:"@",limit:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var o,a,s,l,u,c,d,f;if(!i){return}if(window.parent){d=parent.angular.element(parent.document).scope()}else{d=e}f=d.station;if(!f){return}try{o=t.$eval(t.default);s=[];for(u=0,c=o.length;u<c;u++){a=o[u];s.push({title:a.title||"",src:a.src||"",type:a.type||"image",link:"#",target:"",caption:a.caption||"",misc:a.misc||""})}}catch(e){l=e;s=[]}if(!angular.isArray(s)){s=[]}t.options={allow_types:t.allowTypes||n.supWidgetCarousel,limit:t.limit};r.on("mousedown",function(e){f.$emit("widget.update_carousel",t);return e.stopPropagation()});t.update=function(e){if(!e||e.length===0){e=null}t.data=e||s;i.$setViewValue(t.data);return i.$render()};r.on("$destroy",function(){i.$render=angular.noop;if(angular.equals(i.$viewValue,s)){return i.$setViewValue(null)}});return i.$render=function(){if(!angular.isArray(i.$viewValue)){i.$setViewValue(s)}return t.data=i.$viewValue}}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetCreate",["$rootScope",function(e){return{scope:{type:"@",template:"@"},restrict:"AE",link:function(t,r,n){var i,o,a;if(window.parent){o=parent.angular.element(parent.document).scope()}else{o=e}a=o.station;if(!a||!a.create_file){return}i="segment"in n;return r.on("mousedown",function(e){a.create_file(t.type,t.template,i);return e.stopPropagation()})}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetForm",["$rootScope",function(e){return{scope:{limit:"@",optLimit:"@",submitTypes:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var o,a;if(!i){return}if(window.parent){o=parent.angular.element(parent.document).scope()}else{o=e}a=o.station;if(!a){return}t.options={limit:t.limit,opt_limit:t.optLimit,submit_types:t.submitTypes};r.on("mousedown",function(e){a.$emit("widget.update_form",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetLines",["$rootScope",function(e){return{scope:{default:"@",limit:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var o,a,s,l,u,c,d,f;if(!i){return}if(window.parent){c=parent.angular.element(parent.document).scope()}else{c=e}d=c.station;if(!d){return}try{o=t.$eval(t.default);a=[];for(l=0,u=o.length;l<u;l++){f=o[l];if(angular.isString(f)&&f){a.push({text:f})}else if(angular.isDict(f)&&f.text){a.push({text:f.text})}}}catch(e){s=e;a=[]}if(!angular.isArray(a)){a=[]}t.options={limit:t.limit};r.on("mousedown",function(e){d.$emit("widget.update_lines",t);return e.stopPropagation()});t.update=function(e){t.data=e||a;i.$setViewValue(t.data);return i.$render()};r.on("$destroy",function(){i.$render=angular.noop;if(angular.equals(i.$viewValue,a)){return i.$setViewValue(null)}});return i.$render=function(){if(!angular.isArray(i.$viewValue)){i.$setViewValue(a)}return t.data=i.$viewValue}}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetMedia",["$rootScope",function(e){return{scope:{allowTypes:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var o,a;if(!i){return}if(window.parent){o=parent.angular.element(parent.document).scope()}else{o=e}a=o.station;if(!a){return}t.options={allow_types:t.allowTypes||n.supWidgetMedia,lite:Boolean("lite"in n)};r.on("mousedown",function(e){a.$emit("widget.update_media",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetOpen",["$rootScope",function(e){return{scope:{supWidgetOpen:"=",file:"="},restrict:"AE",link:function(t,r,n){var i,o;if(window.parent){i=parent.angular.element(parent.document).scope()}else{i=e}o=i.station;if(!o||!o.open_file){return}return r.on("mousedown",function(e){o.open_file(t.file||t.supWidgetOpen);return e.stopPropagation()})}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetScript",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var o,a;if(!i){return}if(window.parent){o=parent.angular.element(parent.document).scope()}else{o=e}a=o.station;if(!a){return}r.on("mousedown",function(e){a.$emit("widget.update_script",t);return e.stopPropagation()});t.update=function(e){t.data=e||"";i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetSegments",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"ngModel",controller:["$scope",function(e){this.$editSegment=function(t){return e.edit(t)};this.$createSegment=function(t){return e.create(t)};return this}],link:function(t,r,n,i){var o,a,s,l,u,c,d;if(window.parent){l=parent.angular.element(parent.document).scope()}else{l=e}u=l.station;if(!u){return}o=u.editor_context.app;d=u.editor_context.metas.segments;s=u.restEditor;t.data=[];c=function(e){var t;if(!e||!e.length){return}t=angular.element(r[0].querySelector("[segment-create]"));if(e.length>=d){return t.addClass("ng-hide")}else{return t.removeClass("ng-hide")}};a=function(){return s.segments.query({app_id:o.id}).$promise.then(function(e){c(e);i.$setViewValue(e);return t.data=i.$viewValue})};a();t.refresh=function(){return a()};t.edit=function(e){if(!t.data[e]){return}return u.open_file(t.data[e])};return t.create=function(e){return u.create_file("page",e,true)}}}}]).directive("segment",[function(){return{scope:false,restrict:"A",require:"?^supWidgetSegments",link:function(e,t,r,n){if(!n){return}return t.on("mousedown",function(t){if(!angular.isNumber(e.$index)){return}n.$editSegment(e.$index);return t.stopPropagation()})}}}]).directive("segmentCreate",[function(){return{scope:{template:"@"},restrict:"A",require:"?^supWidgetSegments",link:function(e,t,r,n){if(!n){return}return t.on("mousedown",function(t){n.$createSegment(e.template);return t.stopPropagation()})}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetSeries",["$rootScope",function(e){return{scope:{default:"@",allowTypes:"@",limit:"@"},restrict:"AE",require:"ngModel",controller:["$scope",function(e){this.$editSeriesItem=function(t){return e.edit(t)};this.$createSeriesItem=function(){return e.create()};return this}],link:function(t,r,n,i){var o,a,s,l,u,c,d,f,p,m,g,h,y;if(window.parent){h=parent.angular.element(parent.document).scope()}else{h=e}y=h.station;if(!y){return}try{o=t.$eval(t.default);u=[];for(d=0,p=o.length;d<p;d++){f=o[d];u.push({src:f.src||"",type:f.type||"image",title:f.title||"",caption:f.caption||"",link:"",target:"",class:"",poster:f.poster||"",misc:f.misc||"",tags:f.tags||[]})}}catch(e){c=e;u=[]}if(!angular.isArray(u)){u=[]}t.options={allow_types:t.allowTypes||n.supWidgetSeries};t.item=null;l=null;m=Math.min(angular.parse_int(t.limit,24,true),24);a=function(e){var t,n;t=r[0].querySelector("[series-item-create]");if(!e||!t){return}n=angular.element(t);if(e.length>=m){n.addClass("ng-hide");if(e.length>m){return e.length=m}}else{return n.removeClass("ng-hide")}};g=function(e){var r;if(!angular.isObject(e)||e.deleted){return t.data.splice(l,1)}else if(angular.isNumber(e._index)){t.data[l]=e;r=e._index;return angular.list_shift(t.data,l,r,false)}};s=function(e){var r;if(angular.isObject(e)){t.data.push(e)}l=t.data.length-1;if(e._index){r=e._index;return angular.list_shift(t.data,l,r,false)}};t.edit=function(e){if(!angular.isNumber(e)){return}l=e;t.item=t.data[e]||{};t.item._index=e;return y.$emit("widget.update_series",t)};t.create=function(){l=null;t.item=null;return y.$emit("widget.update_series",t)};t.update=function(e){var r,n,i;if(angular.isNumber(l)){g(e)}else{s(e)}t.item=null;l=null;i=t.data;for(r=0,n=i.length;r<n;r++){e=i[r];delete e._index}return a(t.data)};r.on("$destroy",function(){i.$render=angular.noop;if(angular.equals(i.$viewValue,u)){return i.$setViewValue(null)}});return i.$render=function(){if(!angular.isArray(i.$viewValue)){i.$setViewValue(u)}t.data=i.$viewValue;return a(t.data)}}}}]).directive("seriesItem",[function(){return{scope:false,restrict:"A",require:"?^supWidgetSeries",link:function(e,t,r,n){if(!n){return}return t.on("mousedown",function(t){if(!angular.isNumber(e.$index)){return}n.$editSeriesItem(e.$index);return t.stopPropagation()})}}}]).directive("seriesItemCreate",[function(){return{scope:false,restrict:"A",require:"?^supWidgetSeries",link:function(e,t,r,n){if(!n){return}return t.on("mousedown",function(e){n.$createSeriesItem();return e.stopPropagation()})}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetText",["$rootScope","$timeout","$interpolate",function(e,t,r){return{scope:{default:"@"},restrict:"AE",require:"?ngModel",link:function(n,i,o,a){var s,l,u,c,d,f,p,m;if(!a){return}if(window.parent){p=parent.angular.element(parent.document).scope()}else{p=e}m=p.station;if(!m){return}i[0].setAttribute("contenteditable","true");c=false;if(n.default){u=n.default}else{u=r(i.html().trim())(e)}i.on("click mousedown",function(e){m.$emit("widget.update_text",n);return e.stopPropagation()});a.$render=function(){var e;if(!a.$viewValue&&!c){i.html(u);e=t(function(){f();return t.cancel(e)},0)}else{i.html(a.$viewValue||"")}return c=true};i.on("blur keyup change cut",function(e){f();return e.stopPropagation()});s=function(e){e=e.replace(/<div\s*.*?>/gi,"<br>");e=e.replace(/<(?!br\s*\/?)[^>]+>/gi,"");if(e==="<br>"){e=""}return e};l=function(e){var t,r,n,i;e.removeAttribute("style");i=e.children;for(r=0,n=i.length;r<n;r++){t=i[r];l(t)}};d=function(e){var t,r,n;n=void 0;r=void 0;t=void 0;if(window.getSelection){n=window.getSelection();if(n.getRangeAt&&n.rangeCount){r=n.getRangeAt(0);r.deleteContents();r.insertNode(document.createTextNode(e))}}else if(document.selection&&document.selection.createRange){document.selection.createRange().text=e}};i.on("paste",function(e){var t;if(e.clipboardData&&e.clipboardData.getData){e.preventDefault();t=e.clipboardData.getData("text/plain");return document.execCommand("insertHTML",false,t)}else if(window.clipboardData&&window.clipboardData.getData){t=window.clipboardData.getData("Text");return d(t)}});return f=function(){var e;e=s(i.html());if(e==="<br>"){e=""}return a.$setViewValue(e.trim())}}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetSlot",["$rootScope",function(e){return{scope:{supWidgetSlot:"@",slot:"@"},restrict:"AE",link:function(t,r,n){var i,o;if(window.parent){i=parent.angular.element(parent.document).scope()}else{i=e}o=i.station;if(!o||!o.open_file){return}return r.on("mousedown",function(e){o.edit_slot(t.slot||t.supWidgetSlot);return e.stopPropagation()})}}}])}).call(this);
