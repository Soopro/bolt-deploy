(function(){angular.module("boltApp",["ngSanitize","supLocales","supAngularWysiwyg"])}).call(this);(function(){angular.module("boltApp").constant("config",{baseURL:{api:CONF.api,apps:CONF.apps,assistant:CONF.assistant},preview_cookie_domain:CONF.preview_cookie_domain,debug:Boolean(CONF.debug),browser:angular.browser(),cdn:{upload:{z0:"upload.qiniup.com",z1:"upload-z1.qiniup.com",z2:"upload-z2.qiniup.com",na0:"upload-na0.qiniup.com",as0:"upload-as0.qiniup.com"},zones:[{name:"East China",code:"z0"},{name:"North China",code:"z1"},{name:"South China",code:"z2"},{name:"North America",code:"na0"},{name:"Southeast Asia",code:"as0"}]},locales:[{code:"en_US",name:"English"},{code:"zh_CN",name:"简体中文"}],default_locale:"en_US",social_medias:[{code:"weibo",name:"Weibo"},{code:"wechat",name:"WeChat"},{code:"douban",name:"Douban"},{code:"github",name:"Github"},{code:"behance",name:"Behance"},{code:"twitter",name:"Twitter"},{code:"facebook",name:"Facebook"},{code:"linkedin",name:"Linkedin"},{code:"vimeo",name:"Vimeo"},{code:"youtube",name:"YouTube"},{code:"google",name:"Google+"},{code:"other",name:"Other"}],media_icons:{image:"image:ic_photo_24px",video:"av:ic_videocam_24px",audio:"image:ic_audiotrack_24px",application:"file:ic_attachment_24px"},max_image_size:{width:1920,height:1920},max_file_size:{image:1*1024*1024,video:24*1024*1024,audio:6*1024*1024,application:6*1024*1024},media_encoder_options:.8,media_mimetypes:{image:["image/png","image/jpeg","image/svg+xml","image/gif"],video:["video/mp4","video/quicktime"],audio:["audio/mp3"],application:["application/zip","application/pdf"]},route:{index:"/",station:"/station",external:"user/external",profile:"/user/profile",oauth:"/user/oauth",exit:"/user/exit",login:"/gate/login",error:"/error"},before_login_route_prefix:"/gate/",app_limit:60,app_types:[{name:"Brand Website",key:"ws",ico:"av:ic_web_24px"},{name:"WeChat Public",key:"wx",ico:"action:ic_speaker_notes_24px"},{name:"WeChat Mini Store",key:"wxa",ico:"action:ic_store_24px"},{name:"Digital Flyer",key:"wr",ico:"image:ic_photo_album_24px"}],default_app_type:"ws",category_terms_limit:120,email:{support:"support@soopro.com"},copyright:"Humbly powered by soopro."})}).call(this);(function(){angular.module("boltApp").filter("t",function(){return function(e,t,n){var r;if(typeof e!=="string"){return e}if(n===void 0){n="t"}r={};r[n]=t||Date.now();return angular.addURLParams(e,r)}}).filter("thumbnail",function(){return function(t,e){var n,r,i,a,o,u;if(!angular.isUrl(t)){return t}if(e===void 0){e="default"}r="?imageMogr2";a={default:"/thumbnail/480x>/quality/90",retina:"/thumbnail/960x>/quality/90",favicon:"/thumbnail/180x180!/quality/90",icon:"/thumbnail/360x360!/quality/90"};o=a[e]||a.default;if(!o||!r){return t}if(t.indexOf(r)<0){if(t.match(/\?|#/)){t=t.split("?")[0].split("#")[0]}t+=r}u=t.split(r);try{i=u[1].replace(/\/thumbnail\/.*?$/i,"");t=u[0]+r+i+o}catch(e){n=e;console.error(n);t=""}return t}}).filter("bg_img",function(){return function(e){if(!e){return""}return"background-image:url("+e+");"}}).filter("is_empty",function(){return function(e){var t;if(angular.isArray(e)){t=!e||e.length<=0}else if(angular.isObject(e)){t=!e||Object.keys(e).length<=0}else if(angular.isFunction(e)||angular.isElement(e)){t=true}else{t=!Boolean(e)}return t}}).filter("price",function(){return function(e,t,n){return angular.price(e,t,n)}})}).call(this);(function(){angular.module("boltApp").config(["$sceDelegateProvider",function(e){return e.resourceUrlWhitelist(["self","http://**.soopro.io/**","https://**.soopro.io/**","http://**.soopro.com/**","https://**.soopro.com/**"])}])}).call(this);(function(){var u=[].indexOf;angular.module("boltApp").filter("trust",["$sce",function(t){return function(e){return t.trustAsHtml(e)}}]).filter("capitalize",function(){return function(e){return angular.capitalize(e)}}).filter("url",["$rootScope",function(i){return function(e,t,n){var r;if(typeof e!=="string"){return e}if(t){r=e.indexOf("?");if(r>-1){e=e.substring(0,r)}}if(n){r=e.indexOf("#");if(r>-1){e=e.substring(0,r)}}if(!e||angular.isUrl(e)){return e}else if(angular.startswith(e,"/")){return i.base_url+"/"+e.replace(/(^\/)|(\/$)/g,"")}else{return e.replace(/\/$/g,"")}}}]).filter("path",["$rootScope",function(o){return function(t,e,n){var r,i,a;if(typeof t!=="string"){return t}if(e||e===void 0){i=t.indexOf("?");if(i>-1){t=t.substring(0,i)}}if(n||n===void 0){i=t.indexOf("#");if(i>-1){t=t.substring(0,i)}}try{a=t.split(o.base_url).pop()}catch(e){r=e;a=t}return"/"+a.replace(/^\//g,"").replace(/\/$/g,"")}}]).filter("active",["$rootScope",function(e){return function(n,r,e,t,i){var a,o,u,l,s;if(e===void 0){e=false}if(t===void 0){t="active"}if(i===void 0){i=""}if(!angular.isObject(n)||!angular.isString(r)){return i}a=function(e){var t;if(r===n.path){return true}else if(n.path_scope){t=angular.lstrip(n.path_scope,"/");if(angular.startswith(r,"/"+t)){return true}}return false};if(a(n)){return t}if(e&&n.nodes){s=n.nodes;for(o=0,u=s.length;o<u;o++){l=s[o];if(a(l)){return t}}}return i}}]).filter("args",function(){return function(e,t){if(typeof e!=="string"){return{}}return angular.getURLParams(e,t)}}).filter("join",function(){return function(e,t){if(angular.isArray(e)){if(!t){t=", "}return e.join(t)}else{return e}}}).filter("striptags",function(){return function(e){return String(e).replace(/<[^>]+>/gm,"")}}).filter("int",function(){return function(t){try{t=parseInt(t)}catch(e){t=null}return t}}).filter("string",function(){return function(e){var t;try{t=e.toString()}catch(e){t=""}return t}}).filter("date_formatted",["$filter","$rootScope",function(o,u){return function(e,t){var n,r,i,a;if(!e){return""}if(typeof t!=="string"){t=null}r={en:"MMMM d, yyyy",zh:"yyyy年 MM月 dd日"};try{a=u.locale;i=u.lang||a.split("_")[0]}catch(e){a=null;i=null}n=t||r[a]||r[i]||null;if(typeof e==="number"){if(e.toString().length===10){e=e*1e3}}if(!n){return e}else{return o("date")(e,n)}}}]).filter("col_offset",function(){return function(e,t,n,r){var i,a,o;r=angular.parse_int(r,12,0);n=angular.parse_int(n,4,true);if(angular.isString(t)){if(u.call(t,"{}")<0){t+="{}"}}else{t=null}if(angular.isArray(e)){i=e.length}else{i=angular.parse_int(e,0,0)}a=Math.floor((r-i*n)/2);if(t){if(a>0){o=t.replace("{}",a)}else{o=""}}else{o=a}return o}})}).call(this);(function(){var _=[].indexOf;angular.module("boltApp").directive("editorCanvas",["$compile",function(e){return{restrict:"AE",scope:{},controller:["$scope","$rootScope","$window","$element","$compile","$interval","$timeout","supLocales",function(i,a,e,o,u,r,l,s){var c,p,t,n,d,f,g,m,$,w,y,h,v,b;i._=angular.translate;if(e.parent){y=e.parent.angular.element(e.parent.document).scope()}else{y=a}v=y.station;if(!v){console.error("Canvas must running in an station.");return}d=v.editor_context;w=v.restEditor;i.g={};i.query={};f=d.metas;i.base_url=a.base_url=f.base_url;i.theme_url=a.theme_url=f.theme_url;i.res_url=a.res_url=f.res_url;i.locale=a.locale=f.locale;i.lang=a.lang=f.lang;i.site_meta=f.site_meta;i.theme_meta=f.theme_meta;i.menu=f.menu;i.languages=f.languages;i.socials=f.socials;i.slot=f.slot;n=f.content_type[v.curr_content_type];i.content_type=n;i.visit=d.visit;t=function(e,t){v.display_canvas(false);return w.tpl.get({app_slug:e,tmpl_slug:t},function(e){var t,n,r;try{s.load(d.app.locale,e.localized_dict)}catch(e){n=e;console.error("Canvas localize error:",n)}o.html(e.tpl);b(o[0]);try{t=u(o.contents());t(i)}catch(e){n=e;console.error("Canvas rendering error:",n)}i.g={};i.query={};return r=l(function(){try{return v.display_canvas(true)}catch(e){n=e;return console.error(n)}},1200)})};b=function(e){var t,n,r,i,a,o;r=e.querySelectorAll("sup-template")||[];for(t=0,n=r.length;t<n;t++){i=r[t];a=i.getAttribute("id");o=document.createElement("script");o.setAttribute("id",a);o.setAttribute("type","text/ng-template");o.innerHTML=i.innerHTML;i.parentNode.replaceChild(o,i)}return e};m=null;i.$watch("file.template",function(e){if(m===e||!e){return}t(d.app.slug,e);return m=e});i.file=v.file;i.$watch("file",function(e){i.content=e.content;i.meta=e.meta||{};i.meta.id=e.id;i.meta.url=e.url;i.meta.path=e.path;i.meta.priority=e.priority;i.meta.parent=e.parent;i.meta.type=i.meta.content_type=e.content_type;i.meta.status=e.status;i.meta.updated=e.updated;i.meta.creation=e.creation;i.meta.date=e.date;i.meta.template=e.template;i.meta.tags=e.tags;return i.meta.terms=e.terms},true);i.$watch("content",function(e){return i.file.content=e});g={};c=function(e){var t,n,r;if(typeof e==="number"){e=[e]}for(n=0,r=e.length;n<r;n++){t=e[n];if(!g[t]){return false}}return true};o.on("click blur focus",function(e){return g={}});o.on("keydown keyup",function(e){var t,n,r;n=[17,27,91,83];if(r=e.keyCode,_.call(n,r)<0){return}if(e.type==="keydown"){if(g[e.keyCode]){return}g[e.keyCode]=e.type==="keydown";if(c([91,83])){v.save();g[91]=false;g[83]=false;e.preventDefault();e.stopPropagation();console.info("Editor: Try to Save")}if(c([17,27])){t=!a.escape;v.switch_sidebar(!t);a.escape=t;e.preventDefault();return console.info("Editor: escape "+t)}}else if(e.type==="keyup"){return g[e.keyCode]=false}});o.attr("origin-class",o.attr("class"));h=[];p=a.$on("saw.loaded",function(e,t){if(typeof t.destroy==="function"){return h.push(t)}});i.$on("$destroy",function(){var e,t,n;for(e=0,t=h.length;e<t;e++){n=h[e];n.destroy()}p();return r.cancel($)});return $=r(function(){},600)}]}}]).directive("supQuery",["$rootScope","$window",function(p,d){return{scope:{attrs:"=",contentType:"=",sortby:"=",perpage:"=",paged:"=",term:"=",tag:"=",withContent:"="},restrict:"AE",require:"?ngModel",link:function(e,t,n,r){var i,a,o,u,l,s,c;if(!r){return}u=3;o=d.document.querySelectorAll("[sup-query], sup-query");if(o.length>u){console.error("Query overrun.",t[0]);return}if(d.parent){s=d.parent.angular.element(d.parent.document).scope()}else{s=p}c=s.station;if(!c){return}i=c.editor_context.app;l=c.restEditor;a={attrs:angular.list(e.attrs),content_type:e.contentType||n.supQuery,sortby:angular.list(e.sortby),perpage:angular.parse_int(e.perpage),paged:angular.parse_int(e.paged),term:e.term,tag:e.tag,with_content:angular.bool(e.withContent)};return l.doEditorQuery(i.id,a).then(function(e){return r.$setViewValue(e)})}}}]).directive("supCategorize",["$rootScope","$window",function(d,f){return{scope:{termKeys:"="},restrict:"AE",require:"?ngModel",link:function(a,e,t,n){var r,i,o,u,l,s,c,p;if(!n){return}u=1;o=f.document.querySelectorAll("[sup-categorize], sup-categorize");if(o.length>u){console.error("Query overrun.",e[0]);return}if(f.parent){s=f.parent.angular.element(f.parent.document).scope()}else{s=d}c=s.station;if(!c){return}r=c.editor_context.app;l=c.restEditor;p=false;i=function(){var i,e;if(p){return}if(angular.isUndefined(t.termKeys)){e=null}else if(angular.isArray(a.termKeys)){e=function(){var e,t,n,r;n=a.termKeys;r=[];for(e=0,t=n.length;e<t;e++){i=n[e];if(angular.isString(i)){r.push(i)}}return r}();if(e.length>12){e.length=12}}else{e=""}p=true;return l.category.get({app_slug:r.slug,term_keys:e}).$promise.then(function(e){return n.$setViewValue(e.category)}).finally(function(){return p=false})};i();return a.$watch("termKeys",function(e,t){if(!angular.equals(e,t)){return i()}})}}}]).directive("supSet",[function(){return{scope:{value:"@",object:"="},restrict:"AE",require:"?ngModel",link:function(e,t,n,r){if(!r){return}r.$setViewValue(e.object||e.value);return r.$render=function(){return r.$setViewValue(e.object||e.value)}}}}]).directive("supBindHtml",[function(){return{restrict:"A",compile:function(){return function(e,t,n){return e.$watch(n.supBindHtml,function(e){return t.html(e||"")})}}}}]).directive("supLoadTemplate",["$compile","$templateCache",function(l,s){return{scope:{supLoadTemplate:"=",templateId:"=",importWithContext:"="},restrict:"AE",link:function(e,t,n){var r,i,a,o,u;o=e.supLoadTemplate||e.templateId;a=s.get(o)||"";if(angular.isObject(e.importWithContext)){i=e.importWithContext;for(r in i){u=i[r];e[r]=u}}e._=angular.translate;return l(t.html(a).contents())(e)}}}]).directive("supBody",[function(){return{scope:{class:"@",style:"@"},restrict:"AE",link:function(e,t){var n;n=document.body.getAttribute("origin-class");if(!t.hasClass("ng-hide")){t.addClass("ng-hide")}e.$watchGroup(["class","style"],function(){document.body.setAttribute("style",e.style);return document.body.setAttribute("class",n+" "+e.class)});return t.on("$destroy",function(){document.body.setAttribute("class",n);return document.body.removeAttribute("style")})}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetBg",["$rootScope","$window",function(u,l){return{scope:{allowTypes:"@",allowFields:"@",presets:"="},restrict:"AE",require:"?ngModel",link:function(t,n,e,r){var i,a,o;if(!r){return}if(l.parent){a=l.parent.angular.element(l.parent.document).scope()}else{a=u}o=a.station;if(!o){return}t.options={allow_types:t.allowTypes||e.supWidgetBg,allow_fields:angular.str2opts(t.allowFields),presets:t.presets};n.on("mousedown",function(e){if(e.target!==n[0]){return}o.$emit("widget.bg.update",t);return e.stopPropagation()});t.update=function(e){t.data=e;r.$setViewValue(t.data);return r.$render()};r.$render=function(){return t.data=r.$viewValue};i={label:e.label||e.name,key:e.ngModel};return o.$emit("widget.bg.loaded",i,t)}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetAttrs",["$rootScope","$window",function(d,f){return{scope:{structure:"="},restrict:"AE",require:"?ngModel",link:function(t,e,n,r){var i,a,o,u,l,s,c,p;if(!r){return}if(f.parent){s=f.parent.angular.element(f.parent.document).scope()}else{s=d}c=s.station;if(!c){return}i={};if(angular.isArray(t.structure)){l=t.structure;for(a=0,o=l.length;a<o;a++){p=l[a];if(!p.key){continue}if(!p.type){p.type="text"}i[p.key]=p.value}}t.options={structure:t.structure};e.on("mousedown",function(e){c.$emit("widget.attrs.update",t);return e.stopPropagation()});t.update=function(e){t.data=e||i;r.$setViewValue(t.data);return r.$render()};e.on("$destroy",function(){r.$render=angular.noop;if(angular.equals(r.$viewValue,i)){return r.$setViewValue(null)}});r.$render=function(){if(!angular.isDict(r.$viewValue)){r.$setViewValue(i)}return t.data=r.$viewValue};u={label:n.label||n.name,key:n.ngModel};return c.$emit("widget.attrs.loaded",u,t)}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetLink",["$rootScope","$window",function(u,l){return{scope:{linkToType:"@",allowFields:"@"},restrict:"AE",require:"?ngModel",link:function(t,e,n,r){var i,a,o;if(!r){return}if(l.parent){a=l.parent.angular.element(l.parent.document).scope()}else{a=u}o=a.station;if(!o){return}t.options={link_to_type:t.linkToType,allow_fields:angular.str2opts(t.allowFields)};e.on("mousedown",function(e){o.$emit("widget.link.update",t);return e.stopPropagation()});t.update=function(e){t.data=e;r.$setViewValue(t.data);return r.$render()};r.$render=function(){return t.data=r.$viewValue};i={label:n.label||n.name,key:n.ngModel};return o.$emit("widget.link.loaded",i,t)}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetCarousel",["$rootScope","$window",function(f,g){return{scope:{default:"@",allowTypes:"@",allowFields:"@",limit:"@"},restrict:"AE",require:"?ngModel",link:function(t,e,n,r){var i,a,o,u,l,s,c,p,d;if(!r){return}if(g.parent){p=g.parent.angular.element(g.parent.document).scope()}else{p=f}d=p.station;if(!d){return}try{i=t.$eval(t.default);o=[];for(l=0,s=i.length;l<s;l++){a=i[l];o.push({title:a.title||"",src:a.src||"",type:a.type||"image",link:"",target:"",caption:a.caption||""})}}catch(e){u=e;o=[]}if(!angular.isArray(o)){o=[]}t.limit=Math.min(angular.parse_int(t.limit,12,true),24);t.options={allow_types:t.allowTypes||n.supWidgetCarousel,allow_fields:angular.str2opts(t.allowFields),link_to_type:n.linkToType,limit:t.limit,lite:angular.isDefined(n.lite)};e.on("mousedown",function(e){d.$emit("widget.carousel.update",t);return e.stopPropagation()});t.update=function(e){if(!e||e.length===0){e=null}t.data=e||o;r.$setViewValue(t.data);return r.$render()};e.on("$destroy",function(){r.$render=angular.noop;if(angular.equals(r.$viewValue,o)){return r.$setViewValue(null)}});r.$render=function(){if(!angular.isArray(r.$viewValue)){r.$setViewValue(o)}return t.data=r.$viewValue};c={label:n.label||n.name,key:n.ngModel};return d.$emit("widget.carousel.loaded",c,t)}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetCatalog",["$rootScope","$window",function(l,s){return{scope:{contentType:"@",itemsLimit:"@",limit:"@"},restrict:"AE",require:"?ngModel",link:function(t,e,n,r){var i,a,o,u;if(!r){return}if(s.parent){o=s.parent.angular.element(s.parent.document).scope()}else{o=l}u=o.station;if(!u){return}i=[];t.limit=Math.min(angular.parse_int(t.limit,6,true),12);t.items_limit=angular.parse_int(t.itemsLimit,6,true);t.items_limit=Math.min(t.items_limit,12);t.options={content_type:t.contentType,items_limit:t.items_limit,limit:t.limit};e.on("mousedown",function(e){u.$emit("widget.catalog.update",t);return e.stopPropagation()});t.update=function(e){if(!e||e.length===0){e=null}t.data=e||i;r.$setViewValue(t.data);return r.$render()};e.on("$destroy",function(){r.$render=angular.noop;if(angular.equals(r.$viewValue,i)){return r.$setViewValue(null)}});r.$render=function(){if(!angular.isArray(r.$viewValue)){r.$setViewValue(i)}return t.data=r.$viewValue};a={label:n.label||n.name,key:n.ngModel};return u.$emit("widget.catalog.loaded",a,t)}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetCreate",["$rootScope","$window",function(a,o){return{scope:{type:"@",parent:"@",template:"@"},restrict:"AE",link:function(t,e,n){var r,i;if(o.parent){r=o.parent.angular.element(o.parent.document).scope()}else{r=a}i=r.station;if(!i||!i.create_file){return}return e.on("mousedown",function(e){i.create_file(t.type,t.template,t.parent||"");return e.stopPropagation()})}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetBulletin",["$rootScope","$window",function(l,s){return{scope:null,restrict:"AE",require:"?ngModel",link:function(t,e,n,r){var i,a,o,u;if(!r){return}if(s.parent){o=s.parent.angular.element(s.parent.document).scope()}else{o=l}u=o.station;if(!u){return}i={};t.options={};e.on("mousedown",function(e){u.$emit("widget.bulletin.update",t);return e.stopPropagation()});t.update=function(e){t.data=e||i;r.$setViewValue(t.data);return r.$render()};e.on("$destroy",function(){r.$render=angular.noop;if(angular.equals(r.$viewValue,i)){return r.$setViewValue(null)}});r.$render=function(){if(!angular.isObject(r.$viewValue)){r.$setViewValue(i)}return t.data=r.$viewValue};a={label:n.label||n.name,key:n.ngModel};return u.$emit("widget.bulletin.loaded",a,t)}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetForm",["$rootScope","$window",function(u,l){return{scope:{limit:"@",optLimit:"@"},restrict:"AE",require:"?ngModel",link:function(t,e,n,r){var i,a,o;if(!r){return}if(l.parent){a=l.parent.angular.element(l.parent.document).scope()}else{a=u}o=a.station;if(!o){return}t.options={limit:Math.min(angular.parse_int(t.limit,12,true),24),opt_limit:Math.min(angular.parse_int(t.optLimit,6,true),24)};e.on("mousedown",function(e){o.$emit("widget.form.update",t);return e.stopPropagation()});t.update=function(e){t.data=e;r.$setViewValue(t.data);return r.$render()};r.$render=function(){return t.data=r.$viewValue};i={label:n.label||n.name,key:n.ngModel};return o.$emit("widget.form.loaded",i,t)}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetLines",["$rootScope","$window",function(f,g){return{scope:{default:"@",limit:"@"},restrict:"AE",require:"?ngModel",link:function(t,e,n,r){var i,a,o,u,l,s,c,p,d;if(!r){return}if(g.parent){c=g.parent.angular.element(g.parent.document).scope()}else{c=f}p=c.station;if(!p){return}try{i=t.$eval(t.default);a=[];for(u=0,l=i.length;u<l;u++){d=i[u];if(angular.isString(d)&&d){a.push({text:d})}else if(angular.isDict(d)&&d.text){a.push({text:d.text})}}}catch(e){o=e;a=[]}if(!angular.isArray(a)){a=[]}t.limit=Math.min(angular.parse_int(t.limit,12,true),24);t.options={limit:t.limit};e.on("mousedown",function(e){p.$emit("widget.lines.update",t);return e.stopPropagation()});t.update=function(e){t.data=e||a;r.$setViewValue(t.data);return r.$render()};e.on("$destroy",function(){r.$render=angular.noop;if(angular.equals(r.$viewValue,a)){return r.$setViewValue(null)}});r.$render=function(){if(!angular.isArray(r.$viewValue)){r.$setViewValue(a)}return t.data=r.$viewValue};s={label:n.label||n.name,key:n.ngModel};return p.$emit("widget.lines.loaded",s,t)}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetMedia",["$rootScope","$window",function(u,l){return{scope:{allowTypes:"@",allowFields:"@"},restrict:"AE",require:"?ngModel",link:function(t,e,n,r){var i,a,o;if(!r){return}if(l.parent){a=l.parent.angular.element(l.parent.document).scope()}else{a=u}o=a.station;if(!o){return}t.options={allow_types:t.allowTypes||n.supWidgetMedia,allow_fields:angular.str2opts(t.allowFields),resizable:angular.isDefined(n.resizable),lite:angular.isDefined(n.lite)};e.on("mousedown",function(e){o.$emit("widget.media.update",t);return e.stopPropagation()});t.update=function(e){t.data=e;r.$setViewValue(t.data);return r.$render()};r.$render=function(){return t.data=r.$viewValue};i={label:n.label||n.name,key:n.ngModel};return o.$emit("widget.media.loaded",i,t)}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetOpen",["$rootScope","$window",function(a,o){return{scope:{supWidgetOpen:"=",file:"="},restrict:"AE",link:function(t,e,n){var r,i;if(o.parent){r=o.parent.angular.element(o.parent.document).scope()}else{r=a}i=r.station;if(!i||!i.open_file){return}return e.on("mousedown",function(e){i.open_file(t.file||t.supWidgetOpen);return e.stopPropagation()})}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetScript",["$rootScope","$window",function(u,l){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,e,n,r){var i,a,o;if(!r){return}if(l.parent){a=l.parent.angular.element(l.parent.document).scope()}else{a=u}o=a.station;if(!o){return}e.on("mousedown",function(e){o.$emit("widget.script.update",t);return e.stopPropagation()});t.update=function(e){t.data=e||"";r.$setViewValue(t.data);return r.$render()};r.$render=function(){return t.data=r.$viewValue};i={label:n.label||n.name,key:n.ngModel};return o.$emit("widget.script.loaded",i,t)}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetSegments",["$rootScope","$window",function(f,g){return{scope:{content_type:"@",parent:"@",limit:"@"},restrict:"AE",require:"ngModel",controller:["$scope",function(t){var e;e=this;e.$editSegment=function(e){return t.edit(e)};e.$createSegment=function(e){return t.create(e)};return e}],link:function(r,n,e,t){var i,a,o,u,l,s,c,p,d;if(!t){return}u=1;o=g.document.querySelectorAll("[sup-widget-segments], sup-widget-segments");if(o.length>u){console.error("Query overrun.",n[0]);return}if(g.parent){c=g.parent.angular.element(g.parent.document).scope()}else{c=f}p=c.station;if(!p){return}i=p.editor_context.app;a=p.file;s=p.restEditor;r.limit=Math.min(angular.parse_int(r.limit,24,true),24);r.data=[];d=function(e){var t;if(!e||!e.length){return}t=angular.element(n[0].querySelector("[segment-create]"));if(!t){return}if(e.length>=r.limit){return t.addClass("ng-hide")}else{return t.removeClass("ng-hide")}};l=function(){return s.segments.query({app_id:i.id,content_type:r.content_type||a.content_type,parent:r.parent||a.slug}).$promise.then(function(e){d(e);t.$setViewValue(e);return r.data=t.$viewValue})};l();r.refresh=function(){return l()};r.edit=function(e){if(!r.data[e]){return}return p.open_file(r.data[e])};return r.create=function(e){var t,n;t=r.content_type||a.content_type;n=r.parent||a.slug;return p.create_file(t,e,n,true)}}}}]).directive("segment",[function(){return{scope:false,restrict:"A",require:"?^supWidgetSegments",link:function(t,e,n,r){if(!r){return}return e.on("mousedown",function(e){if(!angular.isNumber(t.$index)){return}r.$editSegment(t.$index);return e.stopPropagation()})}}}]).directive("segmentCreate",[function(){return{scope:{template:"@"},restrict:"A",require:"?^supWidgetSegments",link:function(t,e,n,r){if(!r){return}return e.on("mousedown",function(e){r.$createSegment(t.template);return e.stopPropagation()})}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetSeries",["$rootScope","$window",function($,w){return{scope:{default:"@",allowTypes:"@",allowFields:"@",limit:"@"},restrict:"AE",require:"ngModel",controller:["$scope",function(t){this.$editSeriesItem=function(e){return t.edit(e)};this.$addSeriesItem=function(){return t.add()};return this}],link:function(u,r,e,t){var n,i,l,s,c,a,o,p,d,f,g,m;if(!t){return}if(w.parent){g=w.parent.angular.element(w.parent.document).scope()}else{g=$}m=g.station;if(!m){return}try{i=u.$eval(u.default);c=[];for(o=0,d=i.length;o<d;o++){p=i[o];c.push({src:p.src||"",touch:p.touch||"",type:p.type||"image",title:p.title||"",subtitle:p.subtitle||"",caption:p.caption||"",link:"",target:"",class:"",poster:p.poster||"",extra:p.extra||"",tags:p.tags||[]})}}catch(e){a=e;c=[]}if(!angular.isArray(c)){c=[]}u.limit=Math.min(angular.parse_int(u.limit,24,true),24);u.options={allow_types:u.allowTypes||e.supWidgetSeries,allow_fields:angular.str2opts(u.allowFields),limit:u.limit,lite:angular.isDefined(e.lite)};u.item=null;s=null;l=function(e){var t,n;t=r[0].querySelector("[series-item-create]");if(!e||!t){return}n=angular.element(t);if(e.length>=u.limit){n.addClass("ng-hide");if(e.length>u.limit){return e.length=u.limit}}else{return n.removeClass("ng-hide")}};n=function(){var e,t,n,r,i,a,o;u.item=null;s=null;a=u.data;for(t=0,r=a.length;t<r;t++){p=a[t];delete p._index}l(u.data);if(u.data.length===0){o=[];for(n=0,i=c.length;n<i;n++){e=c[n];o.push(u.data.push(e))}return o}};u.edit=function(e){if(!angular.isNumber(e)){return}s=e;u.item=u.data[e]||{};u.item._index=e;return m.$emit("widget.series.update",u)};u.add=function(){s=null;u.item=null;return m.$emit("widget.series.create",u)};u.update=function(e){var t;if(!angular.isObject(e)||e.deleted){u.data.splice(s,1)}else if(angular.isNumber(e._index)){u.data[s]=e;t=e._index;angular.list_shift(u.data,s,t,false)}return n()};u.create=function(e){var t;if(angular.isObject(e)){u.data.push(e)}s=u.data.length-1;if(e._index){t=e._index;angular.list_shift(u.data,s,t,false)}return n()};r.on("$destroy",function(){t.$render=angular.noop;if(angular.equals(t.$viewValue,c)){return t.$setViewValue(null)}});t.$render=function(){if(!angular.isArray(t.$viewValue)){t.$setViewValue(c)}u.data=t.$viewValue;return l(u.data)};f={label:e.label||e.name,key:e.ngModel};return m.$emit("widget.series.loaded",f,u)}}}]).directive("seriesItem",[function(){return{scope:false,restrict:"A",require:"?^supWidgetSeries",link:function(t,e,n,r){if(!r){return}return e.on("mousedown",function(e){if(!angular.isNumber(t.$index)){return}r.$editSeriesItem(t.$index);return e.stopPropagation()})}}}]).directive("seriesItemCreate",[function(){return{scope:false,restrict:"A",require:"?^supWidgetSeries",link:function(e,t,n,r){if(!r){return}return t.on("mousedown",function(e){r.$addSeriesItem();return e.stopPropagation()})}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetText",["$rootScope","$timeout","$interpolate","$window",function(d,f,g,m){return{scope:{default:"@"},restrict:"AE",require:"?ngModel",link:function(t,n,e,r){var i,a,o,u,l,s,c,p;if(!r){return}if(m.parent){c=m.parent.angular.element(m.parent.document).scope()}else{c=d}p=c.station;if(!p){return}u=false;n[0].setAttribute("contenteditable","true");if(t.default){o=t.default}else{o=g(n.html().trim())(d)}n.on("click mousedown",function(e){p.$emit("widget.text.touch",t);return e.stopPropagation()});r.$render=function(){var e;if(!r.$viewValue&&!u){n.html(o);e=f(function(){s();return f.cancel(e)},0)}else{n.html(r.$viewValue||"")}return u=true};n.on("blur keyup change cut",function(e){return s()});i=function(e){e=e.replace(/<div\s*.*?>/gi,"<br>");e=e.replace(/<(?!br\s*\/?)[^>]+>/gi,"");if(e==="<br>"){e=""}return e};a=function(e){var t,n,r,i;e.removeAttribute("style");i=e.children;for(n=0,r=i.length;n<r;n++){t=i[n];a(t)}};n.on("paste",function(e){var t;if(e.clipboardData&&e.clipboardData.getData){e.preventDefault();t=e.clipboardData.getData("text/plain");return m.document.execCommand("insertText",false,t)}else if(m.clipboardData&&m.clipboardData.getData){e.preventDefault();t=m.clipboardData.getData("Text");return m.document.execCommand("insertText",false,t)}});s=function(){var e;e=i(n.html());if(e==="<br>"){e=""}return r.$setViewValue(e.trim())};l={label:e.label||e.name,key:e.ngModel};return p.$emit("widget.text.loaded",l,t)}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetSlot",["$rootScope","$window",function(o,u){return{scope:{key:"@",allowFields:"@"},restrict:"AE",link:function(t,e,n){var r,i,a;if(u.parent){i=u.parent.angular.element(u.parent.document).scope()}else{i=o}a=i.station;if(!a||!a.edit_slot){return}if(!t.key){t.key=n.supWidgetSlot}t.options={allow_fields:angular.str2opts(t.allowFields)};e.on("mousedown",function(e){a.edit_slot(t.key,t.options);return e.stopPropagation()});r={label:n.label||n.name,key:t.key};return a.$emit("widget.slot.loaded",r,t)}}}])}).call(this);
