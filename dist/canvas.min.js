(function(){angular.module('boltApp',['ngSanitize','supLocales','supAngularWysiwyg']);}).call(this);(function(){angular.module('boltApp').constant('config',{baseURL:{'api':CONF.api,'apps':CONF.apps,'assistant':CONF.assistant},preview_cookie_domain:CONF.preview_cookie_domain,debug:Boolean(CONF.debug),browser:angular.browser(),global_media_repo:'g',cdn:{upload:{'z0':'upload.qiniup.com','z1':'upload-z1.qiniup.com','z2':'upload-z2.qiniup.com','na0':'upload-na0.qiniup.com','as0':'upload-as0.qiniup.com'},zones:[{name:'East China',code:'z0'},{name:'North China',code:'z1'},{name:'South China',code:'z2'},{name:'North America',code:'na0'},{name:'Southeast Asia',code:'as0'}]},locales:[{code:'en_US',name:'English'},{code:'zh_CN',name:'简体中文'}],default_locale:'en_US',social_medias:[{code:'weibo',name:'Weibo'},{code:'wechat',name:'WeChat'},{code:'douban',name:'Douban'},{code:'github',name:'Github'},{code:'behance',name:'Behance'},{code:'twitter',name:'Twitter'},{code:'facebook',name:'Facebook'},{code:'linkedin',name:'Linkedin'},{code:'vimeo',name:'Vimeo'},{code:'youtube',name:'YouTube'},{code:'google',name:'Google+'},{code:'other',name:'Other'}],media_icons:{'image':'image:ic_photo_24px','video':'av:ic_videocam_24px','audio':'image:ic_audiotrack_24px','application':'file:ic_attachment_24px'},max_image_size:{width:1920,height:1920},max_file_size:{image:1*1024*1024,video:24*1024*1024,audio:6*1024*1024,application:6*1024*1024},media_encoder_options:0.80,media_mimetypes:{image:['image/png','image/jpeg','image/svg+xml','image/gif'],video:['video/mp4','video/quicktime'],audio:['audio/mpeg','audio/mp3'],application:['application/zip','application/pdf']},expert_capability:6,capabilities:[{key:1,label:'Noob'},{key:2,label:'Junior'},{key:3,label:'Senior'},{key:6,label:'Expert',expert:true}],route:{index:'/app',info:'/info',profile:'/user/profile',external:'user/external',oauth:'/user/oauth',auth:'/gate/login',exit:'/gate/exit',station:'/station',error:'/404'},paths:{gate:['/gate/login','/gate/register','/gate/recovery'],free:['/info','/404']},app_limit:60,app_types:[{name:'Brand Website',key:'ws',ico:'av:ic_web_24px',capability:0},{name:'WeChat Buzz',key:'wx',ico:'action:ic_speaker_notes_24px',capability:0},{name:'WeChat Mini Store',key:'wxa',ico:'action:ic_store_24px',capability:3},{name:'Mobile Showreel',key:'wr',ico:'hardware:ic_phone_android_24px',capability:0}],default_app_type:'ws',category_terms_limit:120,email:{support:'support@soopro.com'},copyright:"Humbly powered by soopro."});}).call(this);(function(){angular.module('boltApp').filter("t",function(){return function(url,timestamp,key){var params;if(typeof url!=='string'){return url;}
if(key===void 0){key='t';}
params={};params[key]=timestamp||Date.now();return angular.addURLParams(url,params);};}).filter("thumbnail",function(){return function(pic_url,preset_name){var e,engine_str,params,preset_map,suffix,url_pairs;if(!angular.isUrl(pic_url)){return pic_url;}
if(preset_name===void 0){preset_name='default';}
engine_str='?imageMogr2';preset_map={default:'/thumbnail/480x>/quality/90',retina:'/thumbnail/960x>/quality/90',favicon:'/thumbnail/180x180!/quality/90',icon:'/thumbnail/360x360!/quality/90'};suffix=preset_map[preset_name]||preset_map.default;if(!suffix||!engine_str){return pic_url;}
if(pic_url.indexOf(engine_str)<0){if(pic_url.match(/\?|#/)){pic_url=pic_url.split('?')[0].split('#')[0];}
pic_url+=engine_str;}
url_pairs=pic_url.split(engine_str);try{params=url_pairs[1].replace(/\/thumbnail\/.*?$/i,'');pic_url=url_pairs[0]+engine_str+params+suffix;}catch(error){e=error;console.error(e);pic_url='';}
return pic_url;};}).filter("bg_img",function(){return function(src){if(!src){return'';}
return'background-image:url('+src+');';};}).filter("is_empty",function(){return function(val){var is_empty;if(angular.isArray(val)){is_empty=!val||val.length<=0;}else if(angular.isObject(val)){is_empty=!val||Object.keys(val).length<=0;}else if(angular.isFunction(val)||angular.isElement(val)){is_empty=true;}else{is_empty=!Boolean(val);}
return is_empty;};}).filter("price",function(){return function(val,use_currency,fractionSize){return angular.price(val,use_currency,fractionSize);};});}).call(this);(function(){angular.module('boltApp').config(['$sceDelegateProvider',function($sceDelegateProvider){return $sceDelegateProvider.resourceUrlWhitelist(['self','http://**.soopro.io/**','https://**.soopro.io/**']);}]);}).call(this);(function(){var indexOf=[].indexOf;angular.module('boltApp').filter("trust",['$sce',function($sce){return function(str){return $sce.trustAsHtml(str);};}]).filter("capitalize",function(){return function(str){return angular.capitalize(str);};}).filter("url",['$rootScope',function($rootScope){return function(url,remove_args,remove_hash){var index;if(typeof url!=='string'){return url;}
if(remove_args){index=url.indexOf('?');if(index>-1){url=url.substring(0,index);}}
if(remove_hash){index=url.indexOf('#');if(index>-1){url=url.substring(0,index);}}
if(!url||angular.isUrl(url)){return url;}else if(angular.startswith(url,'/')){return $rootScope.base_url+'/'+url.replace(/(^\/)|(\/$)/g,'');}else{return url.replace(/\/$/g,'');}};}]).filter("path",['$rootScope',function($rootScope){return function(url,remove_args,remove_hash){var e,index,path;if(typeof url!=='string'){return url;}
if(remove_args||remove_args===void 0){index=url.indexOf('?');if(index>-1){url=url.substring(0,index);}}
if(remove_hash||remove_hash===void 0){index=url.indexOf('#');if(index>-1){url=url.substring(0,index);}}
try{path=url.split($rootScope.base_url).pop();}catch(error){e=error;path=url;}
return"/"+path.replace(/^\//g,'').replace(/\/$/g,'');};}]).filter("active",['$rootScope',function($rootScope){return function(menu_item,path,match_nodes,active,inactive){var _check_active,i,len,node,ref;if(match_nodes===void 0){match_nodes=false;}
if(active===void 0){active='active';}
if(inactive===void 0){inactive='';}
if(!angular.isObject(menu_item)||!angular.isString(path)){return inactive;}
_check_active=function(item){var path_scope;if(path===menu_item.path){return true;}else if(menu_item.path_scope){path_scope=angular.strip(menu_item.path_scope,'/');if(angular.startswith(path,'/'+path_scope+'/')){return true;}}
return false;};if(_check_active(menu_item)){return active;}
if(match_nodes&&menu_item.nodes){ref=menu_item.nodes;for(i=0,len=ref.length;i<len;i++){node=ref[i];if(_check_active(node)){return active;}}}
return inactive;};}]).filter("args",function(){return function(url,unique){if(typeof url!=='string'){return{};}
return angular.getURLParams(url,unique);};}).filter("join",function(){return function(list,separator){if(angular.isArray(list)){if(!separator){separator=', ';}
return list.join(separator);}else{return list;}};}).filter("striptags",function(){return function(text){return String(text).replace(/<[^>]+>/gm,'');};}).filter("int",function(){return function(val){try{val=parseInt(val);}catch(error){val=null;}
return val;};}).filter("string",function(){return function(val){var str;try{str=val.toString();}catch(error){str='';}
return str;};}).filter("date_formatted",['$filter','$rootScope',function($filter,$rootScope){return function(date,to_format){var fmt,formats,lang,locale;if(!date){return'';}
if(typeof to_format!=='string'){to_format=null;}
formats={en:'MMMM d, yyyy',zh:'yyyy年 MM月 dd日'};try{locale=$rootScope.locale;lang=$rootScope.lang||locale.split('_')[0];}catch(error){locale=null;lang=null;}
fmt=to_format||formats[locale]||formats[lang]||null;if(typeof date==='number'){if(date.toString().length===10){date=date*1000;}}
if(!fmt){return date;}else{return $filter('date')(date,fmt);}};}]).filter("col_offset",function(){return function(data,pattern,column,row_columns){var length,offset,output;row_columns=angular.parse_int(row_columns,12,0);column=angular.parse_int(column,4,true);if(angular.isString(pattern)){if(indexOf.call(pattern,'{}')<0){pattern+='{}';}}else{pattern=null;}
if(angular.isArray(data)){length=data.length;}else{length=angular.parse_int(data,0,0);}
offset=Math.floor((row_columns-length*column)/2);if(pattern){if(offset>0){output=pattern.replace('{}',offset);}else{output='';}}else{output=offset;}
return output;};});}).call(this);(function(){var indexOf=[].indexOf;angular.module('boltApp').directive('editorCanvas',['$compile',function($compile){return{restrict:'AE',scope:{},controller:['$scope','$rootScope','$window','$element','$compile','$interval','$timeout','supLocales',function($scope,$rootScope,$window,$element,$compile,$interval,$timeout,supLocales){var check_keymap,clean_saw_complete,compile_tpl,content_type,curr_editor,editor_metas,keymap,last_tpl,render,restEditor,root,sawStack,station,strict_mode,strict_template_filter,sup_template_filter;$scope._=angular.translate;if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station){console.error("Canvas must running in an station.");return;}
curr_editor=station.editor_context;restEditor=station.restEditor;strict_mode=station.strict_mode;if(strict_mode){console.info('Canvas running in Strict mode.');}
$scope.g={};$scope.query={};editor_metas=curr_editor.metas;$scope.base_url=$rootScope.base_url=editor_metas.base_url;$scope.theme_url=$rootScope.theme_url=editor_metas.theme_url;$scope.lib_url=$rootScope.lib_url=editor_metas.lib_url;$scope.font_url=$rootScope.font_url=editor_metas.font_url;$scope.locale=$rootScope.locale=editor_metas.locale;$scope.lang=$rootScope.lang=editor_metas.lang;$scope.site_meta=editor_metas.site_meta;$scope.theme_meta=editor_metas.theme_meta;$scope.menu=editor_metas.menu;$scope.languages=editor_metas.languages;$scope.socials=editor_metas.socials;$scope.slot=editor_metas.slot;content_type=editor_metas.content_type[station.curr_content_type];$scope.content_type=content_type;$scope.visit=curr_editor.visit;compile_tpl=function(app_slug,template){station.display_canvas(false);return restEditor.tpl.get({app_slug:app_slug,tmpl_slug:template},function(data){var compile,e,timer;try{supLocales.load(curr_editor.app.locale,data.localized_dict);}catch(error){e=error;console.error('Canvas localize error:',e);}
$element.html(data.tpl);sup_template_filter($element[0]);if(strict_mode){strict_template_filter($element[0]);}
try{compile=$compile($element.contents());compile($scope);}catch(error){e=error;console.error('Canvas rendering error:',e);}
$scope.g={};$scope.query={};return timer=$timeout(function(){try{return station.display_canvas(true);}catch(error){e=error;return console.error(e);}},1200);});};sup_template_filter=function(el){var i,len,templates,tmpl,tmpl_id,tmpl_script;templates=el.querySelectorAll('sup-template')||[];for(i=0,len=templates.length;i<len;i++){tmpl=templates[i];tmpl_id=tmpl.getAttribute('id');tmpl_script=document.createElement('script');tmpl_script.setAttribute('id',tmpl_id);tmpl_script.setAttribute('type','text/ng-template');tmpl_script.innerHTML=tmpl.innerHTML;tmpl.parentNode.replaceChild(tmpl_script,tmpl);}
return el;};strict_template_filter=function(el){var i,len,saw,saw_editors;saw_editors=el.querySelectorAll('[sup-angular-wysiwyg]')||[];for(i=0,len=saw_editors.length;i<len;i++){saw=saw_editors[i];saw.setAttribute('readonly',true);}
return el;};last_tpl=null;$scope.$watch('file.template',function(new_tpl){if(last_tpl===new_tpl||!new_tpl){return;}
compile_tpl(curr_editor.app.slug,new_tpl);return last_tpl=new_tpl;});$scope.file=station.file;$scope.$watch('file',function(file){$scope.content=file.content;$scope.meta=file.meta||{};$scope.meta.id=file.id;$scope.meta.url=file.url;$scope.meta.path=file.path;$scope.meta.priority=file.priority;$scope.meta.parent=file.parent;$scope.meta.type=$scope.meta.content_type=file.content_type;$scope.meta.status=file.status;$scope.meta.updated=file.updated;$scope.meta.creation=file.creation;$scope.meta.date=file.date;$scope.meta.price=file.price;$scope.meta.template=file.template;$scope.meta.tags=file.tags;$scope.meta.terms=file.terms;return $scope.meta.shelf=file.shelf;},true);$scope.$watch('content',function(value){return $scope.file.content=value;});if(strict_mode){$rootScope.escape=true;}else{keymap={};check_keymap=function(codes){var code,i,len;if(typeof codes==='number'){codes=[codes];}
for(i=0,len=codes.length;i<len;i++){code=codes[i];if(!keymap[code]){return false;}}
return true;};$element.on('keydown keyup',function(e){var _key_is_down,escape,key_codes,ref;key_codes=[17,27];_key_is_down=e.type==='keydown';if((ref=e.keyCode,indexOf.call(key_codes,ref)<0)||keymap[e.keyCode]===_key_is_down){return;}
keymap[e.keyCode]=_key_is_down;if(check_keymap(key_codes)){escape=!$rootScope.escape;station.switch_sidebar(!escape);$rootScope.escape=escape;return console.info('Editor: escape '+escape);}});}
sawStack=[];clean_saw_complete=$rootScope.$on('saw.loaded',function(e,saw){if(typeof saw.destroy==='function'){return sawStack.push(saw);}});$scope.$on('$destroy',function(){var i,len,saw;for(i=0,len=sawStack.length;i<len;i++){saw=sawStack[i];saw.destroy();}
clean_saw_complete();return $interval.cancel(render);});return render=$interval(function(){},600);}]};}
]).directive('supQuery',['$rootScope','$window',function($rootScope,$window){return{scope:{attrs:'=',contentType:'=',sortby:'=',perpage:'=',paged:'=',term:'=',tag:'=',withContent:'='},restrict:'AE',require:'?ngModel',link:function(scope,element,attrs,ngModel){var app,data_query,queries,query_limit,restEditor,root,station;if(!ngModel){return;}
query_limit=3;queries=$window.document.querySelectorAll('[sup-query], sup-query');if(queries.length>query_limit){console.error('Query overrun.',element[0]);return;}
if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station){return;}
app=station.editor_context.app;restEditor=station.restEditor;data_query={attrs:angular.list(scope.attrs),content_type:scope.contentType||attrs.supQuery,sortby:angular.list(scope.sortby),perpage:angular.parse_int(scope.perpage),paged:angular.parse_int(scope.paged),term:scope.term,tag:scope.tag,with_content:angular.bool(scope.withContent)};return restEditor.doEditorQuery(app.id,data_query).then(function(data){return ngModel.$setViewValue(data);});}};}
]).directive('supCategorize',['$rootScope','$window',function($rootScope,$window){return{scope:{termKeys:'='},restrict:'AE',require:'?ngModel',link:function(scope,element,attrs,ngModel){var app,get_category,queries,query_limit,restEditor,root,station,submitted;if(!ngModel){return;}
query_limit=1;queries=$window.document.querySelectorAll('[sup-categorize], sup-categorize');if(queries.length>query_limit){console.error('Query overrun.',element[0]);return;}
if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station){return;}
app=station.editor_context.app;restEditor=station.restEditor;submitted=false;get_category=function(){var key,term_keys;if(submitted){return;}
if(angular.isUndefined(attrs.termKeys)){term_keys=null;}else if(angular.isArray(scope.termKeys)){term_keys=(function(){var i,len,ref,results;ref=scope.termKeys;results=[];for(i=0,len=ref.length;i<len;i++){key=ref[i];if(angular.isString(key)){results.push(key);}}
return results;})();if(term_keys.length>12){term_keys.length=12;}}else{term_keys='';}
submitted=true;return restEditor.category.get({app_slug:app.slug,term_keys:term_keys}).$promise.then(function(data){return ngModel.$setViewValue(data.category);}).finally(function(){return submitted=false;});};get_category();return scope.$watch('termKeys',function(new_keys,last_keys){if(!angular.equals(new_keys,last_keys)){return get_category();}});}};}
]).directive('supSet',[function(){return{scope:{value:'@',object:'='},restrict:'AE',require:'?ngModel',link:function(scope,element,attrs,ngModel){if(!ngModel){return;}
ngModel.$setViewValue(scope.object||scope.value);return ngModel.$render=function(){return ngModel.$setViewValue(scope.object||scope.value);};}};}
]).directive('supBindHtml',function(){return{restrict:'A',compile:function(){return function(scope,element,attrs){return scope.$watch(attrs.supBindHtml,function(val){return element.html(val||'');});};}};}).directive('supLoadTemplate',['$compile','$templateCache',function($compile,$templateCache){return{scope:{supLoadTemplate:'=',templateId:'=',importWithContext:'='},restrict:'AE',link:function(scope,element,attrs){var k,ref,tmpl_content,tmpl_id,v;tmpl_id=scope.supLoadTemplate||scope.templateId;tmpl_content=$templateCache.get(tmpl_id)||'';if(angular.isObject(scope.importWithContext)){ref=scope.importWithContext;for(k in ref){v=ref[k];scope[k]=v;}}
return $compile(element.html(tmpl_content).contents())(scope);}};}]);}).call(this);(function(){angular.module('boltApp').directive('supWidgetBg',['$rootScope','$window',function($rootScope,$window){return{scope:{allowTypes:'@',allowFields:'@',presets:'='},restrict:'AE',require:'?ngModel',link:function(scope,element,attrs,ngModel){var loaded,root,station;if(!ngModel){return;}
if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station){return;}
scope.options={allow_types:scope.allowTypes||attrs.supWidgetBg,allow_fields:angular.str2opts(scope.allowFields),presets:scope.presets};element.on("mousedown",function(e){if(station.strict_mode||e.target!==element[0]){return;}
station.$emit('widget.bg.update',scope);return e.stopPropagation();});scope.update=function(data){scope.data=data;ngModel.$setViewValue(scope.data);return ngModel.$render();};ngModel.$render=function(){return scope.data=ngModel.$viewValue;};loaded={label:attrs.label||attrs.name,key:attrs.ngModel};return station.$emit('widget.bg.loaded',loaded,scope);}};}]);}).call(this);(function(){angular.module('boltApp').directive('supWidgetAttrs',['$rootScope','$window',function($rootScope,$window){return{scope:{structure:'='},restrict:'AE',require:'?ngModel',link:function(scope,element,attrs,ngModel){var default_data,i,len,loaded,ref,root,station,struct;if(!ngModel){return;}
if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station){return;}
default_data={};if(angular.isArray(scope.structure)){ref=scope.structure;for(i=0,len=ref.length;i<len;i++){struct=ref[i];if(!struct.key){continue;}
if(!struct.type){struct.type='text';}
default_data[struct.key]=struct.value;}}
scope.options={structure:scope.structure};element.on("mousedown",function(e){if(station.strict_mode){return;}
station.$emit('widget.attrs.update',scope);return e.stopPropagation();});scope.update=function(data){scope.data=data||default_data;ngModel.$setViewValue(scope.data);return ngModel.$render();};element.on('$destroy',function(){ngModel.$render=angular.noop;if(angular.equals(ngModel.$viewValue,default_data)){return ngModel.$setViewValue(null);}});ngModel.$render=function(){if(!angular.isDict(ngModel.$viewValue)){ngModel.$setViewValue(default_data);}
return scope.data=ngModel.$viewValue;};loaded={label:attrs.label||attrs.name,key:attrs.ngModel};return station.$emit('widget.attrs.loaded',loaded,scope);}};}]);}).call(this);(function(){angular.module('boltApp').directive('supWidgetLink',['$rootScope','$window',function($rootScope,$window){return{scope:{linkToType:'@',allowFields:'@'},restrict:'AE',require:'?ngModel',link:function(scope,element,attrs,ngModel){var loaded,root,station;if(!ngModel){return;}
if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station){return;}
scope.options={link_to_type:scope.linkToType,allow_fields:angular.str2opts(scope.allowFields)};element.on("mousedown",function(e){if(station.strict_mode){return;}
station.$emit('widget.link.update',scope);return e.stopPropagation();});scope.update=function(data){scope.data=data;ngModel.$setViewValue(scope.data);return ngModel.$render();};ngModel.$render=function(){return scope.data=ngModel.$viewValue;};loaded={label:attrs.label||attrs.name,key:attrs.ngModel};return station.$emit('widget.link.loaded',loaded,scope);}};}]);}).call(this);(function(){angular.module('boltApp').directive('supWidgetCarousel',['$rootScope','$window',function($rootScope,$window){return{scope:{default:'@',allowTypes:'@',allowFields:'@',limit:'@'},restrict:'AE',require:'?ngModel',link:function(scope,element,attrs,ngModel){var _default,clip,default_data,e,i,len,loaded,root,station;if(!ngModel){return;}
if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station){return;}
try{_default=scope.$eval(scope.default);default_data=[];for(i=0,len=_default.length;i<len;i++){clip=_default[i];default_data.push({title:clip.title||'',src:clip.src||'',type:clip.type||'image',link:'',target:'',caption:clip.caption||''});}}catch(error){e=error;default_data=[];}
if(!angular.isArray(default_data)){default_data=[];}
scope.limit=Math.min(angular.parse_int(scope.limit,12,true),24);scope.options={allow_types:scope.allowTypes||attrs.supWidgetCarousel,allow_fields:angular.str2opts(scope.allowFields),link_to_type:attrs.linkToType,limit:scope.limit,lite:angular.isDefined(attrs.lite)};element.on("mousedown",function(e){if(station.strict_mode){return;}
station.$emit('widget.carousel.update',scope);return e.stopPropagation();});scope.update=function(data){if(!data||data.length===0){data=null;}
scope.data=data||default_data;ngModel.$setViewValue(scope.data);return ngModel.$render();};element.on('$destroy',function(){ngModel.$render=angular.noop;if(angular.equals(ngModel.$viewValue,default_data)){return ngModel.$setViewValue(null);}});ngModel.$render=function(){if(!angular.isArray(ngModel.$viewValue)){ngModel.$setViewValue(default_data);}
return scope.data=ngModel.$viewValue;};loaded={label:attrs.label||attrs.name,key:attrs.ngModel};return station.$emit('widget.carousel.loaded',loaded,scope);}};}]);}).call(this);(function(){angular.module('boltApp').directive('supWidgetCatalog',['$rootScope','$window',function($rootScope,$window){return{scope:{contentType:'@',itemsLimit:'@',limit:'@'},restrict:'AE',require:'?ngModel',link:function(scope,element,attrs,ngModel){var default_data,loaded,root,station;if(!ngModel){return;}
if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station){return;}
default_data=[];scope.limit=Math.min(angular.parse_int(scope.limit,6,true),12);scope.items_limit=angular.parse_int(scope.itemsLimit,6,true);scope.items_limit=Math.min(scope.items_limit,12);scope.options={content_type:scope.contentType,items_limit:scope.items_limit,limit:scope.limit};element.on("mousedown",function(e){if(station.strict_mode){return;}
station.$emit('widget.catalog.update',scope);return e.stopPropagation();});scope.update=function(data){if(!data||data.length===0){data=null;}
scope.data=data||default_data;ngModel.$setViewValue(scope.data);return ngModel.$render();};element.on('$destroy',function(){ngModel.$render=angular.noop;if(angular.equals(ngModel.$viewValue,default_data)){return ngModel.$setViewValue(null);}});ngModel.$render=function(){if(!angular.isArray(ngModel.$viewValue)){ngModel.$setViewValue(default_data);}
return scope.data=ngModel.$viewValue;};loaded={label:attrs.label||attrs.name,key:attrs.ngModel};return station.$emit('widget.catalog.loaded',loaded,scope);}};}]);}).call(this);(function(){angular.module('boltApp').directive('supWidgetCreate',['$rootScope','$window',function($rootScope,$window){return{scope:{type:'@',parent:'@',template:'@'},restrict:'AE',link:function(scope,element,attrs){var root,station;if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station||!station.create_file){return;}
return element.on("mousedown",function(e){if(station.strict_mode){return;}
station.create_file(scope.type,scope.template,scope.parent||'');return e.stopPropagation();});}};}]);}).call(this);(function(){angular.module('boltApp').directive('supWidgetBulletin',['$rootScope','$window',function($rootScope,$window){return{scope:null,restrict:'AE',require:'?ngModel',link:function(scope,element,attrs,ngModel){var default_data,loaded,root,station;if(!ngModel){return;}
if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station){return;}
default_data={};scope.options={};element.on("mousedown",function(e){if(station.strict_mode){return;}
station.$emit('widget.bulletin.update',scope);return e.stopPropagation();});scope.update=function(data){scope.data=data||default_data;ngModel.$setViewValue(scope.data);return ngModel.$render();};element.on('$destroy',function(){ngModel.$render=angular.noop;if(angular.equals(ngModel.$viewValue,default_data)){return ngModel.$setViewValue(null);}});ngModel.$render=function(){if(!angular.isObject(ngModel.$viewValue)){ngModel.$setViewValue(default_data);}
return scope.data=ngModel.$viewValue;};loaded={label:attrs.label||attrs.name,key:attrs.ngModel};return station.$emit('widget.bulletin.loaded',loaded,scope);}};}]);}).call(this);(function(){angular.module('boltApp').directive('supWidgetForm',['$rootScope','$window',function($rootScope,$window){return{scope:{limit:'@',optLimit:'@'},restrict:'AE',require:'?ngModel',link:function(scope,element,attrs,ngModel){var loaded,root,station;if(!ngModel){return;}
if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station){return;}
scope.options={limit:Math.min(angular.parse_int(scope.limit,12,true),24),opt_limit:Math.min(angular.parse_int(scope.optLimit,6,true),24)};element.on("mousedown",function(e){if(station.strict_mode){return;}
station.$emit('widget.form.update',scope);return e.stopPropagation();});scope.update=function(data){scope.data=data;ngModel.$setViewValue(scope.data);return ngModel.$render();};ngModel.$render=function(){return scope.data=ngModel.$viewValue;};loaded={label:attrs.label||attrs.name,key:attrs.ngModel};return station.$emit('widget.form.loaded',loaded,scope);}};}]);}).call(this);(function(){angular.module('boltApp').directive('supWidgetLines',['$rootScope','$window',function($rootScope,$window){return{scope:{default:"@",limit:"@"},restrict:'AE',require:'?ngModel',link:function(scope,element,attrs,ngModel){var _default,default_data,e,i,len,loaded,root,station,str;if(!ngModel){return;}
if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station){return;}
try{_default=scope.$eval(scope.default);default_data=[];for(i=0,len=_default.length;i<len;i++){str=_default[i];if(angular.isString(str)&&str){default_data.push({text:str});}else if(angular.isDict(str)&&str.text){default_data.push({text:str.text});}}}catch(error){e=error;default_data=[];}
if(!angular.isArray(default_data)){default_data=[];}
scope.limit=Math.min(angular.parse_int(scope.limit,12,true),24);scope.options={limit:scope.limit};element.on("mousedown",function(e){if(station.strict_mode){return;}
station.$emit('widget.lines.update',scope);return e.stopPropagation();});scope.update=function(data){scope.data=data||default_data;ngModel.$setViewValue(scope.data);return ngModel.$render();};element.on('$destroy',function(){ngModel.$render=angular.noop;if(angular.equals(ngModel.$viewValue,default_data)){return ngModel.$setViewValue(null);}});ngModel.$render=function(){if(!angular.isArray(ngModel.$viewValue)){ngModel.$setViewValue(default_data);}
return scope.data=ngModel.$viewValue;};loaded={label:attrs.label||attrs.name,key:attrs.ngModel};return station.$emit('widget.lines.loaded',loaded,scope);}};}]);}).call(this);(function(){angular.module('boltApp').directive('supWidgetMedia',['$rootScope','$window',function($rootScope,$window){return{scope:{allowTypes:'@',allowFields:'@'},restrict:'AE',require:'?ngModel',link:function(scope,element,attrs,ngModel){var loaded,root,station;if(!ngModel){return;}
if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station){return;}
scope.options={allow_types:scope.allowTypes||attrs.supWidgetMedia,allow_fields:angular.str2opts(scope.allowFields),resizable:angular.isDefined(attrs.resizable),lite:angular.isDefined(attrs.lite)};element.on("mousedown",function(e){if(station.strict_mode){return;}
station.$emit('widget.media.update',scope);return e.stopPropagation();});scope.update=function(data){scope.data=data;ngModel.$setViewValue(scope.data);return ngModel.$render();};ngModel.$render=function(){return scope.data=ngModel.$viewValue;};loaded={label:attrs.label||attrs.name,key:attrs.ngModel};return station.$emit('widget.media.loaded',loaded,scope);}};}]);}).call(this);(function(){angular.module('boltApp').directive('supWidgetOpen',['$rootScope','$window',function($rootScope,$window){return{scope:{supWidgetOpen:"=",file:"="},restrict:'AE',link:function(scope,element,attrs){var root,station;if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station||!station.open_file){return;}
return element.on("mousedown",function(e){if(station.strict_mode){return;}
station.open_file(scope.file||scope.supWidgetOpen);return e.stopPropagation();});}};}]);}).call(this);(function(){angular.module('boltApp').directive('supWidgetScript',['$rootScope','$window',function($rootScope,$window){return{scope:{},restrict:'AE',require:'?ngModel',link:function(scope,element,attrs,ngModel){var loaded,root,station;if(!ngModel){return;}
if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station){return;}
element.on("mousedown",function(e){if(station.strict_mode){return;}
station.$emit('widget.script.update',scope);return e.stopPropagation();});scope.update=function(data){scope.data=data||'';ngModel.$setViewValue(scope.data);return ngModel.$render();};ngModel.$render=function(){return scope.data=ngModel.$viewValue;};loaded={label:attrs.label||attrs.name,key:attrs.ngModel};return station.$emit('widget.script.loaded',loaded,scope);}};}]);}).call(this);(function(){angular.module('boltApp').directive('supWidgetSegments',['$rootScope','$window',function($rootScope,$window){return{scope:{content_type:'@',parent:'@',limit:'@'},restrict:'AE',require:'ngModel',controller:['$scope',function($scope){var self;self=this;self.$editSegment=function(index){if($scope.strict_mode){return;}
return $scope.edit(index);};self.$createSegment=function(template){if($scope.strict_mode){return;}
return $scope.create(template);};return self;}],link:function(scope,element,attrs,ngModel){var app,file,queries,query_limit,query_segments,restEditor,root,station,update_add_element;if(!ngModel){return;}
query_limit=1;queries=$window.document.querySelectorAll('[sup-widget-segments], sup-widget-segments');if(queries.length>query_limit){console.error('Query overrun.',element[0]);return;}
if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station){return;}
scope.strict_mode=station.strict_mode;app=station.editor_context.app;file=station.file;restEditor=station.restEditor;scope.limit=Math.min(angular.parse_int(scope.limit,24,true),24);scope.data=[];update_add_element=function(data){var el_add;if(!data||!data.length){return;}
el_add=angular.element(element[0].querySelector('[segment-create]'));if(!el_add){return;}
if(data.length>=scope.limit){return el_add.addClass('ng-hide');}else{return el_add.removeClass('ng-hide');}};query_segments=function(){return restEditor.segments.query({app_id:app.id,content_type:scope.content_type||file.content_type,parent:scope.parent||file.slug}).$promise.then(function(data){update_add_element(data);ngModel.$setViewValue(data);return scope.data=ngModel.$viewValue;});};query_segments();scope.refresh=function(){return query_segments();};scope.edit=function(index){if(!scope.data[index]){return;}
return station.open_file(scope.data[index]);};return scope.create=function(template){var content_type,parent;content_type=scope.content_type||file.content_type;parent=scope.parent||file.slug;return station.create_file(content_type,template,parent,true);};}};}]).directive('segment',[function(){return{scope:false,restrict:'A',require:'?^supWidgetSegments',link:function(scope,element,attrs,segmentsCtrl){if(!segmentsCtrl){return;}
return element.on("mousedown",function(e){if(!angular.isNumber(scope.$index)){return;}
segmentsCtrl.$editSegment(scope.$index);return e.stopPropagation();});}};}]).directive('segmentCreate',[function(){return{scope:{template:'@'},restrict:'A',require:'?^supWidgetSegments',link:function(scope,element,attrs,segmentsCtrl){if(!segmentsCtrl){return;}
return element.on("mousedown",function(e){segmentsCtrl.$createSegment(scope.template);return e.stopPropagation();});}};}]);}).call(this);(function(){angular.module('boltApp').directive('supWidgetSeries',['$rootScope','$window',function($rootScope,$window){return{scope:{default:'@',allowTypes:'@',allowFields:'@',limit:'@'},restrict:'AE',require:'ngModel',controller:['$scope',function($scope){this.$editSeriesItem=function(index){if($scope.strict_mode){return;}
return $scope.edit(index);};this.$addSeriesItem=function(){if($scope.strict_mode){return;}
return $scope.add();};return this;}],link:function(scope,element,attrs,ngModel){var _clean_up,_default,check_limit,curr_index,default_data,e,i,item,len,loaded,root,station;if(!ngModel){return;}
if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station){return;}
scope.strict_mode=station.strict_mode;try{_default=scope.$eval(scope.default);default_data=[];for(i=0,len=_default.length;i<len;i++){item=_default[i];default_data.push({src:item.src||'',touch:item.touch||'',type:item.type||'image',title:item.title||'',subtitle:item.subtitle||'',caption:item.caption||'',link:'',target:'',class:'',poster:item.poster||'',extra:item.extra||'',tags:item.tags||[]});}}catch(error){e=error;default_data=[];}
if(!angular.isArray(default_data)){default_data=[];}
scope.limit=Math.min(angular.parse_int(scope.limit,24,true),24);scope.options={allow_types:scope.allowTypes||attrs.supWidgetSeries,allow_fields:angular.str2opts(scope.allowFields),limit:scope.limit,lite:angular.isDefined(attrs.lite)};scope.item=null;curr_index=null;check_limit=function(data){var el,el_add;el=element[0].querySelector('[series-item-create]');if(!data||!el){return;}
el_add=angular.element(el);if(data.length>=scope.limit){el_add.addClass('ng-hide');if(data.length>scope.limit){return data.length=scope.limit;}}else{return el_add.removeClass('ng-hide');}};_clean_up=function(){var d,j,k,len1,len2,ref,results;scope.item=null;curr_index=null;ref=scope.data;for(j=0,len1=ref.length;j<len1;j++){item=ref[j];delete item._index;}
check_limit(scope.data);if(scope.data.length===0){results=[];for(k=0,len2=default_data.length;k<len2;k++){d=default_data[k];results.push(scope.data.push(d));}
return results;}};scope.edit=function(index){if(!angular.isNumber(index)){return;}
curr_index=index;scope.item=scope.data[index]||{};scope.item._index=index;return station.$emit('widget.series.update',scope);};scope.add=function(){curr_index=null;scope.item=null;return station.$emit('widget.series.create',scope);};scope.update=function(item){var next_index;if(!angular.isObject(item)||item.deleted){scope.data.splice(curr_index,1);}else if(angular.isNumber(item._index)){scope.data[curr_index]=item;next_index=item._index;angular.list_shift(scope.data,curr_index,next_index,false);}
return _clean_up();};scope.create=function(item){var next_index;if(angular.isObject(item)){scope.data.push(item);}
curr_index=scope.data.length-1;if(item._index){next_index=item._index;angular.list_shift(scope.data,curr_index,next_index,false);}
return _clean_up();};element.on('$destroy',function(){ngModel.$render=angular.noop;if(angular.equals(ngModel.$viewValue,default_data)){return ngModel.$setViewValue(null);}});ngModel.$render=function(){if(!angular.isArray(ngModel.$viewValue)){ngModel.$setViewValue(default_data);}
scope.data=ngModel.$viewValue;return check_limit(scope.data);};loaded={label:attrs.label||attrs.name,key:attrs.ngModel};return station.$emit('widget.series.loaded',loaded,scope);}};}]).directive('seriesItem',[function(){return{scope:false,restrict:'A',require:'?^supWidgetSeries',link:function(scope,element,attrs,seriesCtrl){if(!seriesCtrl){return;}
return element.on("mousedown",function(e){if(!angular.isNumber(scope.$index)){return;}
seriesCtrl.$editSeriesItem(scope.$index);return e.stopPropagation();});}};}]).directive('seriesItemCreate',[function(){return{scope:false,restrict:'A',require:'?^supWidgetSeries',link:function(scope,element,attrs,seriesCtrl){if(!seriesCtrl){return;}
return element.on("mousedown",function(e){seriesCtrl.$addSeriesItem();return e.stopPropagation();});}};}]);}).call(this);(function(){angular.module('boltApp').directive("supWidgetText",['$rootScope','$timeout','$interpolate','$window',function($rootScope,$timeout,$interpolate,$window){return{scope:{default:"@"},restrict:"AE",require:"?ngModel",link:function(scope,element,attrs,ngModel){var clear_html,clear_style,default_data,dirty,loaded,readViewText,root,station;if(!ngModel){return;}
if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station){return;}
dirty=false;if(!station.strict_mode){element[0].setAttribute('contenteditable','true');}
if(scope.default){default_data=scope.default;}else{default_data=$interpolate(element.html().trim())($rootScope);}
element.on("click mousedown",function(e){if(station.strict_mode){return;}
station.$emit('widget.text.touch',scope);return e.stopPropagation();});ngModel.$render=function(){var timer;if(!ngModel.$viewValue&&!dirty){element.html(default_data);timer=$timeout(function(){readViewText();return $timeout.cancel(timer);},0);}else{element.html(ngModel.$viewValue||"");}
return dirty=true;};element.on("blur keyup change cut",function(e){if(station.strict_mode){return;}
readViewText();return e.stopPropagation();});clear_html=function(html){html=html.replace(/<div\s*.*?>/ig,'<br>');html=html.replace(/<(?!br\s*\/?)[^>]+>/ig,'');if(html==="<br>"){html="";}
return html;};clear_style=function(elm){var el,i,len,ref;elm.removeAttribute('style');ref=elm.children;for(i=0,len=ref.length;i<len;i++){el=ref[i];clear_style(el);}};element.on("paste",function(e){var text;if(station.strict_mode){return;}
if(e.clipboardData&&e.clipboardData.getData){e.preventDefault();text=e.clipboardData.getData("text/plain");return $window.document.execCommand("insertText",false,text);}else if($window.clipboardData&&$window.clipboardData.getData){e.preventDefault();text=$window.clipboardData.getData("Text");return $window.document.execCommand("insertText",false,text);}});readViewText=function(){var html;html=clear_html(element.html());if(html==="<br>"){html="";}
return ngModel.$setViewValue(html.trim());};loaded={label:attrs.label||attrs.name,key:attrs.ngModel};return station.$emit('widget.text.loaded',loaded,scope);}};}]);}).call(this);(function(){angular.module('boltApp').directive('supWidgetShelf',['$rootScope','$window',function($rootScope,$window){return{scope:null,restrict:'AE',link:function(scope,element,attrs){var app,file,inited,loaded,queries,query_limit,query_shelf,restEditor,root,station;query_limit=1;queries=$window.document.querySelectorAll('sup-widget-shelf','[sup-widget-shelf]');if(queries.length>query_limit){console.error('Too many shelf.',element[0]);return;}
if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station){return;}
app=station.editor_context.app;restEditor=station.restEditor;file=station.file;scope.data=file.shelf||{};inited=false;query_shelf=function(shelf){if(shelf&&shelf.commodity_id){return restEditor.doEditorShelf(app.slug,{shelf:shelf}).then(function(data){return file.shelf=scope.data=data.shelf;});}else{return file.shelf=scope.data={};}};element.on("mousedown",function(e){if(station.strict_mode){return;}
station.$emit('widget.shelf.update',scope);return e.stopPropagation();});scope.update=function(data){return query_shelf(data);};if(!inited){query_shelf(file.shelf);inited=true;}
loaded={label:attrs.label||attrs.name,key:'shelf'};return station.$emit('widget.shelf.loaded',loaded,scope);}};}]);}).call(this);(function(){angular.module('boltApp').directive('supWidgetSlot',['$rootScope','$window',function($rootScope,$window){return{scope:{key:"@",allowFields:'@'},restrict:'AE',link:function(scope,element,attrs){var loaded,root,station;if($window.parent){root=$window.parent.angular.element($window.parent.document).scope();}else{root=$rootScope;}
station=root.station;if(!station||!station.edit_slot){return;}
scope.options={allow_fields:angular.str2opts(scope.allowFields)};element.on("mousedown",function(e){if(station.strict_mode){return;}
station.edit_slot(scope.key,scope.options);return e.stopPropagation();});loaded={label:attrs.label||attrs.name,key:scope.key};return station.$emit('widget.slot.loaded',loaded,scope);}};}]);}).call(this);