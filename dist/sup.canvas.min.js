(function(){angular.module("boltApp",["ngSanitize","supLocales","supAngularWysiwyg","supAngularMarkdown"])}).call(this);(function(){angular.module("boltApp").constant("Config",{baseURL:{self:sup.server.self,api:sup.server.api,docs:sup.server.docs,libs:sup.server.libs,"static":sup.server["static"],uploads:sup.server.uploads,apps:sup.server.apps,agent:sup.server.agent},debug:sup.debug,browser:sup.browser,protocols:[{key:"http",name:"Http"}],locales:[{code:"en_US",text:"English"},{code:"zh_CN",text:"简体中文"}],default_locale:"en_US",max_image_size:{width:1650,height:1650},max_file_size:{image:960*1024,video:36*1024*1024,audio:8*1024*1024,zip:18*1024*1024,docs:8*1024*1024},media_encoder_options:.8,media_mimetypes:{image:["image/png","image/jpeg","image/svg+xml","image/gif","image/bmp"],video:["video/mp4","video/quicktime"],audio:["audio/mpeg","audio/mp3"],application:["application/zip","application/pdf"]},invite:{codes_limit:6,invited_limit:6},markdown:false,path:{oauth:["/oauth"],editor:["/editor"],outer:["/login","/register","/recovery"],open:["/404","/403"]},theme_types:{CUSTOM_THEME:"custom",DEFAULT_THEME:"default"},app_types:[{name:"Website",slug:"ws",ico:"av:ic_web_24px",archivable:true,movable:true},{name:"WeChat Buzz",slug:"wx",ico:"comm:ic_chat_24px"}],copyright:"&copy; Soopro Co.,ltd."})}).call(this);(function(){angular.module("boltApp").config(["$sceDelegateProvider",function(e){return e.resourceUrlWhitelist(["self","http://libs.sup.farm/**","http://libs.soopro.io/**"])}])}).call(this);(function(){var e=[].indexOf||function(e){for(var t=0,r=this.length;t<r;t++){if(t in this&&this[t]===e)return t}return-1};angular.module("boltApp").filter("trust",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("thumbnail",["Config",function(t){return function(r,n){var i,u,a,o,s;if(!n){n="thumbnail"}if(typeof r!=="string"){return r}u=["jpg","jpeg","png","gif","bmp","tiff"];try{i=angular.get_file_ext(r)}catch(o){a=o;i=null}if(r.indexOf(t.baseURL.uploads)>-1&&e.call(u,i)>=0){s=r.indexOf("?")>-1?"&":"?";return r+s+n}return r}}]).filter("url",["$rootScope",function(e){return function(t,r,n){var i;if(typeof t!=="string"){return t}if(r){i=t.indexOf("?");if(i>-1){t=t.substring(0,i)}}if(n){i=t.indexOf("#");if(i>-1){t=t.substring(0,i)}}if(!t||angular.isUrl(t)){return t}else if(angular.startswith(t,"/")){return e.base_url+t.replace(/(^\/)|(\/$)/g,"")}else{return t.replace(/\/$/g,"")}}}]).filter("path",["$rootScope",function(e){return function(t,r,n){var i,u,a,o;if(typeof t!=="string"){return t}if(r||r===void 0){a=t.indexOf("?");if(a>-1){t=t.substring(0,a)}}if(n||n===void 0){a=t.indexOf("#");if(a>-1){t=t.substring(0,a)}}try{o=t.split(e.base_url).pop()}catch(u){i=u;o=t}return"/"+o.replace(/^\//g,"").replace(/\/$/g,"")}}]).filter("args",function(){return function(e,t){if(typeof e!=="string"){return{}}return angular.getURLParams(e,t)}}).filter("join",function(){return function(e,t){if(angular.isArray(e)){if(!t){t=", "}return e.join(t)}else{return e}}}).filter("striptags",function(){return function(e){return String(e).replace(/<[^>]+>/gm,"")}}).filter("int",function(){return function(e){var t;try{e=parseInt(e)}catch(t){e=null}return e}}).filter("string",function(){return function(e){var t,r;try{r=e.toString()}catch(t){r=""}return r}}).filter("is_empty",function(){return function(e){var t;if(angular.isArray(e)){t=!e||e.length<=0}else if(angular.isObject(e)){t=!e||Object.keys(e).length<=0}else if(angular.isFunction(e)||angular.isElement(e)){t=true}else{t=!Boolean(e)}return t}}).filter("date_formatted",["$filter","$rootScope",function(e,t){return function(r,n){var i,u,a,o,s;if(!r){return""}if(typeof n!=="string"){n=null}a={en:"MMMM d, yyyy",zh:"yyyy年 MM月 dd日"};try{s=t.locale;o=t.lang||s.split("_")[0]}catch(i){s=null;o=null}u=n||a[s]||a[o]||null;if(!u){return r}else{return e("date")(r,u)}}}])}).call(this);(function(){angular.module("boltApp").directive("editorCanvas",["$compile",function(e){return{restrict:"AE",scope:{},controller:["$scope","$sce","$rootScope","$element","$compile","$interval","$timeout","supLocales",function(e,t,r,n,i,u,a,o){var s,l,c,p,f,d,g,m,w,y,v;if(typeof angular.translate==="function"){e._=angular.translate}if(window.parent){g=parent.angular.element(parent.document).scope()}else{g=r}m=g.station;if(!m){console.log("Canvas must running in an iframe.");return}d=m.restEditor;p=null;v=false;e.g={};e.query={};e.app=m.app;e.file=m.file;e.content=e.file.content;e.meta=e.file.meta;e.config=m.config;e.show_html=m.show_html;m.setCanvas(e);l=function(t,r){m.display_canvas(false);return d.doEditorTpl(t,r).then(function(t){var r,u,s;if(v){s=t.tpl.replace("sup-angular-wysiwyg","sup-angular-markdown-render")}else{s=t.tpl}o.load(e.app.locale,t.localized_dict);n.html(s);r=i(n.contents());r(e);e.g={};e.query={};return u=a(function(){m.display_canvas(true);return a.cancel(u)},500)})};y=function(t){if(p!==t){l(e.app.slug,t);return p=t}};w=function(t){e.site_meta=t.site_meta;e.theme_meta=t.theme_meta;e.base_url=r.base_url=t.base_url;e.theme_url=r.theme_url=t.theme_url;e.libs_url=r.libs_url=t.libs_url;e.locale=r.locale=t.locale;e.lang=r.lang=t.lang;e.menu=t.menu;e.taxonomy=e.tax=t.taxonomy;e.translates=t.translates;e.socials=t.socials;e.extension_slots=t.extension_slots;e.sa=t.sa;e.now=parseInt(Date.now()/1e3);return v=t.useMarkdown};e.trustAsHtml=function(e){return t.trustAsHtml(e)};e.$watch("config",function(e){return w(e)},true);e.$watch("file.template",function(e){return y(e)});e.$watch("file",function(t){e.content=t.content;e.meta=t.meta;e.meta.id=t.id;e.meta.url=t.url;e.meta.priority=t.priority;e.meta.parent=t.parent;e.meta.type=e.meta.cotnent_type=t.content_type;e.meta.status=t.status;e.meta.updated=t.updated;e.meta.created=t.created;e.meta.date=t.date;e.meta.template=t.template;e.meta.tags=t.tags;return e.meta.taxonomy=t.taxonomy},true);e.$watch("content",function(t){return e.file.content=t});f=u(function(){},500);n.on("click",function(e){return m.focusCanvas()});c=[];s=r.$on("editor.complete",function(e,t){if(typeof t.destroy==="function"){return c.push(t)}});return e.destory=function(){var e,t,r;for(t=0,r=c.length;t<r;t++){e=c[t];e.destroy()}s();return u.cancel(f)}}]}}]).directive("fakeLink",function(){return{scope:{},restrict:"A",link:function(e,t,r){return t.bind("click mousedown",function(e){e.stopPropagation();e.preventDefault();return false})}}}).directive("supWidgetText",["$rootScope","$timeout","$interpolate",function(e,t,r){return{scope:{"default":"@"},restrict:"AE",require:"?ngModel",link:function(n,i,u,a){var o,s,l,c,p,f,d;if(!a){return}if(window.parent){f=parent.angular.element(parent.document).scope()}else{f=e}d=f.station;if(!d){return}i[0].setAttribute("contenteditable","true");c=false;if(n["default"]){l=n["default"]}else{l=r(i.html().trim())(e)}i.on("click mousedown",function(e){d.$emit("widget.update_text",n);return e.stopPropagation()});a.$render=function(){var e;if(!a.$viewValue&&!c){i.html(l);e=t(function(){p();return t.cancel(e)},0)}else{i.html(a.$viewValue||"")}return c=true};i.on("blur keyup change cut",function(e){p();return e.stopPropagation()});o=function(e){e=e.replace(/<div\s* .*?>/gi,"<br>");e=e.replace(/<(?!br\s*\/?)[^>]+>/gi,"");if(e==="<br>"){e=""}return e};s=function(e){var t,r,n,i;e.removeAttribute("style");i=e.children;for(r=0,n=i.length;r<n;r++){t=i[r];s(t)}};i.on("paste",function(e){var r;r=t(function(){s(i[0]);i.html(o(i.html()));p();return t.cancel(r)},0);return e.stopPropagation()});return p=function(){var e;e=o(i.html());if(e==="<br>"){e=""}return a.$setViewValue(e.trim())}}}}]).directive("supWidgetMedia",["$rootScope",function(e){return{scope:{allowTypes:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}a=u.station;if(!a){return}t.allow_types=t.allowTypes||n.supWidgetMedia;r.on("mousedown",function(e){if(e.supObstructed){return}a.$emit("widget.update_media",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supWidgetBg",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}a=u.station;if(!a){return}r.on("mousedown",function(e){if(e.target!==r[0]){return}a.$emit("widget.update_bg",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supWidgetScript",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}a=u.station;if(!a){return}r.on("mousedown",function(e){if(e.supObstructed){return}a.$emit("widget.update_script",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supWidgetButton",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}a=u.station;if(!a){return}r.on("mousedown",function(e){if(e.supObstructed){return}a.$emit("widget.update_button",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supWidgetCollection",["$rootScope",function(e){return{scope:{allowTypes:"@",syncType:"@",limit:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}a=u.station;if(!a){return}t.allow_types=t.allowTypes||n.supWidgetCollection;t.sync_type=t.syncType;r.on("mousedown",function(e){if(e.supObstructed){return}a.$emit("widget.update_collection",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supWidgetLines",["$rootScope",function(e){return{scope:{"default":"@",limit:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a,o,s,l,c,p,f,d;if(!i){return}if(window.parent){p=parent.angular.element(parent.document).scope()}else{p=e}f=p.station;if(!f){return}try{u=t.$eval(t["default"]);a=[];for(l=0,c=u.length;l<c;l++){d=u[l];if(angular.isString(d)&&d){a.push({text:d})}else if(angular.isObject(d)&&d.text){a.push({text:d.text})}}}catch(s){o=s;a=[]}if(!angular.isArray(a)){a=[]}r.on("mousedown",function(e){if(e.supObstructed){return}f.$emit("widget.update_lines",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){if(!angular.isArray(i.$viewValue)){i.$setViewValue(a)}return t.data=i.$viewValue}}}}]).directive("supWidgetOption",["$rootScope",function(e){return{scope:{structure:"="},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a,o,s,l,c;if(!i){return}if(window.parent){s=parent.angular.element(parent.document).scope()}else{s=e}l=s.station;if(!l){return}u={};if(angular.isDict(t.structure)){o=t.structure;for(a in o){c=o[a];if(c["default"]){u[a]=c["default"]}}}r.on("mousedown",function(e){if(e.supObstructed){return}l.$emit("widget.update_option",t);return e.stopPropagation()});t.update=function(e){t.data=e||u;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){if(!angular.isDict(i.$viewValue)){i.$setViewValue(u)}return t.data=i.$viewValue}}}}]).directive("supWidgetForm",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}a=u.station;if(!a){return}r.on("mousedown",function(e){if(e.supObstructed){return}a.$emit("widget.update_form",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supWidgetOpen",["$rootScope",function(e){return{scope:{file:"=file"},restrict:"AE",link:function(t,r,n){var i,u;if(window.parent){i=parent.angular.element(parent.document).scope()}else{i=e}u=i.station;if(!u||!u.open){return}return r.on("mousedown",function(e){u.open(t.file);return e.stopPropagation()})}}}]).directive("supQuery",["$rootScope",function(e){return{scope:{attrs:"=",sortby:"=",perpage:"=",paged:"=",priority:"=",withContent:"="},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a,o,s,l,c,p,f,d,g,m,w,y,v,$;if(!i){return}f=6;$=document.querySelectorAll("[sup-query]");for(l=c=0,p=$.length;c<p;l=++c){w=$[l];if(l>f){console.error("supQuery overrun.",r[0]);return}}if(window.parent){g=parent.angular.element(parent.document).scope()}else{g=e}v=g.station;if(!v){return}a=v.app;d=v.restEditor;if(n.supQuery){y=n.supQuery;if(y.indexOf("[")>=0||y.indexOf("{")>=0){try{u=JSON.parse(n.supQuery);if(!angular.isObject(u)){throw true}}catch(s){u=null}}if(!u){u={type:y}}m=angular.list(u)}else{m=null}o={attrs:angular.list(t.attrs)||m||[],sortby:angular.list(t.sortby),perpage:angular.parse_int(t.perpage,1,true),paged:angular.parse_int(t.paged,1,true),priority:angular.bool(t.priority),with_content:angular.bool(t.withContent)};return d.doEditorQuery(a.id,o).then(function(e){return i.$setViewValue(e)})}}}]).directive("supQuerySides",["$rootScope",function(e){return{scope:{pid:"=",attrs:"=",sortby:"=",limit:"=",priority:"="},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a,o,s,l,c,p,f,d,g,m,w,y,v,$;if(!i){return}f=3;$=document.querySelectorAll("[sup-query-sides]");for(l=c=0,p=$.length;c<p;l=++c){w=$[l];if(l>f){console.error("supQuerySide overrun.",r[0]);return}}if(window.parent){g=parent.angular.element(parent.document).scope()}else{g=e}v=g.station;if(!v){return}if(!t.pid){i.$setViewValue({});return}a=v.app;d=v.restEditor;if(n.supQuerySides){y=n.supQuerySides;if(y.indexOf("[")>=0||y.indexOf("{")>=0){try{u=JSON.parse(n.supQuery);if(!anuglar.isObject(u)){throw true}}catch(s){u=null}}if(!u){u={type:y}}m=angular.list(u)}else{m=null}o={pid:t.pid,attrs:angular.list(t.attrs)||m||[],sortby:angular.list(t.sortby),limit:angular.parse_int(t.limit,6,true),priority:angular.bool(t.priority)};return d.doEditorQuerySides(a.id,o).then(function(e){return i.$setViewValue(e)})}}}]).directive("supScript",["Config",function(e){return{restrict:"AE",compile:function(t,r){var n,i,u;if(typeof r.path!=="string"){return}if(!r.source){u=e.baseURL.libs}if(r.noSource===void 0){n=u+"/"+r.path.replace(/^[\/\\]*/g,"")}else{n=r.path}i=document.createElement("script");i.setAttribute("ng-src","{{'"+n+"'}}");t.append(i);return t[0].removeAttribute("path")}}}]).directive("supSet",[function(){return{scope:{value:"@",object:"="},restrict:"AE",require:"?ngModel",link:function(e,t,r,n){if(!n){return}n.$setViewValue(e.object||e.value);return n.$render=function(){return n.$setViewValue(e.object||e.value)}}}}]).directive("supObstruct",function(){return{restrict:"A",link:function(e,t,r){return t.bind("click mousedown",function(e){return e.supObstructed=true})}}})}).call(this);
