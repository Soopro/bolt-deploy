(function(){angular.module("boltApp",["ngSanitize","supLocales","supAngularWysiwyg","supAngularMarkdown"])}).call(this);(function(){angular.module("boltApp").constant("Config",{baseURL:{self:sup.server.self,api:sup.server.api,docs:sup.server.docs,libs:sup.server.libs,"static":sup.server["static"],uploads:sup.server.uploads,apps:sup.server.apps,agent:sup.server.agent},debug:sup.debug,browser:sup.browser,protocols:[{key:"http",name:"Http"}],locales:[{code:"en_US",text:"English"},{code:"zh_CN",text:"简体中文"}],default_locale:"en_US",max_image_size:{width:1650,height:1650},max_file_size:{image:960*1024,video:36*1024*1024,audio:8*1024*1024,zip:18*1024*1024,docs:8*1024*1024},media_encoder_options:.8,media_mimetypes:{image:["image/png","image/jpeg","image/svg+xml","image/gif","image/bmp"],video:["video/mp4","video/quicktime"],audio:["audio/mpeg","audio/mp3"],application:["application/zip","application/pdf"]},invite:{codes_limit:6,invited_limit:6},markdown:false,path:{oauth:["/oauth"],editor:["/editor"],outer:["/login","/register","/recovery"],open:["/404","/403"]},theme_types:{CUSTOM_THEME:"custom",DEFAULT_THEME:"default"},app_types:[{name:"Website",slug:"ws",ico:"av:ic_web_24px",archivable:true,movable:true},{name:"WeChat Buzz",slug:"wx",ico:"comm:ic_chat_24px"},{name:"Web App",slug:"wa",ico:"hardware:ic_smartphone_24px"},{name:"Digital Book",slug:"wb",ico:"action:ic_book_24px"}],copyright:"&copy; Soopro Co.,ltd."})}).call(this);(function(){angular.module("boltApp").config(["$sceDelegateProvider",function(e){return e.resourceUrlWhitelist(["self","http://libs.sup.farm/**","http://libs.soopro.io/**"])}])}).call(this);(function(){var e,t=[].indexOf||function(e){for(var t=0,r=this.length;t<r;t++){if(t in this&&this[t]===e)return t}return-1};angular.module("boltApp").filter("trust",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("thumbnail",["Config",function(t){return function(r,n){return e(r,n,t.baseURL.uploads)}}]).filter("url",["$rootScope",function(e){return function(t,r,n){var i;if(typeof t!=="string"){return t}if(r){i=t.indexOf("?");if(i>-1){t=t.substring(0,i)}}if(n){i=t.indexOf("#");if(i>-1){t=t.substring(0,i)}}if(!t||angular.isUrl(t)){return t}else if(angular.startswith(t,"/")){return e.base_url+t.replace(/(^\/)|(\/$)/g,"")}else{return t.replace(/\/$/g,"")}}}]).filter("path",["$rootScope",function(e){return function(t,r,n){var i,u,a,o;if(typeof t!=="string"){return t}if(r||r===void 0){a=t.indexOf("?");if(a>-1){t=t.substring(0,a)}}if(n||n===void 0){a=t.indexOf("#");if(a>-1){t=t.substring(0,a)}}try{o=t.split(e.base_url).pop()}catch(u){i=u;o=t}return"/"+o.replace(/^\//g,"").replace(/\/$/g,"")}}]).filter("args",function(){return function(e,t){if(typeof e!=="string"){return{}}return angular.getURLParams(e,t)}}).filter("join",function(){return function(e,t){if(angular.isArray(e)){if(!t){t=", "}return e.join(t)}else{return e}}}).filter("striptags",function(){return function(e){return String(e).replace(/<[^>]+>/gm,"")}}).filter("int",function(){return function(e){var t;try{e=parseInt(e)}catch(t){e=null}return e}}).filter("string",function(){return function(e){var t,r;try{r=e.toString()}catch(t){r=""}return r}}).filter("is_empty",function(){return function(e){var t;if(angular.isArray(e)){t=!e||e.length<=0}else if(angular.isObject(e)){t=!e||Object.keys(e).length<=0}else if(angular.isFunction(e)||angular.isElement(e)){t=true}else{t=!Boolean(e)}return t}}).filter("date_formatted",["$filter","$rootScope",function(e,t){return function(r,n){var i,u,a,o,l;if(!r){return""}if(typeof n!=="string"){n=null}a={en:"MMMM d, yyyy",zh:"yyyy年 MM月 dd日"};try{l=t.locale;o=t.lang||l.split("_")[0]}catch(i){l=null;o=null}u=n||a[l]||a[o]||null;if(!u){return r}else{return e("date")(r,u)}}}]).filter("bg_img",function(){return function(e,t){if(!e&&!t){return""}else if(!e){e=t}return"background-image:url("+e+");"}}).filter("col_offset",function(){return function(e,r,n,i){var u,a,o;i=angular.parse_int(i,12,0);n=angular.parse_int(n,4,true);if(angular.isString(r)){if(t.call(r,"{}")<0){r+="{}"}}else{r=null}if(angular.isArray(e)){u=e.length}else{u=angular.parse_int(e,0,0)}a=Math.floor((i-u*n)/2);if(r){if(a>0){o=r.replace("{}",a)}else{o=""}}else{o=a}return o}});e=function(e,r,n){var i,u,a,o,l;if(!r||typeof r!=="string"){r="thumbnail"}if(typeof e!=="string"){return e}u=["jpg","jpeg","png","gif","bmp","tiff"];try{i=angular.get_file_ext(e)}catch(o){a=o;i=null}if(e.indexOf(n)>-1&&t.call(u,i)>=0){l=e.indexOf("?")>-1?"&":"?";return e+l+r}return e}}).call(this);(function(){var e=[].indexOf||function(e){for(var t=0,r=this.length;t<r;t++){if(t in this&&this[t]===e)return t}return-1};angular.module("boltApp").directive("editorCanvas",["$compile",function(t){return{restrict:"AE",scope:{},controller:["$scope","$rootScope","$element","$compile","$interval","$timeout","supLocales",function(t,r,n,i,u,a,o){var l,s,c,p,f,d,g,m,w,$,v,y,h,b;if(typeof angular.translate==="function"){t._=angular.translate}if(window.parent){w=parent.angular.element(parent.document).scope()}else{w=r}v=w.station;if(!v){console.log("Canvas must running in an iframe.");return}m=v.restEditor;d=null;b=false;t.g={};t.query={};t.app=v.app;t.file=v.file;t.content=t.file.content;t.meta=t.file.meta;t.config=v.config;v.setCanvas(t);c=function(e,r){v.display_canvas(false);return m.doEditorTpl(e,r).then(function(e){var r,u,l;if(b){l=e.tpl.replace("sup-angular-wysiwyg","sup-angular-markdown-render")}else{l=e.tpl}o.load(t.app.locale,e.localized_dict);n.html(l);r=i(n.contents());r(t);t.g={};t.query={};return u=a(function(){v.display_canvas(true);return a.cancel(u)},600)})};h=function(e){if(d!==e){c(t.app.slug,e);return d=e}};y=function(e){t.base_url=r.base_url=e.base_url;t.theme_url=r.theme_url=e.theme_url;t.libs_url=r.libs_url=e.libs_url;t.locale=r.locale=e.locale;t.lang=r.lang=e.lang;t.site_meta=e.site_meta;t.theme_meta=e.theme_meta;t.menu=e.menu;t.taxonomy=e.taxonomy;t.translates=e.translates;t.socials=e.socials;t.extension_slots=e.extension_slots;t.visit=e.visit;t.now=parseInt(Date.now()/1e3);return b=e.useMarkdown};t.$watch("config",function(e){return y(e)},true);t.$watch("file.template",function(e){return h(e)});t.$watch("file",function(e){t.content=e.content;t.meta=e.meta||{};t.meta.id=e.id;t.meta.url=e.url;t.meta.priority=e.priority;t.meta.parent=e.parent;t.meta.type=t.meta.cotnent_type=e.content_type;t.meta.status=e.status;t.meta.updated=e.updated;t.meta.created=e.created;t.meta.date=e.date;t.meta.template=e.template;t.meta.tags=e.tags;return t.meta.taxonomy=e.taxonomy},true);t.$watch("content",function(e){return t.file.content=e});g=u(function(){},300);n.on("click",function(e){return v.focusCanvas()});f={};l=function(t){var r,n,i,u;if(typeof t==="number"){t=[t]}i=true;for(r in f){u=f[r];if(n=parseInt(r),e.call(t,n)>=0){if(!u){i=false}}else{if(u){i=false}}}return i};n.on("keydown keyup",function(e){var t;t=e.type==="keydown";if(f[e.keyCode]===t){return}f[e.keyCode]=t;if(l(27)){return p()}});p=function(){var e;e=!r.escape;v.sidebar(!e);return r.escape=e};$=[];s=r.$on("editor.complete",function(e,t){if(typeof t.destroy==="function"){return $.push(t)}});return t.$on("destroy",function(){var e,t,r;for(e=0,t=$.length;e<t;e++){r=$[e];r.destroy()}s();return u.cancel(g)})}]}}]).directive("supQuery",["$rootScope",function(e){return{scope:{attrs:"=",sortby:"=",perpage:"=",paged:"=",priority:"=",withContent:"="},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a,o,l,s,c,p,f,d,g,m,w,$,v,y;if(!i){return}f=6;y=document.querySelectorAll("[sup-query]");for(s=c=0,p=y.length;c<p;s=++c){w=y[s];if(s>f){console.error("Query overrun.",r[0]);return}}if(window.parent){g=parent.angular.element(parent.document).scope()}else{g=e}v=g.station;if(!v){return}a=v.app;d=v.restEditor;if(n.supQuery){$=n.supQuery;if($.indexOf("[")>=0||$.indexOf("{")>=0){try{u=t.$eval(n.supQuery);if(!angular.isDict(u)){throw true}}catch(l){u=null}}if(!u){u={type:$}}m=angular.list(u)}else{m=null}o={attrs:angular.list(t.attrs,m),sortby:angular.list(t.sortby),perpage:angular.parse_int(t.perpage),paged:angular.parse_int(t.paged),priority:angular.bool(t.priority),with_content:angular.bool(t.withContent)};return d.doEditorQuery(a.id,o).then(function(e){return i.$setViewValue(e)})}}}]).directive("supQuerySides",["$rootScope",function(e){return{scope:{pid:"=",attrs:"=",sortby:"=",limit:"=",priority:"="},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a,o,l,s,c,p,f,d,g,m,w,$,v,y;if(!i){return}f=3;y=document.querySelectorAll("[sup-query-sides]");for(s=c=0,p=y.length;c<p;s=++c){w=y[s];if(s>f){console.error("Query overrun.",r[0]);return}}if(window.parent){g=parent.angular.element(parent.document).scope()}else{g=e}v=g.station;if(!v){return}if(!t.pid){t.pid=v.file.id}a=v.app;d=v.restEditor;if(n.supQuerySides){$=n.supQuerySides;if($.indexOf("[")>=0||$.indexOf("{")>=0){try{u=t.$eval(n.supQuery);if(!angular.isDict(u)){throw true}}catch(l){u=null}}if(!u){u={type:$}}m=angular.list(u)}else{m=null}o={pid:t.pid,attrs:angular.list(t.attrs)||m||[],sortby:angular.list(t.sortby),limit:angular.parse_int(t.limit,1,true),priority:angular.bool(t.priority)};return d.doEditorQuerySides(a.id,o).then(function(e){return i.$setViewValue(e)})}}}]).directive("supScriptLoader",["Config",function(e){return{restrict:"AE",replace:true,compile:function(t,r){var n,i,u;if(typeof r.path!=="string"){return}if(!r.source){u=e.baseURL.libs}if(r.noSource===void 0){i=u+"/"+r.path.replace(/^[\/\\]*/g,"")}else{i=r.path}n=document.createElement("script");n.setAttribute("ng-src","{{'"+i+"'}}");t.append(n);return t[0].removeAttribute("path")}}}]).directive("supSet",[function(){return{scope:{value:"@",object:"="},restrict:"AE",require:"?ngModel",link:function(e,t,r,n){if(!n){return}n.$setViewValue(e.object||e.value);return n.$render=function(){return n.$setViewValue(e.object||e.value)}}}}]).directive("supTempalte",[function(){return{scope:{id:"@"},restrict:"E",transclude:true,replace:true,template:['<script type="text/ng-template" id="{{id}}">',"<ng-transclude></ng-transclude>","</script>"].join("")}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetBg",["$rootScope",function(e){return{scope:{allowTypes:"@",presets:"="},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}a=u.station;if(!a){return}t.allow_types=t.allowTypes||n.supWidgetBg;r.on("mousedown",function(e){if(e.target!==r[0]){return}a.$emit("widget.update_bg",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetButton",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}a=u.station;if(!a){return}r.on("mousedown",function(e){a.$emit("widget.update_button",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetCarousel",["$rootScope",function(e){return{scope:{"default":"@",allowTypes:"@",limit:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a,o,l,s,c,p,f,d;if(!i){return}if(window.parent){f=parent.angular.element(parent.document).scope()}else{f=e}d=f.station;if(!d){return}try{u=t.$eval(t["default"]);o=[];for(c=0,p=u.length;c<p;c++){a=u[c];o.push({title:a.title||"",src:a.src||"",type:a.type||"image",link:"#",target:"",caption:a.caption||"",misc:a.misc||""})}}catch(s){l=s;o=[]}if(!angular.isArray(o)){o=[]}t.allow_types=t.allowTypes||n.supWidgetCarousel;r.on("mousedown",function(e){d.$emit("widget.update_carousel",t);return e.stopPropagation()});t.update=function(e){if(e.length===0){e=null}t.data=e||o;i.$setViewValue(t.data);return i.$render()};r.on("$destroy",function(){i.$render=angular.noop;if(angular.equals(i.$viewValue,o)){return i.$setViewValue(null)}});return i.$render=function(){if(!angular.isArray(i.$viewValue)){i.$setViewValue(o)}return t.data=i.$viewValue}}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetCreate",["$rootScope",function(e){return{scope:{type:"@"},restrict:"AE",link:function(t,r,n){var i,u;if(window.parent){i=parent.angular.element(parent.document).scope()}else{i=e}u=i.station;if(!u||!u.create){return}return r.on("mousedown",function(e){u.create(t.type);return e.stopPropagation()})}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetForm",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}a=u.station;if(!a){return}r.on("mousedown",function(e){a.$emit("widget.update_form",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetLines",["$rootScope",function(e){return{scope:{"default":"@",limit:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a,o,l,s,c,p,f,d;if(!i){return}if(window.parent){p=parent.angular.element(parent.document).scope()}else{p=e}f=p.station;if(!f){return}try{u=t.$eval(t["default"]);a=[];for(s=0,c=u.length;s<c;s++){d=u[s];if(angular.isString(d)&&d){a.push({text:d})}else if(angular.isDict(d)&&d.text){a.push({text:d.text})}}}catch(l){o=l;a=[]}if(!angular.isArray(a)){a=[]}r.on("mousedown",function(e){f.$emit("widget.update_lines",t);return e.stopPropagation()});t.update=function(e){t.data=e||a;i.$setViewValue(t.data);return i.$render()};r.on("$destroy",function(){i.$render=angular.noop;if(angular.equals(i.$viewValue,a)){return i.$setViewValue(null)}});return i.$render=function(){if(!angular.isArray(i.$viewValue)){i.$setViewValue(a)}return t.data=i.$viewValue}}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetMedia",["$rootScope",function(e){return{scope:{allowTypes:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}a=u.station;if(!a){return}t.allow_types=t.allowTypes||n.supWidgetMedia;r.on("mousedown",function(e){a.$emit("widget.update_media",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetOpen",["$rootScope",function(e){return{scope:{supWidgetOpen:"=",file:"="},restrict:"AE",link:function(t,r,n){var i,u;if(window.parent){i=parent.angular.element(parent.document).scope()}else{i=e}u=i.station;if(!u||!u.open){return}return r.on("mousedown",function(e){u.open(t.file||t.supWidgetOpen);return e.stopPropagation()})}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetOption",["$rootScope",function(e){return{scope:{structure:"="},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a,o,l,s,c,p;if(!i){return}if(window.parent){c=parent.angular.element(parent.document).scope()}else{c=e}p=c.station;if(!p){return}u={};if(angular.isArray(t.structure)){s=t.structure;for(a=0,o=s.length;a<o;a++){l=s[a];if(l["default"]){u[l.key]=l["default"]}}}r.on("mousedown",function(e){p.$emit("widget.update_option",t);return e.stopPropagation()});t.update=function(e){t.data=e||u;i.$setViewValue(t.data);return i.$render()};r.on("$destroy",function(){i.$render=angular.noop;if(angular.equals(i.$viewValue,u)){return i.$setViewValue(null)}});return i.$render=function(){if(!angular.isDict(i.$viewValue)){i.$setViewValue(u)}return t.data=i.$viewValue}}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetScript",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,a;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}a=u.station;if(!a){return}r.on("mousedown",function(e){a.$emit("widget.update_script",t);return e.stopPropagation()});t.update=function(e){t.data=e||"";i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetSegments",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"ngModel",controller:["$scope",function(e){this.$editSegment=function(t){return e.edit(t)};this.$createSegment=function(){return e.create()};return this}],link:function(t,r,n,i){var u,a,o,l,s,c,p;if(window.parent){c=parent.angular.element(parent.document).scope()}else{c=e}p=c.station;if(!p){return}u=p.app;s=p.restEditor;t.item=null;o=24;a=function(e){var t;if(!e){return}t=angular.element(r[0].querySelector("[segment-create]"));if(e.length>=o){t.addClass("ng-hide");if(e.length>o){return e.length=o}}else{return t.removeClass("ng-hide")}};l=function(){return s.doEditorSegments(u.id).then(function(e){i.$setViewValue(e);t.data=i.$viewValue;return a(t.data)})};l();t.update=function(){return l()};t.edit=function(e){if(!angular.isNumber(e)||!t.data){return}t.item=t.data[e]||{};t.item.order=e+1;return p.$emit("widget.update_segment",t)};return t.create=function(){return p.create("page",true)}}}}]).directive("segment",[function(){return{scope:false,restrict:"A",require:"?^supWidgetSegments",link:function(e,t,r,n){if(!n){return}return t.on("mousedown",function(t){n.$editSegment(e.$index);return t.stopPropagation()})}}}]).directive("segmentCreate",[function(){return{scope:false,restrict:"A",require:"?^supWidgetSegments",link:function(e,t,r,n){if(!n){return}return t.on("mousedown",function(e){n.$createSegment();return e.stopPropagation()})}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetSeries",["$rootScope",function(e){return{scope:{"default":"@",allowTypes:"@",limit:"@"},restrict:"AE",require:"ngModel",controller:["$scope",function(e){this.$editSeriesItem=function(t){return e.edit(t)};this.$createSeriesItem=function(){return e.create()};return this}],link:function(t,r,n,i){var u,a,o,l,s,c,p,f,d,g,m,w,$,v,y;if(window.parent){v=parent.angular.element(parent.document).scope()}else{v=e}y=v.station;if(!y){return}try{u=t.$eval(t["default"]);s=[];for(f=0,g=u.length;f<g;f++){d=u[f];s.push({title:d.title||"",src:d.src||"",type:d.type||"image",link:"#",target:"",caption:d.caption||"",loop:d.misc||"",autoplay:d.misc||"",poster:d.misc||"",misc:d.misc||"",tags:d.tags||[]})}}catch(p){c=p;s=[]}if(!angular.isArray(s)){s=[]}t.allow_types=t.allowTypes||n.supWidgetSeries;t.item=null;l=null;m=Math.min(angular.parse_int(t.limit,36,true),36);a=function(e){var t,n;t=r[0].querySelector("[series-item-create]");if(!e||!t){return}n=angular.element(t);if(e.length>=m){n.addClass("ng-hide");if(e.length>m){return e.length=m}}else{return n.removeClass("ng-hide")}};w=function(e){var r,n;if(!angular.isDict(e)||e.deleted){return t.data.splice(l,1)}else{r=$(e);t.data[l]=e;if(r!==l){return n=[t.data[r],t.data[l]],t.data[l]=n[0],t.data[r]=n[1],n}}};o=function(e){$(e);if(angular.isDict(e)){return t.data.push(e)}};$=function(e){var r,n,i;i=angular.pop(e,"order");if(!angular.isNumber(i)){n=l}else{n=angular.parse_int(i,0,true)-1}r=angular.parse_int(t.data.length-1,0,0);return Math.min(n,r)};t.edit=function(e){if(!angular.isNumber(e)){return}l=e;t.item=t.data[e]||{};t.item.order=e+1;return y.$emit("widget.update_series",t)};t.create=function(){l=null;t.item=null;return y.$emit("widget.update_series",t)};t.update=function(e){if(angular.isNumber(l)){w(e)}else{o(e)}t.item=null;l=null;return a(t.data)};r.on("$destroy",function(){i.$render=angular.noop;if(angular.equals(i.$viewValue,s)){return i.$setViewValue(null)}});return i.$render=function(){if(!angular.isArray(i.$viewValue)){i.$setViewValue(s)}t.data=i.$viewValue;return a(t.data)}}}}]).directive("seriesItem",[function(){return{scope:false,restrict:"A",require:"?^supWidgetSeries",link:function(e,t,r,n){if(!n){return}return t.on("mousedown",function(t){if(!angular.isNumber(e.$index)){return}n.$editSeriesItem(e.$index);return t.stopPropagation()})}}}]).directive("seriesItemCreate",[function(){return{scope:false,restrict:"A",require:"?^supWidgetSeries",link:function(e,t,r,n){if(!n){return}return t.on("mousedown",function(e){n.$createSeriesItem();return e.stopPropagation()})}}}])}).call(this);(function(){angular.module("boltApp").directive("supWidgetText",["$rootScope","$timeout","$interpolate",function(e,t,r){return{scope:{"default":"@"},restrict:"AE",require:"?ngModel",link:function(n,i,u,a){var o,l,s,c,p,f,d;if(!a){return}if(window.parent){f=parent.angular.element(parent.document).scope()}else{f=e}d=f.station;if(!d){return}i[0].setAttribute("contenteditable","true");c=false;if(n["default"]){s=n["default"]}else{s=r(i.html().trim())(e)}i.on("click mousedown",function(e){d.$emit("widget.update_text",n);return e.stopPropagation()});a.$render=function(){var e;if(!a.$viewValue&&!c){i.html(s);e=t(function(){p();return t.cancel(e)},0)}else{i.html(a.$viewValue||"")}return c=true};i.on("blur keyup change cut",function(e){p();return e.stopPropagation()});o=function(e){e=e.replace(/<div\s* .*?>/gi,"<br>");e=e.replace(/<(?!br\s*\/?)[^>]+>/gi,"");if(e==="<br>"){e=""}return e};l=function(e){var t,r,n,i;e.removeAttribute("style");i=e.children;for(r=0,n=i.length;r<n;r++){t=i[r];l(t)}};i.on("paste",function(e){var r;r=t(function(){l(i[0]);i.html(o(i.html()));p();return t.cancel(r)},0);return e.stopPropagation()});return p=function(){var e;e=o(i.html());if(e==="<br>"){e=""}return a.$setViewValue(e.trim())}}}}])}).call(this);
