(function(){angular.module("boltApp",["ngSanitize","supLocales","supAngularWysiwyg","supAngularMarkdown"])}).call(this);(function(){angular.module("boltApp").constant("Config",{BaseURL:{self:sup.server.self,api:sup.server.api,docs:sup.server.docs,libs:sup.server.libs,"static":sup.server["static"],uploads:sup.server.uploads,apps:sup.server.apps},cookie_domain:sup.cookie_domain,is_debug:sup.is_debug,browser:sup.browser,protocols:[{key:"http",name:"Http"}],locales:[{code:"en_US",text:"English"},{code:"zh_CN",text:"简体中文"}],default_locale:"en_US",max_image_size:{width:1650,height:1650},max_file_size:{image:900*1024,video:36*1024*1024,audio:8*1024*1024,zip:18*1024*1024,docs:8*1024*1024},media_encoder_options:.8,media_mimetypes:{image:["image/png","image/jpeg","image/svg+xml","image/gif"],video:["video/mp4","video/quicktime"],audio:["audio/mpeg","audio/mp3"],application:["application/zip","application/pdf"]},invite:{codes_limit:6,invited_limit:6},markdown:false,path:{oauth:["/oauth"],editor:["/editor"],outer:["/login","/register","/activate","/recover_pwd","/reset_pwd"],open:["/404"]},theme_types:{CUSTOM_THEME:"custom",DEFAULT_THEME:"default"},app_types:[{name:"Website",alias:"ws",ico:"av:ic_web_24px",archivable:true,movable:true},{name:"WeChat Buzz",alias:"wx",ico:"comm:ic_chat_24px"},{name:"Digital Book",alias:"wb",ico:"action:ic_book_24px"},{name:"Web App",alias:"wa",ico:"hardware:ic_smartphone_24px"}],default_date_format:"longDate",date_formats:[{"%y":"yy"},{"%Y":"yyyy"},{"%B":"MMMM"},{"%b":"MMM"},{"%m":"MM"},{"%d":"dd"}],copyright:"&copy; Soopro Co.,ltd."})}).call(this);(function(){angular.module("boltApp").config(["$sceDelegateProvider",function(e){return e.resourceUrlWhitelist(["self","http://libs.sup.farm/**","http://libs.sup.plus/**","http://libs.soopro.com/**","http://libs.soopro.io/**"])}])}).call(this);(function(){var e=[].indexOf||function(e){for(var t=0,r=this.length;t<r;t++){if(t in this&&this[t]===e)return t}return-1};angular.module("boltApp").filter("trust",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("thumbnail",["Config",function(t){return function(r,n){var i,u,o,a,s;if(!n){n="thumbnail"}if(typeof r!=="string"){return r}u=["jpg","jpeg","png","gif","bmp","tiff"];try{i=angular.get_file_ext(r).toLowerCase()}catch(a){o=a;i=null}if(r.indexOf(t.BaseURL.uploads)>-1&&e.call(u,i)>=0){s=r.indexOf("?")>-1?"&":"?";return r+s+n}return r}}]).filter("trustHtml",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("url",["$rootScope",function(e){return function(t,r,n){var i;if(typeof t!=="string"){return t}if(r){i=t.indexOf("?");if(i>-1){t=t.substring(0,i)}}if(n){i=t.indexOf("#");if(i>-1){t=t.substring(0,i)}}if(!t||angular.isUrl(t)){return t}else if(angular.startswith(t,"/")){return e.base_url+t.replace(/(^\/)|(\/$)/g,"")}else{return t.replace(/\/$/g,"")}}}]).filter("path",["$rootScope",function(e){return function(t,r,n){var i,u,o,a;if(typeof t!=="string"){return t}if(r||r===void 0){o=t.indexOf("?");if(o>-1){t=t.substring(0,o)}}if(n||n===void 0){o=t.indexOf("#");if(o>-1){t=t.substring(0,o)}}try{a=t.split(e.base_url).pop()}catch(u){i=u;a=t}return"/"+a.replace(/^\//g,"").replace(/\/$/g,"")}}]).filter("type",function(){return function(e,t,r,n){var i,u,o,a;if(angular.isArray(e)){a=[];r=parseInt(r);for(i=0,o=e.length;i<o;i++){u=e[i];if(u.type===t){a.push(u)}}if(n){if(typeof n==="string"){n=["priority",n]}if(angular.isArray(n)){n=["priority"].concat(srotby)}a=angular.sortby(a,n,true)}if(r>0){a.length=r}return a}else{return null}}}).filter("join",function(){return function(e,t){if(angular.isArray(e)){if(!t){t=", "}return e.join(t)}else{return e}}}).filter("striptags",function(){return function(e){return String(e).replace(/<[^>]+>/gm,"")}})}).call(this);(function(){angular.module("boltApp").directive("editorCanvas",["$compile",function(e){return{restrict:"AE",scope:{},controller:["$scope","$sce","$rootScope","$element","$compile","$interval","$timeout","supLocales",function(e,t,r,n,i,u,o,a){var s,l,c,p,f,d,m,g,w,v,y;if(typeof angular.translate==="function"){e._=angular.translate}if(window.parent){m=parent.angular.element(parent.document).scope()}else{m=r}g=m.station;if(!g){console.log("Canvas must running in an iframe.");return}d=g.restEditor;p=null;y=false;e.g={};e.query={};e.app=g.app;e.file=g.file;e.content=e.file.content;e.meta=e.file.meta;e.config=g.config;e.show_html=g.show_html;g.setCanvas(e);l=function(t,r){n.css("display","none");return d.doGetEditorTpl(t,r).then(function(t){var r,u,s;if(y){s=t.tpl.replace("sup-angular-wysiwyg","sup-angular-markdown-render")}else{s=t.tpl}a.load(e.app.locale,t.localized_dict);n.html(s);r=i(n.contents());r(e);e.g={};return u=o(function(){n.css("display",null);return o.cancel(u)},100)})};v=function(){if(e.meta&&p!==e.meta.template){l(e.app.alias,e.meta.template);return p=e.meta.template}};w=function(t){e.site_meta=t.site_meta;e.theme_meta=t.theme_meta;e.base_url=r.base_url=t.base_url;e.theme_url=r.theme_url=t.theme_url;e.libs_url=r.libs_url=t.libs_url;e.locale=r.locale=t.locale;e.lang=r.lang=t.lang;e.menu=t.menu;e.taxonomy=e.tax=t.taxonomy;e.translates=t.translates;e.socials=t.socials;e.extension_slots=t.extension_slots;e.sa=t.sa;e.gfw=t.gfw;e.now=Date.now();e.ver=t.theme_meta.version;return y=t.useMarkdown};e.trustAsHtml=function(e){return t.trustAsHtml(e)};e.$watch("config",function(e){return w(e)},true);e.$watch("meta.template",function(){return v()});e.$watch("file",function(t){e.content=t.content;return e.meta=t.meta},true);e.$watch("content",function(t){return e.file.content=t});f=u(function(){},500);n.on("click",function(e){return g.focusCanvas()});c=[];s=r.$on("editor.complete",function(e,t){if(typeof t.destroy==="function"){return c.push(t)}});return e.destory=function(){var e,t,r;for(t=0,r=c.length;t<r;t++){e=c[t];e.destroy()}s();return u.cancel(f)}}]}}]).directive("fakeLink",function(){return{scope:{},restrict:"A",link:function(e,t,r){return t.bind("click mousedown",function(e){e.stopPropagation();e.preventDefault();return false})}}}).directive("supEditorMeta",["$rootScope","$timeout","$interpolate",function(e,t,r){return{scope:{"default":"@"},restrict:"AE",require:"?ngModel",link:function(n,i,u,o){var a,s,l,c,p,f,d,m;if(!o){return}if(window.parent){d=parent.angular.element(parent.document).scope()}else{d=e}m=d.station;if(!m){return}i[0].setAttribute("contenteditable",true);p=false;if(n["default"]){l=n["default"]}else{c=i.html().trim();l=r(c)(e)}i.on("click mousedown",function(e){m.$emit("widget.update_meta",n);return e.stopPropagation()});o.$render=function(){var e;if(!o.$viewValue&&!p){i.html(l);e=t(function(){f();return t.cancel(e)},0)}else{i.html(o.$viewValue||"")}return p=true};i.on("blur keyup change cut",function(e){f();return e.stopPropagation()});a=function(e){e=e.replace(/<div\s* .*?>/gi,"<br>");e=e.replace(/<(?!br\s*\/?)[^>]+>/gi,"");if(e==="<br>"){e=""}return e};s=function(e){var t,r,n,i;e.removeAttribute("style");i=e.children;for(r=0,n=i.length;r<n;r++){t=i[r];s(t)}};i.on("paste",function(e){var r;r=t(function(){s(i[0]);i.html(a(i.html()));f();return t.cancel(r)},0);return e.stopPropagation()});return f=function(){var e;e=a(i.html());if(e==="<br>"){e=""}return o.$setViewValue(e.trim())}}}}]).directive("supEditorMedia",["$rootScope",function(e){return{scope:{allowTypes:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}o=u.station;if(!o){return}t.allow_types=t.allowTypes||n.supEditorMedia;r.on("mousedown",function(e){if(e.supObstructed){return}o.$emit("widget.update_media",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(e);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supEditorWidgetBg",["$rootScope",function(e){return{scope:{allowTypes:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}o=u.station;if(!o){return}t.allow_types=t.allowTypes||n.supEditorWidgetBg;r.on("mousedown",function(e){if(e.target!==r[0]){return}o.$emit("widget.update_bg",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(e);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supEditorWidgetScript",["$rootScope","$interpolate",function(e,t){return{scope:{status:"@"},restrict:"AE",require:"?ngModel",link:function(r,n,i,u){var o,a,s,l,c,p,f;if(!u){return}if(window.parent){c=parent.angular.element(parent.document).scope()}else{c=e}f=c.station;if(!f){return}s=1;if(r.status!==void 0){s=parseInt(r.status)||0}o=n.html().trim();a={code:t(o)(e),status:s,meta:{}};n.on("mousedown",function(e){if(e.supObstructed){return}f.$emit("widget.update_script",r);return e.stopPropagation()});l=function(e){e=angular.isObject(e)?e:{};e={code:e.code,meta:e.meta,status:e.status};return e};r.update=function(e){r.data=l(e);u.$setViewValue(r.data);return u.$render()};p=function(e,t){r.data=l(e);if(t){u.$setViewValue(r.data)}if(r.data.status){return n.html(r.data.code)}else{return n.html("")}};return u.$render=function(){var e;e=u.$viewValue||{};if(!e.status&&e.status!==0){return p(a,true)}else{return p(u.$viewValue)}}}}}]).directive("supEditorWidgetButton",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}o=u.station;if(!o){return}r.on("mousedown",function(e){if(e.supObstructed){return}o.$emit("widget.update_button",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(e);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supEditorWidgetGallery",["$rootScope",function(e){return{scope:{allowTypes:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}o=u.station;if(!o){return}t.allow_types=t.allowTypes||n.supEditorWidgetGallery;r.on("mousedown",function(e){if(e.supObstructed){return}o.$emit("widget.update_gallery",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(e);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supEditorWidgetCollect",["$rootScope",function(e){return{scope:{"default":"@",limit:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o,a,s,l,c,p,f,d,m,g;if(!i){return}if(window.parent){m=parent.angular.element(parent.document).scope()}else{m=e}g=m.station;if(!g){return}try{o=[];d=t.$eval(t["default"]);for(p=0,f=d.length;p<f;p++){u=d[p];if("name"in u&&"value"in u){o.push(u)}}}catch(l){s=l;o=[]}if(!angular.isArray(o)){o=[]}try{t.limit=parseInt(t.limit);if(t.limit<0){t.limit=0}}catch(c){s=c;t.limit=0}r.on("mousedown",function(e){if(e.supObstructed){return}g.$emit("widget.update_collect",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(e);return i.$render()};a=false;return i.$render=function(){if(!angular.isArray(i.$viewValue)&&!a){i.$setViewValue(o)}t.data=i.$viewValue;return a=true}}}}]).directive("supEditorWidgetNotes",["$rootScope",function(e){return{scope:{"default":"@",limit:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o,a,s,l,c,p,f,d,m,g;if(!i){return}if(window.parent){m=parent.angular.element(parent.document).scope()}else{m=e}g=m.station;if(!g){return}try{o=[];d=t.$eval(t["default"]);for(p=0,f=d.length;p<f;p++){u=d[p];o.push(u)}}catch(l){s=l;o=[]}if(!angular.isArray(o)){o=[]}try{t.limit=parseInt(t.limit);if(t.limit<0){t.limit=0}}catch(c){s=c;t.limit=0}r.on("mousedown",function(e){if(e.supObstructed){return}g.$emit("widget.update_notes",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(e);return i.$render()};a=false;return i.$render=function(){if(!angular.isArray(i.$viewValue)&&!a){i.$setViewValue(o)}t.data=i.$viewValue;return a=true}}}}]).directive("supEditorOpen",["$rootScope",function(e){return{scope:{file:"=file"},restrict:"AE",link:function(t,r,n){var i,u;if(window.parent){i=parent.angular.element(parent.document).scope()}else{i=e}u=i.station;if(!u||!u.open){return}return r.on("mousedown",function(e){u.open(t.file);return e.stopPropagation()})}}}]).directive("supQuery",["$rootScope",function(e){return{scope:{fields:"=",metas:"=",sortby:"=",length:"=",offset:"=",desc:"=",priority:"=",archive:"="},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o,a,s,l,c,p,f,d,m,g,w,v;if(!i){return}v=document.querySelectorAll("[sup-query]");for(s=l=0,c=v.length;l<c;s=++l){g=v[s];if(s>=5&&g===r[0]){console.error("Too many supQuery on same page.",r[0]);return}}if(window.parent){d=parent.angular.element(parent.document).scope()}else{d=e}w=d.station;if(!w){return}if(!w.allowContentQuery){return}u=w.app;f=w.restEditor;if(n.supQuery){m=[{type:n.supQuery}]}else{m=null}p=function(e){if(e&&!angular.isArray(e)){return[e]}return e};o=function(e,t){if(t===void 0){t=true}else{t=Boolean(t)}if(e===void 0){return t}return Boolean(e)};a={query_fields:p(t.fields)||m||[],query_metas:p(t.metas)||[],query_sortby:p(t.sortby),query_length:parseInt(t.length),query_offset:parseInt(t.offset),query_desc:o(t.desc),query_priority:o(t.priority),query_archive:o(t.archive,false)};return f.doContentQueryEditor(u.alias,a).then(function(e){return i.$setViewValue(e.results)})}}}]).directive("supScript",["Config",function(e){return{restrict:"AE",compile:function(t,r){var n,i,u;if(typeof r.path!=="string"){return}if(!r.source){u=e.BaseURL.libs}if(r.noSource===void 0){n=u+"/"+r.path.replace(/^[\/\\]*/g,"")}else{n=r.path}i=document.createElement("script");i.setAttribute("ng-src","{{'"+n+"'}}");t.append(i);return t[0].removeAttribute("path")}}}]).directive("supSet",[function(){return{scope:{value:"@",object:"@"},restrict:"AE",require:"?ngModel",link:function(e,t,r,n){var i,u,o;if(!n){return}if(e.object){try{o=JSON.parse(e.object)}catch(u){i=u;console.error(i);return}}n.$setViewValue(o||e.value);return n.$render=function(){return n.$setViewValue(o||e.value)}}}}]).directive("supObstruct",function(){return{restrict:"A",link:function(e,t,r){return t.bind("click mousedown",function(e){return e.supObstructed=true})}}})}).call(this);
