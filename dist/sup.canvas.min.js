(function(){angular.module("boltApp",["ngSanitize","supAngularWysiwyg","supAngularMarkdown"])}).call(this);(function(){angular.module("boltApp").constant("Config",{BaseURL:{self:sup.server.self,api:sup.server.api,docs:sup.server.docs,libs:sup.server.libs,"static":sup.server["static"],apps:sup.server.apps},cookie_domain:sup.cookie_domain,is_debug:sup.is_debug,browser:sup.browser,locales:[{code:"en_US",text:"English"},{code:"zh_CN",text:"简体中文"}],default_locale:"en_US",pages:{error_404:sup.server.web+"/404",error_browser:sup.server.web+"/old_browser",terms:sup.server.web+"/terms"},max_image_size:{width:1650,height:1650},max_file_size:{image:600*1024,zip:10*1024*1024,docs:2*1024*1024},media_encoder_options:.75,preview_types:["png","jpg","gif","jpeg"],invite:{codes_limit:6,invited_limit:6},markdown:false,plan:["Lab Mice"],path:{oauth:["/oauth"],editor:["/editor"],outer:["/login","/register","/activate","/recover_pwd","/reset_pwd"],open:["/404"]},theme_types:{CUSTOM_THEME:"custom",DEFAULT_THEME:"default"},app_types:[{name:"Website",alias:"ws",ico:"av:ic_web_24px"},{name:"WeChat Buzz",alias:"wx",ico:"comm:ic_chat_24px"},{name:"Digital Book",alias:"wb",ico:"action:ic_book_24px"}],default_date_format:"longDate",date_formats:[{"%y":"yy"},{"%Y":"yyyy"},{"%B":"MMMM"},{"%b":"MMM"},{"%m":"MM"},{"%d":"dd"}],copyright:"&copy; Soopro Co.,ltd."})}).call(this);(function(){angular.module("boltApp").config(["$sceDelegateProvider",function(e){return e.resourceUrlWhitelist(["self","http://libs.sup.farm/**","http://libs.sup.plus/**","http://libs.soopro.com/**","http://libs.soopro.io/**"])}])}).call(this);(function(){angular.module("boltApp").filter("trust",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("thumbnail",["Config",function(e){return function(t){var r,n;if(typeof t==="string"){if(t.indexOf(e.BaseURL["static"])<=-1){return t}n="/uploads/";r=n+"thumbnails/";return t.replace(n,r)}else{return t}}}]).filter("trustHtml",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("url",["$rootScope",function(e){return function(t,r){var n;if(typeof t!=="string"){return t}if(r){n=t.indexOf("?");if(n>-1){t=t.substring(0,n)}}if(!t||angular.isUrl(t)){return t}else if(angular.startswith(t,"/")){return e.base_url+t.replace(/(^\/)|(\/$)/g,"")}else{return t.replace(/\/$/g,"")}}}]).filter("path",["$rootScope",function(e){return function(t,r){var n;if(r||r===void 0){n=t.indexOf("?");if(n>-1){t=t.substring(0,n)}}t=t.split(e.base_url).pop();return"/"+t.replace(/^\//g,"").replace(/\/$/g,"")}}]).filter("type",function(){return function(e,t,r,n){var i,u,o,a,s;if((s=typeof e)==="object"||s==="array"){a=[];r=parseInt(r);for(i=0,o=e.length;i<o;i++){u=e[i];if(u.type===t){a.push(u)}}if(n){if(typeof n==="string"){n=["priority",n]}if(angular.isArray(n)){n=["priority"].concat(srotby)}a=angular.sortby(a,n,true)}if(r>0){a.length=r}return a}else{return null}}}).filter("join",function(){return function(e,t){if(angular.isArray(e)){if(!t){t=", "}return e.join(t)}else{return e}}}).filter("striptags",function(){return function(e){return String(e).replace(/<[^>]+>/gm,"")}})}).call(this);(function(){angular.module("boltApp").directive("editorCanvas",["$compile",function(e){return{restrict:"AE",scope:{},controller:["$scope","$sce","$rootScope","$element","$compile","$interval","$timeout",function(e,t,r,n,i,u,o){var a,s,l,c,p,f,d,m,g,w,$;if(typeof angular.translate==="function"){e._=angular.translate}if(window.parent){d=parent.angular.element(parent.document).scope()}else{d=r}m=d.station;if(!m){console.log("Canvas must running in an iframe.");return}f=m.restEditor;c=null;$=false;e.g={};e.query={};e.app=m.app;e.file=m.file;e.content=e.file.content;e.meta=e.file.meta;e.config=m.config;e.now=m.now;e.show_html=m.show_html;m.setCanvas(e);s=function(t,r){return f.doGetEditorTpl(e.app.type,t,r).then(function(t){var r,u;if($){u=t.tpl.replace("sup-angular-wysiwyg","sup-angular-markdown-render")}else{u=t.tpl}u=u.replace("[%theme_url%]",e.theme_url);n.html(u);r=i(n.contents());r(e);return e.g={}})};w=function(){if(e.meta&&c!==e.meta.template){s(e.app.alias,e.meta.template);return c=e.meta.template}};g=function(t){e.site_meta=t.site_meta;e.theme_meta=t.theme_meta;e.base_url=r.base_url=t.base_url;e.theme_url=r.theme_url=t.theme_url;e.libs_url=r.libs_url=t.libs_url;e.locale=r.locale=t.locale;e.lang=r.lang=t.lang;e.menu=t.menu;e.taxonomy=e.tax=t.taxonomy;e.translates=t.translates;e.socials=t.socials;e.sa=t.sa;return $=t.useMarkdown};e.trustAsHtml=function(e){return t.trustAsHtml(e)};e.$watch("config",function(e){return g(e)},true);e.$watch("meta.template",function(){return w()});e.$watch("file",function(t){e.content=t.content;return e.meta=t.meta},true);e.$watch("content",function(t){return e.file.content=t});p=u(function(){},500);n.on("click",function(e){return m.focusCanvas()});l=[];a=r.$on("editor.complete",function(e,t){if(typeof t.destroy==="function"){return l.push(t)}});return e.destory=function(){var e,t,r;for(t=0,r=l.length;t<r;t++){e=l[t];e.destroy()}a();return u.cancel(p)}}]}}]).directive("fakeLink",function(){return{scope:{},restrict:"A",link:function(e,t,r){return t.bind("click mousedown",function(e){e.stopPropagation();e.preventDefault();return false})}}}).directive("supEditorMeta",["$rootScope","$timeout",function(e,t){return{scope:{"default":"@"},restrict:"AE",require:"?ngModel",link:function(r,n,i,u){var o,a,s,l,c,p,f;if(!u){return}if(window.parent){p=parent.angular.element(parent.document).scope()}else{p=e}f=p.station;if(!f){return}n[0].setAttribute("contenteditable",true);l=false;if(r["default"]){s=r["default"]}else{s=n.html()}n.on("click mousedown",function(e){f.$emit("widget.update_meta",r);return e.stopPropagation()});u.$render=function(){var e;if(!u.$viewValue&&!l){n.html(s);e=t(function(){c();return t.cancel(e)},0)}else{n.html(u.$viewValue||"")}return l=true};n.on("blur keyup change cut",function(e){c();return e.stopPropagation()});o=function(e){e=e.replace(/<div\s* .*?>/gi,"<br>");e=e.replace(/<(?!br\s*\/?)[^>]+>/gi,"");if(e==="<br>"){e=""}return e};a=function(e){var t,r,n,i;e.removeAttribute("style");i=e.children;for(r=0,n=i.length;r<n;r++){t=i[r];a(t)}};n.on("paste",function(e){var r;r=t(function(){a(n[0]);n.html(o(n.html()));t.cancel(r);return c()},0);return e.stopPropagation()});return c=function(){var e;e=o(n.html());if(e==="<br>"){e=""}return u.$setViewValue(e.trim())}}}}]).directive("supEditorMedia",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}o=u.station;if(!o){return}r.on("mousedown",function(e){if(e.supObstructed){return}o.$emit("widget.update_media",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(e);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supEditorWidgetBg",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}o=u.station;if(!o){return}r.on("mousedown",function(e){if(e.target!==r[0]){return}o.$emit("widget.update_bg",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(e);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supEditorWidgetScript",["$rootScope",function(e){return{scope:{status:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o,a,s,l,c;if(!i){return}if(window.parent){s=parent.angular.element(parent.document).scope()}else{s=e}c=s.station;if(!c){return}o=1;if(t.status!==void 0){o=parseInt(t.status)||0}u={code:r.html().trim(),status:o,meta:{}};r.on("mousedown",function(e){if(e.supObstructed){return}c.$emit("widget.update_script",t);return e.stopPropagation()});a=function(e){e=angular.isObject(e)?e:{};e={code:e.code,meta:e.meta,status:e.status};return e};t.update=function(e){t.data=a(e);i.$setViewValue(t.data);return i.$render()};l=function(e,n){t.data=a(e);if(n){i.$setViewValue(t.data)}if(t.data.status){return r.html(t.data.code)}else{return r.html("")}};return i.$render=function(){var e;e=i.$viewValue||{};if(!e.status&&e.status!==0){return l(u,true)}else{return l(i.$viewValue)}}}}}]).directive("supEditorWidgetButton",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}o=u.station;if(!o){return}r.on("mousedown",function(e){if(e.supObstructed){return}o.$emit("widget.update_button",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(e);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supEditorWidgetGallery",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}o=u.station;if(!o){return}r.on("mousedown",function(e){if(e.supObstructed){return}o.$emit("widget.update_gallery",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(e);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supEditorWidgetCollect",["$rootScope",function(e){return{scope:{"default":"@",limit:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o,a,s,l,c,p,f,d,m,g;if(!i){return}if(window.parent){m=parent.angular.element(parent.document).scope()}else{m=e}g=m.station;if(!g){return}try{o=[];d=t.$eval(t["default"]);for(p=0,f=d.length;p<f;p++){u=d[p];if("name"in u&&"value"in u){o.push(u)}}}catch(l){s=l;o=[]}if(!angular.isArray(o)){o=[]}try{t.limit=parseInt(t.limit);if(t.limit<0){t.limit=0}}catch(c){s=c;t.limit=0}r.on("mousedown",function(e){if(e.supObstructed){return}g.$emit("widget.update_collect",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(e);return i.$render()};a=false;return i.$render=function(){if(!angular.isArray(i.$viewValue)&&!a){i.$setViewValue(o)}t.data=i.$viewValue;return a=true}}}}]).directive("supEditorWidgetNotes",["$rootScope",function(e){return{scope:{"default":"@",limit:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o,a,s,l,c,p,f,d,m,g;if(!i){return}if(window.parent){m=parent.angular.element(parent.document).scope()}else{m=e}g=m.station;if(!g){return}try{o=[];d=t.$eval(t["default"]);for(p=0,f=d.length;p<f;p++){u=d[p];o.push(u)}}catch(l){s=l;o=[]}if(!angular.isArray(o)){o=[]}try{t.limit=parseInt(t.limit);if(t.limit<0){t.limit=0}}catch(c){s=c;t.limit=0}r.on("mousedown",function(e){if(e.supObstructed){return}g.$emit("widget.update_notes",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(e);return i.$render()};a=false;return i.$render=function(){if(!angular.isArray(i.$viewValue)&&!a){i.$setViewValue(o)}t.data=i.$viewValue;return a=true}}}}]).directive("supEditorContentQuery",["$rootScope","$timeout",function(e,t){return{scope:{fields:"=",metas:"=",sortby:"=",length:"="},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o,a,s,l;if(!i){return}if(window.parent){s=parent.angular.element(parent.document).scope()}else{s=e}l=s.station;if(!l){return}if(!l.allowContentQuery){return}u=l.app;a=l.restEditor;if(typeof t.sortby==="string"){t.sortby=[t.sortby]}o={query_fields:t.fields||{},query_metas:t.metas||{},query_length:parseInt(t.length),query_sortby:t.sortby};return a.doContentQueryEditor(u.type,u.alias,o).then(function(e){return i.$setViewValue(e.results)})}}}]).directive("supEditorOpen",["$rootScope",function(e){return{scope:{file:"=file"},restrict:"AE",link:function(t,r,n){var i,u;if(window.parent){i=parent.angular.element(parent.document).scope()}else{i=e}u=i.station;if(!u||!u.open){return}return r.on("mousedown",function(e){u.open(t.file);return e.stopPropagation()})}}}]).directive("supScript",["Config",function(e){return{restrict:"AE",compile:function(t,r){var n,i,u;if(!r.path){return}if(!r.source){u=e.BaseURL.libs}if(r.noSource===void 0){n=u+"/"+r.path}else{n=r.path}i=document.createElement("script");i.setAttribute("ng-src","{{'"+n+"'}}");t.append(i);return t[0].removeAttribute("path")}}}]).directive("supSet",[function(){return{scope:{value:"@"},restrict:"AE",require:"?ngModel",link:function(e,t,r,n){if(!n){return}n.$setViewValue(e.value);return n.$render=function(){return n.$setViewValue(e.value)}}}}]).directive("supObstruct",function(){return{restrict:"A",link:function(e,t,r){return t.bind("click mousedown",function(e){return e.supObstructed=true})}}})}).call(this);
