(function(){angular.module("boltApp",["ngSanitize","supLocales","supAngularWysiwyg","supAngularMarkdown"])}).call(this);(function(){angular.module("boltApp").constant("Config",{baseURL:{self:sup.server.self,api:sup.server.api,docs:sup.server.docs,libs:sup.server.libs,"static":sup.server["static"],uploads:sup.server.uploads,apps:sup.server.apps,agent:sup.server.agent},debug:sup.debug,browser:sup.browser,protocols:[{key:"http",name:"Http"}],locales:[{code:"en_US",text:"English"},{code:"zh_CN",text:"简体中文"}],default_locale:"en_US",max_image_size:{width:1650,height:1650},max_file_size:{image:960*1024,video:36*1024*1024,audio:8*1024*1024,zip:18*1024*1024,docs:8*1024*1024},media_encoder_options:.8,media_mimetypes:{image:["image/png","image/jpeg","image/svg+xml","image/gif","image/bmp"],video:["video/mp4","video/quicktime"],audio:["audio/mpeg","audio/mp3"],application:["application/zip","application/pdf"]},invite:{codes_limit:6,invited_limit:6},markdown:false,path:{oauth:["/oauth"],editor:["/editor"],outer:["/login","/register","/recovery"],open:["/404","/403"]},theme_types:{CUSTOM_THEME:"custom",DEFAULT_THEME:"default"},app_types:[{name:"Website",slug:"ws",ico:"av:ic_web_24px",archivable:true,movable:true},{name:"WeChat Buzz",slug:"wx",ico:"comm:ic_chat_24px"}],copyright:"&copy; Soopro Co.,ltd."})}).call(this);(function(){angular.module("boltApp").config(["$sceDelegateProvider",function(e){return e.resourceUrlWhitelist(["self","http://libs.sup.farm/**","http://libs.sup.plus/**","http://libs.soopro.com/**","http://libs.soopro.io/**"])}])}).call(this);(function(){var e=[].indexOf||function(e){for(var t=0,r=this.length;t<r;t++){if(t in this&&this[t]===e)return t}return-1};angular.module("boltApp").filter("trust",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("thumbnail",["Config",function(t){return function(r,n){var i,u,o,a,l;if(!n){n="thumbnail"}if(typeof r!=="string"){return r}u=["jpg","jpeg","png","gif","bmp","tiff"];try{i=angular.get_file_ext(r)}catch(a){o=a;i=null}if(r.indexOf(t.baseURL.uploads)>-1&&e.call(u,i)>=0){l=r.indexOf("?")>-1?"&":"?";return r+l+n}return r}}]).filter("trustHtml",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("url",["$rootScope",function(e){return function(t,r,n){var i;if(typeof t!=="string"){return t}if(r){i=t.indexOf("?");if(i>-1){t=t.substring(0,i)}}if(n){i=t.indexOf("#");if(i>-1){t=t.substring(0,i)}}if(!t||angular.isUrl(t)){return t}else if(angular.startswith(t,"/")){return e.base_url+t.replace(/(^\/)|(\/$)/g,"")}else{return t.replace(/\/$/g,"")}}}]).filter("path",["$rootScope",function(e){return function(t,r,n){var i,u,o,a;if(typeof t!=="string"){return t}if(r||r===void 0){o=t.indexOf("?");if(o>-1){t=t.substring(0,o)}}if(n||n===void 0){o=t.indexOf("#");if(o>-1){t=t.substring(0,o)}}try{a=t.split(e.base_url).pop()}catch(u){i=u;a=t}return"/"+a.replace(/^\//g,"").replace(/\/$/g,"")}}]).filter("args",function(){return function(e,t){if(typeof e!=="string"){return{}}return angular.getURLParams(e,t)}}).filter("type",function(){return function(e,t,r,n){var i,u,o,a;if(angular.isArray(e)){a=[];r=parseInt(r);for(i=0,o=e.length;i<o;i++){u=e[i];if(u.type===t){a.push(u)}}if(n){if(typeof n==="string"){n=["priority",n]}if(angular.isArray(n)){n=["priority"].concat(srotby)}a=angular.sortby(a,n,true)}if(r>0){a.length=r}return a}else{return null}}}).filter("join",function(){return function(e,t){if(angular.isArray(e)){if(!t){t=", "}return e.join(t)}else{return e}}}).filter("striptags",function(){return function(e){return String(e).replace(/<[^>]+>/gm,"")}}).filter("int",function(){return function(e){var t;try{e=parseInt(e)}catch(t){e=null}return e}}).filter("string",function(){return function(e){var t,r;try{r=e.toString()}catch(t){r=""}return r}}).filter("is_empty",function(){return function(e){var t;if(angular.isArray(e)){t=!e||e.length<=0}else if(angular.isObject(e)){t=!e||Object.keys(e).length<=0}else if(angular.isFunction(e)||angular.isElement(e)){t=true}else{t=!Boolean(e)}return t}}).filter("date_formatted",["$filter","$rootScope",function(e,t){return function(r,n){var i,u,o,a,l;if(!r){return""}if(typeof n!=="string"){n=null}o={en:"MMMM d, yyyy",zh:"yyyy年 MM月 dd日"};try{l=t.locale;a=t.lang||l.split("_")[0]}catch(i){l=null;a=null}u=n||o[l]||o[a]||null;if(!u){return r}else{return e("date")(r,u)}}}])}).call(this);(function(){angular.module("boltApp").directive("editorCanvas",["$compile",function(e){return{restrict:"AE",scope:{},controller:["$scope","$sce","$rootScope","$element","$compile","$interval","$timeout","supLocales",function(e,t,r,n,i,u,o,a){var l,s,c,p,f,d,g,m,w,v,y;if(typeof angular.translate==="function"){e._=angular.translate}if(window.parent){g=parent.angular.element(parent.document).scope()}else{g=r}m=g.station;if(!m){console.log("Canvas must running in an iframe.");return}d=m.restEditor;p=null;y=false;e.g={};e.query={};e.app=m.app;e.file=m.file;e.content=e.file.content;e.meta=e.file.meta;e.config=m.config;e.show_html=m.show_html;m.setCanvas(e);s=function(t,r){m.display_canvas(false);return d.doGetEditorTpl(t,r).then(function(t){var r,u,l;if(y){l=t.tpl.replace("sup-angular-wysiwyg","sup-angular-markdown-render")}else{l=t.tpl}a.load(e.app.locale,t.localized_dict);n.html(l);r=i(n.contents());r(e);e.g={};e.query={};return u=o(function(){m.display_canvas(true);return o.cancel(u)},500)})};v=function(){if(e.meta&&p!==e.meta.template){s(e.app.slug,e.meta.template);return p=e.meta.template}};w=function(t){e.site_meta=t.site_meta;e.theme_meta=t.theme_meta;e.base_url=r.base_url=t.base_url;e.theme_url=r.theme_url=t.theme_url;e.libs_url=r.libs_url=t.libs_url;e.locale=r.locale=t.locale;e.lang=r.lang=t.lang;e.menu=t.menu;e.taxonomy=e.tax=t.taxonomy;e.translates=t.translates;e.socials=t.socials;e.extension_slots=t.extension_slots;e.now=parseInt(Date.now()/1e3);return y=t.useMarkdown};e.trustAsHtml=function(e){return t.trustAsHtml(e)};e.$watch("config",function(e){return w(e)},true);e.$watch("meta.template",function(){return v()});e.$watch("file",function(t){e.content=t.content;return e.meta=t.meta},true);e.$watch("content",function(t){return e.file.content=t});f=u(function(){},500);n.on("click",function(e){return m.focusCanvas()});c=[];l=r.$on("editor.complete",function(e,t){if(typeof t.destroy==="function"){return c.push(t)}});return e.destory=function(){var e,t,r;for(t=0,r=c.length;t<r;t++){e=c[t];e.destroy()}l();return u.cancel(f)}}]}}]).directive("fakeLink",function(){return{scope:{},restrict:"A",link:function(e,t,r){return t.bind("click mousedown",function(e){e.stopPropagation();e.preventDefault();return false})}}}).directive("supWidgetText",["$rootScope","$timeout","$interpolate",function(e,t,r){return{scope:{"default":"@"},restrict:"AE",require:"?ngModel",link:function(n,i,u,o){var a,l,s,c,p,f,d;if(!o){return}if(window.parent){f=parent.angular.element(parent.document).scope()}else{f=e}d=f.station;if(!d){return}i[0].setAttribute("contenteditable",true);c=false;if(n["default"]){s=n["default"]}else{s=r(i.html().trim())(e)}i.on("click mousedown",function(e){d.$emit("widget.update_text",n);return e.stopPropagation()});o.$render=function(){var e;if(!o.$viewValue&&!c){i.html(s);e=t(function(){p();return t.cancel(e)},0)}else{i.html(o.$viewValue||"")}return c=true};i.on("blur keyup change cut",function(e){p();return e.stopPropagation()});a=function(e){e=e.replace(/<div\s* .*?>/gi,"<br>");e=e.replace(/<(?!br\s*\/?)[^>]+>/gi,"");if(e==="<br>"){e=""}return e};l=function(e){var t,r,n,i;e.removeAttribute("style");i=e.children;for(r=0,n=i.length;r<n;r++){t=i[r];l(t)}};i.on("paste",function(e){var r;r=t(function(){l(i[0]);i.html(a(i.html()));p();return t.cancel(r)},0);return e.stopPropagation()});return p=function(){var e;e=a(i.html());if(e==="<br>"){e=""}return o.$setViewValue(e.trim())}}}}]).directive("supWidgetMedia",["$rootScope",function(e){return{scope:{allowTypes:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}o=u.station;if(!o){return}t.allow_types=t.allowTypes||n.supWidgetMedia;r.on("mousedown",function(e){if(e.supObstructed){return}o.$emit("widget.update_media",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supWidgetBg",["$rootScope",function(e){return{scope:{allowTypes:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}o=u.station;if(!o){return}t.allow_types=t.allowTypes||n.supWidgetBg;r.on("mousedown",function(e){if(e.target!==r[0]){return}o.$emit("widget.update_bg",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supWidgetScript",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}o=u.station;if(!o){return}r.on("mousedown",function(e){if(e.supObstructed){return}o.$emit("widget.update_script",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supWidgetButton",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}o=u.station;if(!o){return}r.on("mousedown",function(e){if(e.supObstructed){return}o.$emit("widget.update_button",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supWidgetGallery",["$rootScope",function(e){return{scope:{allowTypes:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}o=u.station;if(!o){return}t.allow_types=t.allowTypes||n.supWidgetGallery;r.on("mousedown",function(e){if(e.supObstructed){return}o.$emit("widget.update_gallery",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supWidgetCollect",["$rootScope",function(e){return{scope:{"default":"@",limit:"@"},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o,a,l,s,c,p,f,d,g;if(!i){return}if(window.parent){f=parent.angular.element(parent.document).scope()}else{f=e}d=f.station;if(!d){return}try{u=t.$eval(t["default"]);o=[];for(c=0,p=u.length;c<p;c++){g=u[c];if(angular.isString(g)&&g){o.push({text:g})}else if(angular.isObject(g)&&g.text){o.push({text:g.text})}}}catch(l){a=l;o=[]}if(!angular.isArray(o)){o=[]}try{t.limit=parseInt(t.limit);if(t.limit<0){t.limit=0}}catch(s){a=s;t.limit=0}r.on("mousedown",function(e){if(e.supObstructed){return}d.$emit("widget.update_collect",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){if(!angular.isArray(i.$viewValue)){i.$setViewValue(o)}return t.data=i.$viewValue}}}}]).directive("supWidgetOption",["$rootScope",function(e){return{scope:{structure:"="},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o,a,l,s,c;if(!i){return}if(window.parent){l=parent.angular.element(parent.document).scope()}else{l=e}s=l.station;if(!s){return}u={};if(angular.isDict(t.structure)){a=t.structure;for(o in a){c=a[o];if(c["default"]){u[o]=c["default"]}}}r.on("mousedown",function(e){if(e.supObstructed){return}s.$emit("widget.update_option",t);return e.stopPropagation()});t.update=function(e){t.data=e||u;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){if(!angular.isDict(i.$viewValue)){i.$setViewValue(u)}return t.data=i.$viewValue}}}}]).directive("supWidgetForm",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}o=u.station;if(!o){return}r.on("mousedown",function(e){if(e.supObstructed){return}o.$emit("widget.update_form",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(t.data);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supWidgetOpen",["$rootScope",function(e){return{scope:{file:"=file"},restrict:"AE",link:function(t,r,n){var i,u;if(window.parent){i=parent.angular.element(parent.document).scope()}else{i=e}u=i.station;if(!u||!u.open){return}return r.on("mousedown",function(e){u.open(t.file);return e.stopPropagation()})}}}]).directive("supQuery",["$rootScope",function(e){return{scope:{fields:"=",metas:"=",sortby:"=",length:"=",limit:"=",offset:"=",desc:"=",priority:"=",archive:"="},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var u,o,a,l,s,c,p,f,d,g,m,w,v,y,$,h;if(!i){return}h=document.querySelectorAll("[sup-query]");for(c=p=0,f=h.length;p<f;c=++p){v=h[c];if(c>=5&&v===r[0]){console.error("Too many supQuery on same page.",r[0]);return}}if(window.parent){m=parent.angular.element(parent.document).scope()}else{m=e}$=m.station;if(!$){return}if(!$.allowContentQuery){return}o=$.app;g=$.restEditor;d=function(e){if(e&&!angular.isArray(e)){return[e]}return e};a=function(e,t){if(t===void 0){t=true}else{t=Boolean(t)}if(e===void 0){return t}return Boolean(e)};if(n.supQuery){y=n.supQuery;if(y.indexOf("[")>=0||y.indexOf("{")>=0){try{u=JSON.parse(n.supQuery);if(typeof u!=="object"){throw true}}catch(s){u=null}}if(!u){u={type:y}}w=d(u)}else{w=null}l={fields:d(t.fields)||w||[],metas:d(t.metas)||[],sortby:d(t.sortby),limit:parseInt(t.limit)||parseInt(t.length),offset:parseInt(t.offset),desc:a(t.desc),priority:a(t.priority),archive:a(t.archive,false)};return g.doContentQueryEditor(o.slug,l).then(function(e){return i.$setViewValue(e.results)})}}}]).directive("supScript",["Config",function(e){return{restrict:"AE",compile:function(t,r){var n,i,u;if(typeof r.path!=="string"){return}if(!r.source){u=e.baseURL.libs}if(r.noSource===void 0){n=u+"/"+r.path.replace(/^[\/\\]*/g,"")}else{n=r.path}i=document.createElement("script");i.setAttribute("ng-src","{{'"+n+"'}}");t.append(i);return t[0].removeAttribute("path")}}}]).directive("supSet",[function(){return{scope:{value:"@",object:"="},restrict:"AE",require:"?ngModel",link:function(e,t,r,n){if(!n){return}n.$setViewValue(e.object||e.value);return n.$render=function(){return n.$setViewValue(e.object||e.value)}}}}]).directive("supObstruct",function(){return{restrict:"A",link:function(e,t,r){return t.bind("click mousedown",function(e){return e.supObstructed=true})}}})}).call(this);
