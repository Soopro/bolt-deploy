(function(){angular.module("boltApp",["ngSanitize","supAngularWysiwyg"])}).call(this);(function(){angular.module("boltApp").constant("Config",{BaseURL:{self:sup.server.self,api:sup.server.api,docs:sup.server.docs,libs:sup.server.libs,"static":sup.server["static"],apps:sup.server.apps},cookie_domain:sup.cookie_domain,browser:sup.browser,locales:[{code:"en_US",text:"English"},{code:"zh_CN",text:"简体中文"}],default_locale:"en_US",pages:{error_404:sup.server.web+"/404",error_browser:sup.server.web+"/old_browser",terms:sup.server.web+"/terms"},max_image_size:{width:1650,height:1650},max_file_size:{image:600*1024,zip:10*1024*1024,docs:2*1024*1024},media_encoder_options:.7,preview_types:["png","jpg","gif","jpeg"],invite:{codes_limit:6,invited_limit:6},markdown:false,plan:["Lab Mice"],path:{oauth:["/oauth2"],editor:["/editor"],outer:["/login","/register","/activate","/recover_pwd","/reset_pwd"],open:["/404"]},apptypes:[{name:"Website",alias:"ws"},{name:"WeChat Buzz",alias:"wx"}],default_date_format:"longDate",date_formats:[{"%y":"yy"},{"%Y":"yyyy"},{"%B":"MMMM"},{"%b":"MMM"},{"%m":"MM"},{"%d":"dd"}],copyright:"&copy; Soopro Co.,ltd."})}).call(this);(function(){angular.module("boltApp").config(["$sceDelegateProvider",function(e){return e.resourceUrlWhitelist(["self","http://libs.sup.farm/**","http://libs.sup.plus/**","http://libs.soopro.com/**","http://libs.soopro.io/**"])}])}).call(this);(function(){angular.module("boltApp").filter("thumbnail",["Config",function(e){return function(t){var r,n;if(typeof t==="string"){if(t.indexOf(e.BaseURL["static"])<=-1){return t}n="/uploads/";r=n+"thumbnails/";return t.replace(n,r)}else{return t}}}]).filter("trustHtml",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("url",["$rootScope",function(e){return function(t,r){var n;if(typeof t!=="string"){return t}if(r){n=t.indexOf("?");if(n>-1){t=t.substring(0,n)}}if(angular.isUrl(t)){return t}else{return e.base_url+t.replace(/^\//g,"")}}}]).filter("path",["$rootScope",function(e){return function(t,r){var n;if(r||r===void 0){n=t.indexOf("?");if(n>-1){t=t.substring(0,n)}}t=t.split(e.base_url).pop();return"/"+t.replace(/^\//g,"").replace(/\/$/g,"")}}]).filter("type",function(){return function(e,t,r,n){var i,o,u,a,s;if((s=typeof e)==="object"||s==="array"){a=[];r=parseInt(r);for(i=0,u=e.length;i<u;i++){o=e[i];if(o.type===t){a.push(o)}}if(n){if(typeof n==="string"){n=["priority",n]}if(n instanceof Array){n=["priority"].concat(srotby)}a=angular.sortby(a,n,true)}if(r>0){a.length=r}return a}else{return null}}}).filter("join",function(){return function(e,t){if(e instanceof Array){if(!t){t=", "}return e.join(t)}else{return e}}}).filter("striptags",function(){return function(e){return String(e).replace(/<[^>]+>/gm,"")}})}).call(this);(function(){angular.module("boltApp").directive("editorCanvas",["$compile",function(e){return{restrict:"AE",scope:{},controller:["$scope","$rootScope","$element","$compile","$interval",function(e,t,r,n,i){var o,u,a,s,l,c,p,f,d,m;if(typeof angular.translate==="function"){e._=angular.translate}if(window.parent){p=parent.angular.element(parent.document).scope()}else{p=t}f=p.station;if(!f){console.log("Canvas must running in an iframe.");return}c=f.restEditor;s=null;e.g={};e.query={};e.app=f.app;e.file=f.file;e.content=e.file.content;e.meta=e.file.meta;e.config=f.config;e.now=f.now;e.show_html=f.show_html;f.setCanvas(e);u=function(t,i){return c.doGetEditorTpl(e.app.type,t,i).then(function(t){var i;r.html(t.tpl);i=n(r.contents());i(e);return e.g={}})};m=function(){if(e.meta&&s!==e.meta.template){u(e.app.alias,e.meta.template);return s=e.meta.template}};d=function(r){e.site_meta=r.site_meta;e.theme_meta=r.theme_meta;e.base_url=t.base_url=r.base_url;e.theme_url=t.theme_url=r.theme_url;e.libs_url=t.libs_url=r.libs_url;e.locale=t.locale=r.locale;e.lang=t.lang=r.lang;e.menu=r.menu;e.taxonomy=e.tax=r.taxonomy;e.categories=r.categories;return e.sa=r.sa};e.$watch("config",function(e){return d(e)},true);e.$watch("meta.template",function(){return m()});e.$watch("file",function(t){e.content=t.content;return e.meta=t.meta},true);e.$watch("content",function(t){return e.file.content=t});l=i(function(){},500);r.on("click",function(e){return f.focusCanvas()});a=[];o=t.$on("editor.complete",function(e,t){if(typeof t.destroy==="function"){return a.push(t)}});return e.destory=function(){var e,t,r;for(t=0,r=a.length;t<r;t++){e=a[t];e.destroy()}o();return i.cancel(l)}}]}}]).directive("fakeLink",function(){return{scope:{},restrict:"A",link:function(e,t,r){return t.bind("click mousedown",function(e){e.stopPropagation();e.preventDefault();return false})}}}).directive("supEditorMeta",["$rootScope","$timeout",function(e,t){return{scope:{"default":"@"},restrict:"AE",require:"?ngModel",link:function(r,n,i,o){var u,a,s,l,c,p;if(!o){return}if(window.parent){c=parent.angular.element(parent.document).scope()}else{c=e}p=c.station;if(!p){return}n[0].setAttribute("contenteditable",true);s=false;if(!r["default"]){r["default"]=n.html()}n.on("click mousedown",function(e){p.$emit("widget.update_meta",r);return e.stopPropagation()});o.$render=function(){var e;if(!o.$viewValue&&!s){n.html(r["default"]);e=t(function(){l();return t.cancel(e)},0)}else{n.html(o.$viewValue||"")}return s=true};n.on("blur keyup change cut",function(e){l();return e.stopPropagation()});u=function(e){e=e.replace(/<div\s* .*?>/gi,"<br>");e=e.replace(/<(?!br\s*\/?)[^>]+>/gi,"");if(e==="<br>"){e=""}return e};a=function(e){var t,r,n,i;e.removeAttribute("style");i=e.children;for(r=0,n=i.length;r<n;r++){t=i[r];a(t)}};n.on("paste",function(e){var r;r=t(function(){a(n[0]);n.html(u(n.html()));t.cancel(r);return l()},0);return e.stopPropagation()});return l=function(){var e;e=u(n.html());if(e==="<br>"){e=""}return o.$setViewValue(e.trim())}}}}]).directive("supEditorMedia",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var o,u;if(!i){return}if(window.parent){o=parent.angular.element(parent.document).scope()}else{o=e}u=o.station;if(!u){return}r.on("mousedown",function(e){if(e.supObstructed){return}u.$emit("widget.update_media",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(e);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supEditorWidgetBg",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var o,u;if(!i){return}if(window.parent){o=parent.angular.element(parent.document).scope()}else{o=e}u=o.station;if(!u){return}r.on("mousedown",function(e){if(e.target!==r[0]){return}u.$emit("widget.update_bg",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(e);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supEditorWidgetScript",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var o,u,a,s;if(!i){return}if(window.parent){u=parent.angular.element(parent.document).scope()}else{u=e}s=u.station;if(!s){return}o=r.html();if(o){o=o.trim();r.html(o)}r.on("mousedown",function(e){if(e.supObstructed){return}s.$emit("widget.update_script",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(e);return i.$render()};a=function(e,n){if(n){t.data=e}return r.html(e)};return i.$render=function(){if(i.$viewValue){return a(i.$viewValue,true)}else{return a(o)}}}}}]).directive("supEditorWidgetButton",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var o,u;if(!i){return}if(window.parent){o=parent.angular.element(parent.document).scope()}else{o=e}u=o.station;if(!u){return}r.on("mousedown",function(e){if(e.supObstructed){return}u.$emit("widget.update_button",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(e);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supEditorWidgetGallery",["$rootScope",function(e){return{scope:{},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var o,u;if(!i){return}if(window.parent){o=parent.angular.element(parent.document).scope()}else{o=e}u=o.station;if(!u){return}r.on("mousedown",function(e){if(e.supObstructed){return}u.$emit("widget.update_gallery",t);return e.stopPropagation()});t.update=function(e){t.data=e;i.$setViewValue(e);return i.$render()};return i.$render=function(){return t.data=i.$viewValue}}}}]).directive("supEditorContentQuery",["$rootScope","$timeout",function(e,t){return{scope:{fields:"=",metas:"=",sortby:"=",length:"="},restrict:"AE",require:"?ngModel",link:function(t,r,n,i){var o,u,a,s,l;if(!i){return}if(window.parent){s=parent.angular.element(parent.document).scope()}else{s=e}l=s.station;if(!l){return}if(!l.max_mode){return}o=l.app;a=l.restEditor;if(typeof t.sortby==="string"){t.sortby=[t.sortby]}u={query_fields:t.fields||{},query_metas:t.metas||{},query_length:parseInt(t.length),query_sortby:t.sortby};return a.doContentQueryEditor(o.type,o.alias,u).then(function(e){return i.$setViewValue(e.results)})}}}]).directive("supEditorOpen",["$rootScope",function(e){return{scope:{file:"=file"},restrict:"AE",link:function(t,r,n){var i,o;if(window.parent){i=parent.angular.element(parent.document).scope()}else{i=e}o=i.station;if(!o||!o.open){return}return r.on("mousedown",function(e){o.open(t.file);return e.stopPropagation()})}}}]).directive("supScript",["Config",function(e){return{restrict:"AE",compile:function(t,r){var n,i,o;if(!r.path){return}if(!r.source){o=e.BaseURL.libs}if(r.noSource===void 0){n=o+"/"+r.path}else{n=r.path}i=document.createElement("script");i.setAttribute("ng-src","{{'"+n+"'}}");t.append(i);return t[0].removeAttribute("path")}}}]).directive("supSet",[function(){return{scope:{value:"@"},restrict:"AE",require:"?ngModel",link:function(e,t,r,n){if(!n){return}n.$setViewValue(e.value);return n.$render=function(){return n.$setViewValue(e.value)}}}}]).directive("supObstruct",function(){return{restrict:"A",link:function(e,t,r){return t.bind("click mousedown",function(e){return e.supObstructed=true})}}})}).call(this);
